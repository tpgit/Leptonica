<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Leptonica: src/psio2.c Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript">
$(document).ready(initResizable);
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body onload='searchBox.OnSelectItem(0);'>
<!-- Generated by Doxygen 1.7.3 -->
<script type="text/javascript"><!--
var searchBox = new SearchBox("searchBox", "search",false,'Search');
--></script>
<script type="text/javascript">
function hasClass(ele,cls) {
  return ele.className.match(new RegExp('(\\s|^)'+cls+'(\\s|$)'));
}

function addClass(ele,cls) {
  if (!this.hasClass(ele,cls)) ele.className += " "+cls;
}

function removeClass(ele,cls) {
  if (hasClass(ele,cls)) {
    var reg = new RegExp('(\\s|^)'+cls+'(\\s|$)');
    ele.className=ele.className.replace(reg,' ');
  }
}

function toggleVisibility(linkObj) {
 var base = linkObj.getAttribute('id');
 var summary = document.getElementById(base + '-summary');
 var content = document.getElementById(base + '-content');
 var trigger = document.getElementById(base + '-trigger');
 if ( hasClass(linkObj,'closed') ) {
   summary.style.display = 'none';
   content.style.display = 'block';
   trigger.src = 'open.png';
   removeClass(linkObj,'closed');
   addClass(linkObj,'opened');
 } else if ( hasClass(linkObj,'opened') ) {
   summary.style.display = 'block';
   content.style.display = 'none';
   trigger.src = 'closed.png';
   removeClass(linkObj,'opened');
   addClass(linkObj,'closed');
 }
 return false;
}
</script>
<div id="top">
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="moller52-tiny.jpg"></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">Leptonica&#160;<span id="projectnumber">1.68</span></div>
   <div id="projectbrief">C Image Processing Library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
      <li id="searchli">
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
  initNavTree('psio2_8c.html','');
</script>
<div id="doc-content">
<div class="header">
  <div class="headertitle">
<h1>psio2.c</h1>  </div>
</div>
<div class="contents">
<a href="psio2_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/*====================================================================*</span>
<a name="l00002"></a>00002 <span class="comment"> -  Copyright (C) 2001 Leptonica.  All rights reserved.</span>
<a name="l00003"></a>00003 <span class="comment"> -  This software is distributed in the hope that it will be</span>
<a name="l00004"></a>00004 <span class="comment"> -  useful, but with NO WARRANTY OF ANY KIND.</span>
<a name="l00005"></a>00005 <span class="comment"> -  No author or distributor accepts responsibility to anyone for the</span>
<a name="l00006"></a>00006 <span class="comment"> -  consequences of using this software, or for whether it serves any</span>
<a name="l00007"></a>00007 <span class="comment"> -  particular purpose or works at all, unless he or she says so in</span>
<a name="l00008"></a>00008 <span class="comment"> -  writing.  Everyone is granted permission to copy, modify and</span>
<a name="l00009"></a>00009 <span class="comment"> -  redistribute this source code, for commercial or non-commercial</span>
<a name="l00010"></a>00010 <span class="comment"> -  purposes, with the following restrictions: (1) the origin of this</span>
<a name="l00011"></a>00011 <span class="comment"> -  source code must not be misrepresented; (2) modified versions must</span>
<a name="l00012"></a>00012 <span class="comment"> -  be plainly marked as such; and (3) this notice may not be removed</span>
<a name="l00013"></a>00013 <span class="comment"> -  or altered from any source or modified source distribution.</span>
<a name="l00014"></a>00014 <span class="comment"> *====================================================================*/</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/*</span>
<a name="l00017"></a>00017 <span class="comment"> *  psio2.c</span>
<a name="l00018"></a>00018 <span class="comment"> *</span>
<a name="l00019"></a>00019 <span class="comment"> *    |=============================================================|</span>
<a name="l00020"></a>00020 <span class="comment"> *    |                         Important note                      |</span>
<a name="l00021"></a>00021 <span class="comment"> *    |=============================================================|</span>
<a name="l00022"></a>00022 <span class="comment"> *    | Some of these functions require libtiff, libjpeg and libz.  |</span>
<a name="l00023"></a>00023 <span class="comment"> *    | If you do not have these libraries, you must set            |</span>
<a name="l00024"></a>00024 <span class="comment"> *    |     #define  USE_PSIO     0                                 |</span>
<a name="l00025"></a>00025 <span class="comment"> *    | in environ.h.  This will link psio2stub.c                   |</span>
<a name="l00026"></a>00026 <span class="comment"> *    |=============================================================|</span>
<a name="l00027"></a>00027 <span class="comment"> *</span>
<a name="l00028"></a>00028 <span class="comment"> *     These are lower-level functions that implement a PostScript</span>
<a name="l00029"></a>00029 <span class="comment"> *     &quot;device driver&quot; for wrapping images in PostScript.  The images</span>
<a name="l00030"></a>00030 <span class="comment"> *     can be rendered by a PostScript interpreter for viewing,</span>
<a name="l00031"></a>00031 <span class="comment"> *     using evince or gv.  They can also be rasterized for printing,</span>
<a name="l00032"></a>00032 <span class="comment"> *     using gs or an embedded interpreter in a PostScript printer.</span>
<a name="l00033"></a>00033 <span class="comment"> *     And they can be converted to a pdf using gs (ps2pdf).</span>
<a name="l00034"></a>00034 <span class="comment"> *</span>
<a name="l00035"></a>00035 <span class="comment"> *     For uncompressed images</span>
<a name="l00036"></a>00036 <span class="comment"> *          l_int32              pixWritePSEmbed()</span>
<a name="l00037"></a>00037 <span class="comment"> *          l_int32              pixWriteStreamPS()</span>
<a name="l00038"></a>00038 <span class="comment"> *          char                *pixWriteStringPS()</span>
<a name="l00039"></a>00039 <span class="comment"> *          char                *generateUncompressedPS()</span>
<a name="l00040"></a>00040 <span class="comment"> *          void                 getScaledParametersPS()</span>
<a name="l00041"></a>00041 <span class="comment"> *          l_int32              convertByteToHexAscii()</span>
<a name="l00042"></a>00042 <span class="comment"> *</span>
<a name="l00043"></a>00043 <span class="comment"> *     For jpeg compressed images (use dct compression)</span>
<a name="l00044"></a>00044 <span class="comment"> *          l_int32              convertJpegToPSEmbed()</span>
<a name="l00045"></a>00045 <span class="comment"> *          l_int32              convertJpegToPS()</span>
<a name="l00046"></a>00046 <span class="comment"> *          l_int32              convertJpegToPSString()</span>
<a name="l00047"></a>00047 <span class="comment"> *          char                *generateJpegPS()</span>
<a name="l00048"></a>00048 <span class="comment"> *          L_COMPRESSED_DATA   *pixGenerateJpegData()</span>
<a name="l00049"></a>00049 <span class="comment"> *          L_COMPRESSED_DATA   *l_generateJpegData()</span>
<a name="l00050"></a>00050 <span class="comment"> *          void                 compressed_dataDestroy()</span>
<a name="l00051"></a>00051 <span class="comment"> *</span>
<a name="l00052"></a>00052 <span class="comment"> *     For g4 fax compressed images (use ccitt g4 compression)</span>
<a name="l00053"></a>00053 <span class="comment"> *          l_int32              convertG4ToPSEmbed()</span>
<a name="l00054"></a>00054 <span class="comment"> *          l_int32              convertG4ToPS()</span>
<a name="l00055"></a>00055 <span class="comment"> *          l_int32              convertG4ToPSString()</span>
<a name="l00056"></a>00056 <span class="comment"> *          char                *generateG4PS()</span>
<a name="l00057"></a>00057 <span class="comment"> *          L_COMPRESSED_DATA   *pixGenerateG4Data()</span>
<a name="l00058"></a>00058 <span class="comment"> *          L_COMPRESSED_DATA   *l_generateG4Data()</span>
<a name="l00059"></a>00059 <span class="comment"> *</span>
<a name="l00060"></a>00060 <span class="comment"> *     For multipage tiff images</span>
<a name="l00061"></a>00061 <span class="comment"> *          l_int32              convertTiffMultipageToPS()</span>
<a name="l00062"></a>00062 <span class="comment"> *</span>
<a name="l00063"></a>00063 <span class="comment"> *     For flate (gzip) compressed images (e.g., png)</span>
<a name="l00064"></a>00064 <span class="comment"> *          l_int32              convertFlateToPSEmbed()</span>
<a name="l00065"></a>00065 <span class="comment"> *          l_int32              convertFlateToPS()</span>
<a name="l00066"></a>00066 <span class="comment"> *          l_int32              convertFlateToPSString()</span>
<a name="l00067"></a>00067 <span class="comment"> *          char                *generateFlatePS()</span>
<a name="l00068"></a>00068 <span class="comment"> *          L_COMPRESSED_DATA   *l_generateFlateData()</span>
<a name="l00069"></a>00069 <span class="comment"> *          L_COMPRESSED_DATA   *pixGenerateFlateData()</span>
<a name="l00070"></a>00070 <span class="comment"> *</span>
<a name="l00071"></a>00071 <span class="comment"> *     Write to memory</span>
<a name="l00072"></a>00072 <span class="comment"> *          l_int32              pixWriteMemPS()</span>
<a name="l00073"></a>00073 <span class="comment"> *</span>
<a name="l00074"></a>00074 <span class="comment"> *     Converting resolution</span>
<a name="l00075"></a>00075 <span class="comment"> *          l_int32              getResLetterPage()</span>
<a name="l00076"></a>00076 <span class="comment"> *          l_int32              getResA4Page()</span>
<a name="l00077"></a>00077 <span class="comment"> *</span>
<a name="l00078"></a>00078 <span class="comment"> *     Utility for encoding and decoding data with ascii85</span>
<a name="l00079"></a>00079 <span class="comment"> *          char                *encodeAscii85()</span>
<a name="l00080"></a>00080 <span class="comment"> *          l_int32             *convertChunkToAscii85()</span>
<a name="l00081"></a>00081 <span class="comment"> *          l_uint8             *decodeAscii85()</span>
<a name="l00082"></a>00082 <span class="comment"> *</span>
<a name="l00083"></a>00083 <span class="comment"> *     Setting flag for writing bounding box hint</span>
<a name="l00084"></a>00084 <span class="comment"> *          void                 l_psWriteBoundingBox()</span>
<a name="l00085"></a>00085 <span class="comment"> *</span>
<a name="l00086"></a>00086 <span class="comment"> *  See psio1.c for higher-level functions and their usage.</span>
<a name="l00087"></a>00087 <span class="comment"> */</span>
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00090"></a>00090 <span class="preprocessor">#include &quot;<a class="code" href="allheaders_8h.html" title="Includes all required Leptonica header files.">allheaders.h</a>&quot;</span>
<a name="l00091"></a>00091 
<a name="l00092"></a>00092 <span class="comment">/* --------------------------------------------*/</span>
<a name="l00093"></a>00093 <span class="preprocessor">#if  USE_PSIO   </span><span class="comment">/* defined in environ.h */</span>
<a name="l00094"></a>00094  <span class="comment">/* --------------------------------------------*/</span>
<a name="l00095"></a>00095  
<a name="l00096"></a>00096     <span class="comment">/* Set default for writing bounding box hint */</span>
<a name="l00097"></a><a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">00097</a> <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">var_PS_WRITE_BOUNDING_BOX</a> = 1;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     <span class="comment">/* MS VC++ can&#39;t handle array initialization with static consts ! */</span>
<a name="l00100"></a><a class="code" href="psio2_8c.html#af1791633b3a1a12a9aa449aa6d558327">00100</a> <span class="preprocessor">#define L_BUF_SIZE      512</span>
<a name="l00101"></a>00101 <span class="preprocessor"></span>
<a name="l00102"></a><a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">00102</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>   = 300;  <span class="comment">/* typical scan res, ppi */</span>
<a name="l00103"></a><a class="code" href="psio2_8c.html#a673743369d049605d51e76709926133e">00103</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#a673743369d049605d51e76709926133e">MIN_RES</a>             = 5;
<a name="l00104"></a><a class="code" href="psio2_8c.html#a34c5f6d115218acfcdb4084ad376e314">00104</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#a34c5f6d115218acfcdb4084ad376e314">MAX_RES</a>             = 3000;
<a name="l00105"></a><a class="code" href="psio2_8c.html#aad2ea195992058b22128391685b46ce0">00105</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#aad2ea195992058b22128391685b46ce0">MAX_85_LINE_COUNT</a>   = 64;  <span class="comment">/* max line length ascii85 */</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="comment">/* For computing resolution that fills page to desired amount */</span>
<a name="l00108"></a><a class="code" href="psio2_8c.html#a554df9dc23fef6dfda93c0011d6bb709">00108</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#a554df9dc23fef6dfda93c0011d6bb709">LETTER_WIDTH</a>            = 612;   <span class="comment">/* points */</span>
<a name="l00109"></a><a class="code" href="psio2_8c.html#aca7914657933f6a1a9ae0c1fa12d0aec">00109</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#aca7914657933f6a1a9ae0c1fa12d0aec">LETTER_HEIGHT</a>           = 792;   <span class="comment">/* points */</span>
<a name="l00110"></a><a class="code" href="psio2_8c.html#ac8876763816c3777a8809420fdfda5e0">00110</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#ac8876763816c3777a8809420fdfda5e0">A4_WIDTH</a>                = 595;   <span class="comment">/* points */</span>
<a name="l00111"></a><a class="code" href="psio2_8c.html#af15b52325746b4b232895b2c82a8d5d5">00111</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#af15b52325746b4b232895b2c82a8d5d5">A4_HEIGHT</a>               = 842;   <span class="comment">/* points */</span>
<a name="l00112"></a><a class="code" href="psio2_8c.html#ae5cd7ddcd7db6d82efc3da1980812d0e">00112</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  <a class="code" href="psio2_8c.html#ae5cd7ddcd7db6d82efc3da1980812d0e">DEFAULT_FILL_FRACTION</a> = 0.95;
<a name="l00113"></a>00113 
<a name="l00114"></a><a class="code" href="psio2_8c.html#a920c246eaaeb153de163dbc1472871f2">00114</a> <span class="keyword">static</span> <span class="keyword">const</span> <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>  <a class="code" href="psio2_8c.html#a920c246eaaeb153de163dbc1472871f2">power85</a>[5] = {1,
<a name="l00115"></a>00115                                      85,
<a name="l00116"></a>00116                                      85 * 85,
<a name="l00117"></a>00117                                      85 * 85 * 85,
<a name="l00118"></a>00118                                      85 * 85 * 85 * 85};
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="psio2_8c.html#af4e6bbb144efce5fedd970d4df00f5bc">convertChunkToAscii85</a>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *inarray, <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> insize,
<a name="l00121"></a>00121                                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *pindex, <span class="keywordtype">char</span> *outbuf,
<a name="l00122"></a>00122                                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a> *pnbout);
<a name="l00123"></a>00123 
<a name="l00124"></a>00124 <span class="preprocessor">#ifndef  NO_CONSOLE_IO</span>
<a name="l00125"></a><a class="code" href="psio2_8c.html#aef02ab29899b146e0d8ce4f8dd6cef15">00125</a> <span class="preprocessor"></span><span class="preprocessor">#define  DEBUG_JPEG       0</span>
<a name="l00126"></a><a class="code" href="psio2_8c.html#a94d37ef15f10606050733c806b0b20c5">00126</a> <span class="preprocessor"></span><span class="preprocessor">#define  DEBUG_G4         0</span>
<a name="l00127"></a><a class="code" href="psio2_8c.html#a7d33b7ad0fd05ff0c26ee904d41bed53">00127</a> <span class="preprocessor"></span><span class="preprocessor">#define  DEBUG_FLATE      0</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">#endif  </span><span class="comment">/* ~NO_CONSOLE_IO */</span>
<a name="l00129"></a>00129 
<a name="l00130"></a>00130 <span class="comment">/* Note that the bounding box hint at the top of the generated PostScript</span>
<a name="l00131"></a>00131 <span class="comment"> * file is required for the &quot;*Embed&quot; functions.  These generate a</span>
<a name="l00132"></a>00132 <span class="comment"> * PostScript file for an individual image that can be translated and</span>
<a name="l00133"></a>00133 <span class="comment"> * scaled by an application that embeds the image in its output</span>
<a name="l00134"></a>00134 <span class="comment"> * (e.g., in the PS output from a TeX file).</span>
<a name="l00135"></a>00135 <span class="comment"> * However, bounding box hints should not be embedded in any</span>
<a name="l00136"></a>00136 <span class="comment"> * PostScript image that will be composited with other images,</span>
<a name="l00137"></a>00137 <span class="comment"> * where more than one image may be placed in an arbitrary location</span>
<a name="l00138"></a>00138 <span class="comment"> * on a page.  */</span>
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l00142"></a>00142 <span class="comment"> *                  For uncompressed images                    *</span>
<a name="l00143"></a>00143 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00144"></a>00144 <span class="comment">/*!</span>
<a name="l00145"></a>00145 <span class="comment"> *  pixWritePSEmbed()</span>
<a name="l00146"></a>00146 <span class="comment"> *</span>
<a name="l00147"></a>00147 <span class="comment"> *      Input:  filein (input file, all depths, colormap OK)</span>
<a name="l00148"></a>00148 <span class="comment"> *              fileout (output ps file)</span>
<a name="l00149"></a>00149 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l00150"></a>00150 <span class="comment"> *</span>
<a name="l00151"></a>00151 <span class="comment"> *  Notes:</span>
<a name="l00152"></a>00152 <span class="comment"> *      (1) This is a simple wrapper function that generates an</span>
<a name="l00153"></a>00153 <span class="comment"> *          uncompressed PS file, with a bounding box.</span>
<a name="l00154"></a>00154 <span class="comment"> *      (2) The bounding box is required when a program such as TeX</span>
<a name="l00155"></a>00155 <span class="comment"> *          (through epsf) places and rescales the image.</span>
<a name="l00156"></a>00156 <span class="comment"> *      (3) The bounding box is sized for fitting the image to an</span>
<a name="l00157"></a>00157 <span class="comment"> *          8.5 x 11.0 inch page.</span>
<a name="l00158"></a>00158 <span class="comment"> */</span>
<a name="l00159"></a>00159 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00160"></a><a class="code" href="psio2_8c.html#aeb12646fe7b64268a4c92c1ff840ddfd">00160</a> <a class="code" href="leptprotos_8h.html#ab0a145bea0d4615b3bae5c5eef6955b1">pixWritePSEmbed</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l00161"></a>00161                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout)
<a name="l00162"></a>00162 {
<a name="l00163"></a>00163 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    w, h;
<a name="l00164"></a>00164 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  scale;
<a name="l00165"></a>00165 FILE      *fp;
<a name="l00166"></a>00166 <a class="code" href="struct_pix.html">PIX</a>       *pix;
<a name="l00167"></a>00167 
<a name="l00168"></a>00168     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixWritePSEmbed&quot;</span>);
<a name="l00169"></a>00169 
<a name="l00170"></a>00170     <span class="keywordflow">if</span> (!filein)
<a name="l00171"></a>00171         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l00172"></a>00172     <span class="keywordflow">if</span> (!fileout)
<a name="l00173"></a>00173         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l00174"></a>00174 
<a name="l00175"></a>00175     <span class="keywordflow">if</span> ((pix = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(filein)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00176"></a>00176         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;image not read from file&quot;</span>, procName, 1);
<a name="l00177"></a>00177     w = <a class="code" href="leptprotos_8h.html#aa71e0b02548a56e723c76996ab145257">pixGetWidth</a>(pix);
<a name="l00178"></a>00178     h = <a class="code" href="leptprotos_8h.html#a511e60efcf1d9f3f59b5308ef5f49a06">pixGetHeight</a>(pix);
<a name="l00179"></a>00179     <span class="keywordflow">if</span> (w * 11.0 &gt; h * 8.5)
<a name="l00180"></a>00180         scale = 8.5 * 300. / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w;
<a name="l00181"></a>00181     <span class="keywordflow">else</span>
<a name="l00182"></a>00182         scale = 11.0 * 300. / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h;
<a name="l00183"></a>00183 
<a name="l00184"></a>00184     <span class="keywordflow">if</span> ((fp = <a class="code" href="leptprotos_8h.html#a33897cfec13616080528eaefe37954b1">fopenWriteStream</a>(fileout, <span class="stringliteral">&quot;wb&quot;</span>)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00185"></a>00185         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;file not opened for write&quot;</span>, procName, 1);
<a name="l00186"></a>00186     <a class="code" href="leptprotos_8h.html#a74ca34e95b3461f7c99c255eff117e70">pixWriteStreamPS</a>(fp, pix, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, 0, scale);
<a name="l00187"></a>00187     fclose(fp);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00190"></a>00190     <span class="keywordflow">return</span> 0;
<a name="l00191"></a>00191 }
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="comment"></span>
<a name="l00194"></a>00194 <span class="comment">/*!</span>
<a name="l00195"></a>00195 <span class="comment"> *  pixWriteStreamPS()</span>
<a name="l00196"></a>00196 <span class="comment"> *</span>
<a name="l00197"></a>00197 <span class="comment"> *      Input:  stream</span>
<a name="l00198"></a>00198 <span class="comment"> *              pix</span>
<a name="l00199"></a>00199 <span class="comment"> *              box  (&lt;optional&gt;)</span>
<a name="l00200"></a>00200 <span class="comment"> *              res  (can use 0 for default of 300 ppi)</span>
<a name="l00201"></a>00201 <span class="comment"> *              scale (to prevent scaling, use either 1.0 or 0.0)</span>
<a name="l00202"></a>00202 <span class="comment"> *      Return: 0 if OK; 1 on error</span>
<a name="l00203"></a>00203 <span class="comment"> *</span>
<a name="l00204"></a>00204 <span class="comment"> *  Notes:</span>
<a name="l00205"></a>00205 <span class="comment"> *      (1) This writes image in PS format, optionally scaled,</span>
<a name="l00206"></a>00206 <span class="comment"> *          adjusted for the printer resolution, and with</span>
<a name="l00207"></a>00207 <span class="comment"> *          a bounding box.</span>
<a name="l00208"></a>00208 <span class="comment"> *      (2) For details on use of parameters, see pixWriteStringPS().</span>
<a name="l00209"></a>00209 <span class="comment"> */</span>
<a name="l00210"></a>00210 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00211"></a><a class="code" href="psio2_8c.html#ac12c1ca4156afbf5342d9f8dc33e6906">00211</a> <a class="code" href="leptprotos_8h.html#a74ca34e95b3461f7c99c255eff117e70">pixWriteStreamPS</a>(FILE      *fp,
<a name="l00212"></a>00212                  <a class="code" href="struct_pix.html">PIX</a>       *pix,
<a name="l00213"></a>00213                  <a class="code" href="struct_box.html">BOX</a>       *box,
<a name="l00214"></a>00214                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    res,
<a name="l00215"></a>00215                  <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  scale)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217 <span class="keywordtype">char</span>    *outstr;
<a name="l00218"></a>00218 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  length;
<a name="l00219"></a>00219 <a class="code" href="struct_pix.html">PIX</a>     *pixc;
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixWriteStreamPS&quot;</span>);
<a name="l00222"></a>00222 
<a name="l00223"></a>00223     <span class="keywordflow">if</span> (!fp)
<a name="l00224"></a>00224         <span class="keywordflow">return</span> (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)<a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;stream not open&quot;</span>, procName, 1);
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (!pix)
<a name="l00226"></a>00226         <span class="keywordflow">return</span> (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)<a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;pix not defined&quot;</span>, procName, 1);
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="keywordflow">if</span> ((pixc = <a class="code" href="leptprotos_8h.html#a638efac2122aaecd749cc11c46d34393">pixConvertForPSWrap</a>(pix)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00229"></a>00229         <span class="keywordflow">return</span> (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)<a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;pixc not made&quot;</span>, procName, 1);
<a name="l00230"></a>00230 
<a name="l00231"></a>00231     outstr = <a class="code" href="leptprotos_8h.html#a0740def25928896c51cce8d48f7c300e">pixWriteStringPS</a>(pixc, box, res, scale);
<a name="l00232"></a>00232     length = strlen(outstr);
<a name="l00233"></a>00233     fwrite(outstr, 1, length, fp);
<a name="l00234"></a>00234     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l00235"></a>00235     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixc);
<a name="l00236"></a>00236 
<a name="l00237"></a>00237     <span class="keywordflow">return</span> 0;
<a name="l00238"></a>00238 }
<a name="l00239"></a>00239 
<a name="l00240"></a>00240 <span class="comment"></span>
<a name="l00241"></a>00241 <span class="comment">/*!</span>
<a name="l00242"></a>00242 <span class="comment"> *  pixWriteStringPS()</span>
<a name="l00243"></a>00243 <span class="comment"> *</span>
<a name="l00244"></a>00244 <span class="comment"> *      Input:  pixs:  all depths, colormap OK</span>
<a name="l00245"></a>00245 <span class="comment"> *              box:  (a) If box == null, image is placed, optionally scaled,</span>
<a name="l00246"></a>00246 <span class="comment"> *                        in a standard b.b. at the center of the page.</span>
<a name="l00247"></a>00247 <span class="comment"> *                        This is to be used when another program like</span>
<a name="l00248"></a>00248 <span class="comment"> *                        TeX (through epsf) places the image.</span>
<a name="l00249"></a>00249 <span class="comment"> *                    (b) If box != null, image is placed without a</span>
<a name="l00250"></a>00250 <span class="comment"> *                        b.b. at the specified page location and with</span>
<a name="l00251"></a>00251 <span class="comment"> *                        (optional) scaling.  This is to be used when</span>
<a name="l00252"></a>00252 <span class="comment"> *                        you want to specify exactly where (and optionally</span>
<a name="l00253"></a>00253 <span class="comment"> *                        how big) you want the image to be.</span>
<a name="l00254"></a>00254 <span class="comment"> *                        Note that all coordinates are in PS convention,</span>
<a name="l00255"></a>00255 <span class="comment"> *                        with (0,0) at LL corner of the page:</span>
<a name="l00256"></a>00256 <span class="comment"> *                            (x,y)    location of LL corner of image, in mils.</span>
<a name="l00257"></a>00257 <span class="comment"> *                            (w,h)    scaled size, in mils.  Use 0 to</span>
<a name="l00258"></a>00258 <span class="comment"> *                                     scale with &quot;scale&quot; and &quot;res&quot; input.</span>
<a name="l00259"></a>00259 <span class="comment"> *              res:  resolution, in printer ppi.  Use 0 for default (300 ppi).</span>
<a name="l00260"></a>00260 <span class="comment"> *              scale: scale factor.  If no scaling is desired, use</span>
<a name="l00261"></a>00261 <span class="comment"> *                     either 1.0 or 0.0.   Scaling just resets the resolution</span>
<a name="l00262"></a>00262 <span class="comment"> *                     parameter; the actual scaling is done in the</span>
<a name="l00263"></a>00263 <span class="comment"> *                     interpreter at rendering time.  This is important:</span>
<a name="l00264"></a>00264 <span class="comment"> *                     it allows you to scale the image up without</span>
<a name="l00265"></a>00265 <span class="comment"> *                     increasing the file size.</span>
<a name="l00266"></a>00266 <span class="comment"> *      Return: ps string if OK, or null on error</span>
<a name="l00267"></a>00267 <span class="comment"> *</span>
<a name="l00268"></a>00268 <span class="comment"> *  Notes:</span>
<a name="l00269"></a>00269 <span class="comment"> *      (1) OK, this seems a bit complicated, because there are various</span>
<a name="l00270"></a>00270 <span class="comment"> *          ways to scale and not to scale.  Here&#39;s a summary:</span>
<a name="l00271"></a>00271 <span class="comment"> *      (2) If you don&#39;t want any scaling at all:</span>
<a name="l00272"></a>00272 <span class="comment"> *           * if you are using a box:</span>
<a name="l00273"></a>00273 <span class="comment"> *               set w = 0, h = 0, and use scale = 1.0; it will print</span>
<a name="l00274"></a>00274 <span class="comment"> *               each pixel unscaled at printer resolution</span>
<a name="l00275"></a>00275 <span class="comment"> *           * if you are not using a box:</span>
<a name="l00276"></a>00276 <span class="comment"> *               set scale = 1.0; it will print at printer resolution</span>
<a name="l00277"></a>00277 <span class="comment"> *      (3) If you want the image to be a certain size in inches:</span>
<a name="l00278"></a>00278 <span class="comment"> *           * you must use a box and set the box (w,h) in mils</span>
<a name="l00279"></a>00279 <span class="comment"> *      (4) If you want the image to be scaled by a scale factor != 1.0:</span>
<a name="l00280"></a>00280 <span class="comment"> *           * if you are using a box:</span>
<a name="l00281"></a>00281 <span class="comment"> *               set w = 0, h = 0, and use the desired scale factor;</span>
<a name="l00282"></a>00282 <span class="comment"> *               the higher the printer resolution, the smaller the</span>
<a name="l00283"></a>00283 <span class="comment"> *               image will actually appear.</span>
<a name="l00284"></a>00284 <span class="comment"> *           * if you are not using a box:</span>
<a name="l00285"></a>00285 <span class="comment"> *               set the desired scale factor; the higher the printer</span>
<a name="l00286"></a>00286 <span class="comment"> *               resolution, the smaller the image will actually appear.</span>
<a name="l00287"></a>00287 <span class="comment"> *      (5) Another complication is the proliferation of distance units:</span>
<a name="l00288"></a>00288 <span class="comment"> *           * The interface distances are in milli-inches.</span>
<a name="l00289"></a>00289 <span class="comment"> *           * Three different units are used internally:</span>
<a name="l00290"></a>00290 <span class="comment"> *              - pixels  (units of 1/res inch)</span>
<a name="l00291"></a>00291 <span class="comment"> *              - printer pts (units of 1/72 inch)</span>
<a name="l00292"></a>00292 <span class="comment"> *              - inches</span>
<a name="l00293"></a>00293 <span class="comment"> *           * Here is a quiz on volume units from a reviewer:</span>
<a name="l00294"></a>00294 <span class="comment"> *             How many UK milli-cups in a US kilo-teaspoon?</span>
<a name="l00295"></a>00295 <span class="comment"> *               (Hint: 1.0 US cup = 0.75 UK cup + 0.2 US gill;</span>
<a name="l00296"></a>00296 <span class="comment"> *                      1.0 US gill = 24.0 US teaspoons)</span>
<a name="l00297"></a>00297 <span class="comment"> */</span>
<a name="l00298"></a>00298 <span class="keywordtype">char</span> *
<a name="l00299"></a><a class="code" href="psio2_8c.html#a0547b5d69659f1b42efcdfd3f32a8ad6">00299</a> <a class="code" href="leptprotos_8h.html#a0740def25928896c51cce8d48f7c300e">pixWriteStringPS</a>(<a class="code" href="struct_pix.html">PIX</a>       *pixs,
<a name="l00300"></a>00300                  <a class="code" href="struct_box.html">BOX</a>       *box,
<a name="l00301"></a>00301                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    res,
<a name="l00302"></a>00302                  <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  scale)
<a name="l00303"></a>00303 {
<a name="l00304"></a>00304 <span class="keywordtype">char</span>       nib1, nib2;
<a name="l00305"></a>00305 <span class="keywordtype">char</span>      *hexdata, *outstr;
<a name="l00306"></a>00306 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>    byteval;
<a name="l00307"></a>00307 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    i, j, k, w, h, d;
<a name="l00308"></a>00308 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  wpt, hpt, xpt, ypt;
<a name="l00309"></a>00309 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    wpl, psbpl, hexbytes, boxflag, bps;
<a name="l00310"></a>00310 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>  *line, *data;
<a name="l00311"></a>00311 <a class="code" href="struct_pix.html">PIX</a>       *pix;
<a name="l00312"></a>00312 
<a name="l00313"></a>00313     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixWriteStringPS&quot;</span>);
<a name="l00314"></a>00314 
<a name="l00315"></a>00315     <span class="keywordflow">if</span> (!pixs)
<a name="l00316"></a>00316         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00317"></a>00317 
<a name="l00318"></a>00318     <span class="keywordflow">if</span> ((pix = <a class="code" href="leptprotos_8h.html#a638efac2122aaecd749cc11c46d34393">pixConvertForPSWrap</a>(pixs)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00319"></a>00319         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pix not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00320"></a>00320     <a class="code" href="leptprotos_8h.html#a11b8bc890f3872b0a19307f4c5a9b41e">pixGetDimensions</a>(pix, &amp;w, &amp;h, &amp;d);
<a name="l00321"></a>00321 
<a name="l00322"></a>00322         <span class="comment">/* Get the factors by which PS scales and translates, in pts */</span>
<a name="l00323"></a>00323     <span class="keywordflow">if</span> (!box)
<a name="l00324"></a>00324         boxflag = 0;  <span class="comment">/* no scaling; b.b. at center */</span>
<a name="l00325"></a>00325     <span class="keywordflow">else</span>
<a name="l00326"></a>00326         boxflag = 1;  <span class="comment">/* no b.b., specify placement and optional scaling */</span>
<a name="l00327"></a>00327     <a class="code" href="leptprotos_8h.html#acf617b0f8a846c74a32df47df87321da">getScaledParametersPS</a>(box, w, h, res, scale, &amp;xpt, &amp;ypt, &amp;wpt, &amp;hpt);
<a name="l00328"></a>00328 
<a name="l00329"></a>00329     <span class="keywordflow">if</span> (d == 1)
<a name="l00330"></a>00330         bps = 1;  <span class="comment">/* bits/sample */</span>
<a name="l00331"></a>00331     <span class="keywordflow">else</span>  <span class="comment">/* d == 8 || d == 32 */</span>
<a name="l00332"></a>00332         bps = 8;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334         <span class="comment">/* Convert image data to hex string.  psbpl is the number of</span>
<a name="l00335"></a>00335 <span class="comment">         * bytes in each raster line when it is packed to the byte</span>
<a name="l00336"></a>00336 <span class="comment">         * boundary (not the 32 bit word boundary, as with the pix).</span>
<a name="l00337"></a>00337 <span class="comment">         * When converted to hex, the hex string has 2 bytes for</span>
<a name="l00338"></a>00338 <span class="comment">         * every byte of raster data. */</span>
<a name="l00339"></a>00339     wpl = <a class="code" href="leptprotos_8h.html#af0b490472ab7999f208098dd37167d73">pixGetWpl</a>(pix);
<a name="l00340"></a>00340     <span class="keywordflow">if</span> (d == 1 || d == 8)
<a name="l00341"></a>00341         psbpl = (w * d + 7) / 8;
<a name="l00342"></a>00342     <span class="keywordflow">else</span> <span class="comment">/* d == 32 */</span>
<a name="l00343"></a>00343         psbpl = 3 * w;
<a name="l00344"></a>00344     data = <a class="code" href="leptprotos_8h.html#a44546f758f2cf71bb109bfc114e3ca7f">pixGetData</a>(pix);
<a name="l00345"></a>00345     hexbytes = 2 * psbpl * h;  <span class="comment">/* size of ps hex array */</span>
<a name="l00346"></a>00346     <span class="keywordflow">if</span> ((hexdata = (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(hexbytes + 1, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00347"></a>00347         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;hexdata not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00348"></a>00348     <span class="keywordflow">if</span> (d == 1 || d == 8) {
<a name="l00349"></a>00349         <span class="keywordflow">for</span> (i = 0, k = 0; i &lt; h; i++) {
<a name="l00350"></a>00350             line = data + i * wpl;
<a name="l00351"></a>00351             <span class="keywordflow">for</span> (j = 0; j &lt; psbpl; j++) {
<a name="l00352"></a>00352                 byteval = <a class="code" href="arrayaccess_8h.html#a9b285094ef3b18d30d8ad13262e61faf">GET_DATA_BYTE</a>(line, j);
<a name="l00353"></a>00353                 <a class="code" href="leptprotos_8h.html#a28b370bc2be2685e5d26b6996554b558">convertByteToHexAscii</a>(byteval, &amp;nib1, &amp;nib2);
<a name="l00354"></a>00354                 hexdata[k++] = nib1;
<a name="l00355"></a>00355                 hexdata[k++] = nib2;
<a name="l00356"></a>00356             }
<a name="l00357"></a>00357         }
<a name="l00358"></a>00358     }
<a name="l00359"></a>00359     <span class="keywordflow">else</span>  {  <span class="comment">/* d == 32; hexdata bytes packed RGBRGB..., 2 per sample */</span>
<a name="l00360"></a>00360         <span class="keywordflow">for</span> (i = 0, k = 0; i &lt; h; i++) {
<a name="l00361"></a>00361             line = data + i * wpl;
<a name="l00362"></a>00362             <span class="keywordflow">for</span> (j = 0; j &lt; w; j++) {
<a name="l00363"></a>00363                 byteval = <a class="code" href="arrayaccess_8h.html#a9b285094ef3b18d30d8ad13262e61faf">GET_DATA_BYTE</a>(line + j, 0);  <span class="comment">/* red */</span>
<a name="l00364"></a>00364                 <a class="code" href="leptprotos_8h.html#a28b370bc2be2685e5d26b6996554b558">convertByteToHexAscii</a>(byteval, &amp;nib1, &amp;nib2);
<a name="l00365"></a>00365                 hexdata[k++] = nib1;
<a name="l00366"></a>00366                 hexdata[k++] = nib2;
<a name="l00367"></a>00367                 byteval = <a class="code" href="arrayaccess_8h.html#a9b285094ef3b18d30d8ad13262e61faf">GET_DATA_BYTE</a>(line + j, 1);  <span class="comment">/* green */</span>
<a name="l00368"></a>00368                 <a class="code" href="leptprotos_8h.html#a28b370bc2be2685e5d26b6996554b558">convertByteToHexAscii</a>(byteval, &amp;nib1, &amp;nib2);
<a name="l00369"></a>00369                 hexdata[k++] = nib1;
<a name="l00370"></a>00370                 hexdata[k++] = nib2;
<a name="l00371"></a>00371                 byteval = <a class="code" href="arrayaccess_8h.html#a9b285094ef3b18d30d8ad13262e61faf">GET_DATA_BYTE</a>(line + j, 2);  <span class="comment">/* blue */</span>
<a name="l00372"></a>00372                 <a class="code" href="leptprotos_8h.html#a28b370bc2be2685e5d26b6996554b558">convertByteToHexAscii</a>(byteval, &amp;nib1, &amp;nib2);
<a name="l00373"></a>00373                 hexdata[k++] = nib1;
<a name="l00374"></a>00374                 hexdata[k++] = nib2;
<a name="l00375"></a>00375             }
<a name="l00376"></a>00376         }
<a name="l00377"></a>00377     }
<a name="l00378"></a>00378     hexdata[k] = <span class="charliteral">&#39;\0&#39;</span>;
<a name="l00379"></a>00379 
<a name="l00380"></a>00380     outstr = <a class="code" href="leptprotos_8h.html#a9d84ff63b7278de9fbeab62f14f66cfd">generateUncompressedPS</a>(hexdata, w, h, d, psbpl, bps,
<a name="l00381"></a>00381                                     xpt, ypt, wpt, hpt, boxflag);
<a name="l00382"></a>00382     <span class="keywordflow">if</span> (!outstr)
<a name="l00383"></a>00383         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00384"></a>00384     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l00385"></a>00385     <span class="keywordflow">return</span> outstr;
<a name="l00386"></a>00386 }
<a name="l00387"></a>00387 
<a name="l00388"></a>00388 <span class="comment"></span>
<a name="l00389"></a>00389 <span class="comment">/*!</span>
<a name="l00390"></a>00390 <span class="comment"> *  generateUncompressedPS()</span>
<a name="l00391"></a>00391 <span class="comment"> *</span>
<a name="l00392"></a>00392 <span class="comment"> *      Input:  hexdata</span>
<a name="l00393"></a>00393 <span class="comment"> *              w, h  (raster image size in pixels)</span>
<a name="l00394"></a>00394 <span class="comment"> *              d (image depth in bpp; rgb is 32)</span>
<a name="l00395"></a>00395 <span class="comment"> *              psbpl (raster bytes/line, when packed to the byte boundary)</span>
<a name="l00396"></a>00396 <span class="comment"> *              bps (bits/sample: either 1 or 8)</span>
<a name="l00397"></a>00397 <span class="comment"> *              xpt, ypt (location of LL corner of image, in pts, relative</span>
<a name="l00398"></a>00398 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l00399"></a>00399 <span class="comment"> *                    of the page)</span>
<a name="l00400"></a>00400 <span class="comment"> *              wpt, hpt (rendered image size in pts)</span>
<a name="l00401"></a>00401 <span class="comment"> *              boxflag (1 to print out bounding box hint; 0 to skip)</span>
<a name="l00402"></a>00402 <span class="comment"> *      Return: PS string, or null on error</span>
<a name="l00403"></a>00403 <span class="comment"> *</span>
<a name="l00404"></a>00404 <span class="comment"> *  Notes:</span>
<a name="l00405"></a>00405 <span class="comment"> *      (1) Low-level function.</span>
<a name="l00406"></a>00406 <span class="comment"> */</span>
<a name="l00407"></a>00407 <span class="keywordtype">char</span> *
<a name="l00408"></a><a class="code" href="psio2_8c.html#a2bd3d9c9163e371886e9b784dbd31e62">00408</a> <a class="code" href="leptprotos_8h.html#a9d84ff63b7278de9fbeab62f14f66cfd">generateUncompressedPS</a>(<span class="keywordtype">char</span>      *hexdata,
<a name="l00409"></a>00409                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    w,
<a name="l00410"></a>00410                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    h,
<a name="l00411"></a>00411                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    d,
<a name="l00412"></a>00412                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    psbpl,
<a name="l00413"></a>00413                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    bps,
<a name="l00414"></a>00414                        <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  xpt,
<a name="l00415"></a>00415                        <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  ypt,
<a name="l00416"></a>00416                        <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  wpt,
<a name="l00417"></a>00417                        <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  hpt,
<a name="l00418"></a>00418                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    boxflag)
<a name="l00419"></a>00419 {
<a name="l00420"></a>00420 <span class="keywordtype">char</span>    *outstr;
<a name="l00421"></a>00421 <span class="keywordtype">char</span>     bigbuf[<a class="code" href="psio2_8c.html#af1791633b3a1a12a9aa449aa6d558327">L_BUF_SIZE</a>];
<a name="l00422"></a>00422 <a class="code" href="struct_sarray.html">SARRAY</a>  *sa;
<a name="l00423"></a>00423 
<a name="l00424"></a>00424     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;generateUncompressedPS&quot;</span>);
<a name="l00425"></a>00425 
<a name="l00426"></a>00426     <span class="keywordflow">if</span> (!hexdata)
<a name="l00427"></a>00427         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;hexdata not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00428"></a>00428 
<a name="l00429"></a>00429     <span class="keywordflow">if</span> ((sa = <a class="code" href="leptprotos_8h.html#ad131504b407cbc1aaa1b18e59945d9a5">sarrayCreate</a>(0)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00430"></a>00430         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;sa not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00431"></a>00431     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%!Adobe-PS&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00432"></a>00432     <span class="keywordflow">if</span> (boxflag == 0) {
<a name="l00433"></a>00433         sprintf(bigbuf,
<a name="l00434"></a>00434             <span class="stringliteral">&quot;%%%%BoundingBox: %7.2f %7.2f %7.2f %7.2f&quot;</span>,
<a name="l00435"></a>00435             xpt, ypt, xpt + wpt, ypt + hpt);
<a name="l00436"></a>00436         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00437"></a>00437     }
<a name="l00438"></a>00438     <span class="keywordflow">else</span>    <span class="comment">/* boxflag == 1 */</span>
<a name="l00439"></a>00439         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;gsave&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00440"></a>00440 
<a name="l00441"></a>00441     <span class="keywordflow">if</span> (d == 1)
<a name="l00442"></a>00442         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00443"></a>00443               (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{1 exch sub} settransfer    %invert binary&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00444"></a>00444 
<a name="l00445"></a>00445     sprintf(bigbuf, <span class="stringliteral">&quot;/bpl %d string def         %%bpl as a string&quot;</span>, psbpl);
<a name="l00446"></a>00446     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00447"></a>00447     sprintf(bigbuf,
<a name="l00448"></a>00448            <span class="stringliteral">&quot;%7.2f %7.2f translate         %%set image origin in pts&quot;</span>, xpt, ypt);
<a name="l00449"></a>00449     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00450"></a>00450     sprintf(bigbuf,
<a name="l00451"></a>00451             <span class="stringliteral">&quot;%7.2f %7.2f scale             %%set image size in pts&quot;</span>, wpt, hpt);
<a name="l00452"></a>00452     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00453"></a>00453     sprintf(bigbuf,
<a name="l00454"></a>00454             <span class="stringliteral">&quot;%d %d %d                 %%image dimensions in pixels&quot;</span>, w, h, bps);
<a name="l00455"></a>00455     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00456"></a>00456     sprintf(bigbuf,
<a name="l00457"></a>00457             <span class="stringliteral">&quot;[%d %d %d %d %d %d]     %%mapping matrix: [w 0 0 -h 0 h]&quot;</span>,
<a name="l00458"></a>00458             w, 0, 0, -h, 0, h);
<a name="l00459"></a>00459     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00460"></a>00460 
<a name="l00461"></a>00461     <span class="keywordflow">if</span> (boxflag == 0) {
<a name="l00462"></a>00462         <span class="keywordflow">if</span> (d == 1 || d == 8)
<a name="l00463"></a>00463             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00464"></a>00464                 (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{currentfile bpl readhexstring pop} image&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00465"></a>00465         <span class="keywordflow">else</span>  <span class="comment">/* d == 32 */</span>
<a name="l00466"></a>00466             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00467"></a>00467               (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{currentfile bpl readhexstring pop} false 3 colorimage&quot;</span>,
<a name="l00468"></a>00468               <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00469"></a>00469     }
<a name="l00470"></a>00470     <span class="keywordflow">else</span> {  <span class="comment">/* boxflag == 1 */</span>
<a name="l00471"></a>00471         <span class="keywordflow">if</span> (d == 1 || d == 8)
<a name="l00472"></a>00472             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00473"></a>00473               (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{currentfile bpl readhexstring pop} bind image&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00474"></a>00474         <span class="keywordflow">else</span>  <span class="comment">/* d == 32 */</span>
<a name="l00475"></a>00475             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00476"></a>00476           (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{currentfile bpl readhexstring pop} bind false 3 colorimage&quot;</span>,
<a name="l00477"></a>00477                  <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00478"></a>00478     }
<a name="l00479"></a>00479 
<a name="l00480"></a>00480     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, hexdata, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00481"></a>00481 
<a name="l00482"></a>00482     <span class="keywordflow">if</span> (boxflag == 0)
<a name="l00483"></a>00483         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;\nshowpage&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00484"></a>00484     <span class="keywordflow">else</span>  <span class="comment">/* boxflag == 1 */</span>
<a name="l00485"></a>00485         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;\ngrestore&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00486"></a>00486 
<a name="l00487"></a>00487     <span class="keywordflow">if</span> ((outstr = <a class="code" href="leptprotos_8h.html#aa58ee6340678669b10d71c2abe2ab9a0">sarrayToString</a>(sa, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00488"></a>00488         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00489"></a>00489 
<a name="l00490"></a>00490     <a class="code" href="leptprotos_8h.html#a6bc238d36ad4599585c7de09105f83c2">sarrayDestroy</a>(&amp;sa);
<a name="l00491"></a>00491     <span class="keywordflow">return</span> outstr;
<a name="l00492"></a>00492 }
<a name="l00493"></a>00493 
<a name="l00494"></a>00494 <span class="comment"></span>
<a name="l00495"></a>00495 <span class="comment">/*!</span>
<a name="l00496"></a>00496 <span class="comment"> *  getScaledParametersPS()</span>
<a name="l00497"></a>00497 <span class="comment"> *</span>
<a name="l00498"></a>00498 <span class="comment"> *      Input:  box (&lt;optional&gt; location of image in mils; with</span>
<a name="l00499"></a>00499 <span class="comment"> *                   (x,y) being the LL corner)</span>
<a name="l00500"></a>00500 <span class="comment"> *              wpix (pix width in pixels)</span>
<a name="l00501"></a>00501 <span class="comment"> *              hpix (pix height in pixels)</span>
<a name="l00502"></a>00502 <span class="comment"> *              res (of printer; use 0 for default)</span>
<a name="l00503"></a>00503 <span class="comment"> *              scale (use 1.0 or 0.0 for no scaling) </span>
<a name="l00504"></a>00504 <span class="comment"> *              &amp;xpt (location of llx in pts)</span>
<a name="l00505"></a>00505 <span class="comment"> *              &amp;ypt (location of lly in pts)</span>
<a name="l00506"></a>00506 <span class="comment"> *              &amp;wpt (image width in pts)</span>
<a name="l00507"></a>00507 <span class="comment"> *              &amp;hpt (image height in pts)</span>
<a name="l00508"></a>00508 <span class="comment"> *      Return: void (no arg checking)</span>
<a name="l00509"></a>00509 <span class="comment"> *</span>
<a name="l00510"></a>00510 <span class="comment"> *  Notes:</span>
<a name="l00511"></a>00511 <span class="comment"> *      (1) The image is always scaled, depending on res and scale.</span>
<a name="l00512"></a>00512 <span class="comment"> *      (2) If no box, the image is centered on the page.</span>
<a name="l00513"></a>00513 <span class="comment"> *      (3) If there is a box, the image is placed within it.</span>
<a name="l00514"></a>00514 <span class="comment"> */</span>
<a name="l00515"></a>00515 <span class="keywordtype">void</span>
<a name="l00516"></a><a class="code" href="psio2_8c.html#a0e19ecf7648fb3028cffa959eff77d59">00516</a> <a class="code" href="leptprotos_8h.html#acf617b0f8a846c74a32df47df87321da">getScaledParametersPS</a>(<a class="code" href="struct_box.html">BOX</a>        *box,
<a name="l00517"></a>00517                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     wpix,
<a name="l00518"></a>00518                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     hpix,
<a name="l00519"></a>00519                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     res,
<a name="l00520"></a>00520                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>   scale,
<a name="l00521"></a>00521                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *pxpt,
<a name="l00522"></a>00522                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *pypt,
<a name="l00523"></a>00523                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *pwpt,
<a name="l00524"></a>00524                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  *phpt)
<a name="l00525"></a>00525 {
<a name="l00526"></a>00526 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    bx, by, bw, bh;
<a name="l00527"></a>00527 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  winch, hinch, xinch, yinch, fres;
<a name="l00528"></a>00528 
<a name="l00529"></a>00529     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;getScaledParametersPS&quot;</span>);
<a name="l00530"></a>00530 
<a name="l00531"></a>00531     <span class="keywordflow">if</span> (res == 0)
<a name="l00532"></a>00532         res = <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>;
<a name="l00533"></a>00533     fres = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)res;
<a name="l00534"></a>00534 
<a name="l00535"></a>00535         <span class="comment">/* Allow the PS interpreter to scale the resolution */</span>
<a name="l00536"></a>00536     <span class="keywordflow">if</span> (scale == 0.0)
<a name="l00537"></a>00537         scale = 1.0;
<a name="l00538"></a>00538     <span class="keywordflow">if</span> (scale != 1.0) {
<a name="l00539"></a>00539         fres = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)res / scale;
<a name="l00540"></a>00540         res = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)fres;
<a name="l00541"></a>00541     }
<a name="l00542"></a>00542 
<a name="l00543"></a>00543         <span class="comment">/* Limit valid resolution interval */</span>
<a name="l00544"></a>00544     <span class="keywordflow">if</span> (res &lt; MIN_RES || res &gt; <a class="code" href="psio2_8c.html#a34c5f6d115218acfcdb4084ad376e314">MAX_RES</a>) {
<a name="l00545"></a>00545         <a class="code" href="environ_8h.html#add590e3e30a10de7e26ba277898c89aa">L_WARNING_INT</a>(<span class="stringliteral">&quot;res %d out of bounds; using default res; no scaling&quot;</span>,
<a name="l00546"></a>00546                       procName, res);
<a name="l00547"></a>00547         res = <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>;
<a name="l00548"></a>00548         fres = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)res;
<a name="l00549"></a>00549     }
<a name="l00550"></a>00550 
<a name="l00551"></a>00551     <span class="keywordflow">if</span> (!box) {  <span class="comment">/* center on page */</span>
<a name="l00552"></a>00552         winch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)wpix / fres;
<a name="l00553"></a>00553         hinch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)hpix / fres;
<a name="l00554"></a>00554         xinch = (8.5 - winch) / 2.;
<a name="l00555"></a>00555         yinch = (11.0 - hinch) / 2.;
<a name="l00556"></a>00556     }
<a name="l00557"></a>00557     <span class="keywordflow">else</span> {
<a name="l00558"></a>00558         <a class="code" href="boxbasic_8c.html#aaf754e00c062c3f0f726bea73a17e646">boxGetGeometry</a>(box, &amp;bx, &amp;by, &amp;bw, &amp;bh);
<a name="l00559"></a>00559         <span class="keywordflow">if</span> (bw == 0)
<a name="l00560"></a>00560             winch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)wpix / fres;
<a name="l00561"></a>00561         <span class="keywordflow">else</span>
<a name="l00562"></a>00562             winch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)bw / 1000.;
<a name="l00563"></a>00563         <span class="keywordflow">if</span> (bh == 0)
<a name="l00564"></a>00564             hinch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)hpix / fres;
<a name="l00565"></a>00565         <span class="keywordflow">else</span>
<a name="l00566"></a>00566             hinch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)bh / 1000.;
<a name="l00567"></a>00567         xinch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)bx / 1000.;
<a name="l00568"></a>00568         yinch = (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)by / 1000.;
<a name="l00569"></a>00569     }
<a name="l00570"></a>00570 
<a name="l00571"></a>00571     <span class="keywordflow">if</span> (xinch &lt; 0)
<a name="l00572"></a>00572         <a class="code" href="environ_8h.html#a80ea4add6888dc55f0f6af9c488f1f21">L_WARNING</a>(<span class="stringliteral">&quot;left edge &lt; 0.0 inch&quot;</span>, procName);
<a name="l00573"></a>00573     <span class="keywordflow">if</span> (xinch + winch &gt; 8.5)
<a name="l00574"></a>00574         <a class="code" href="environ_8h.html#a80ea4add6888dc55f0f6af9c488f1f21">L_WARNING</a>(<span class="stringliteral">&quot;right edge &gt; 8.5 inch&quot;</span>, procName);
<a name="l00575"></a>00575     <span class="keywordflow">if</span> (yinch &lt; 0.0)
<a name="l00576"></a>00576         <a class="code" href="environ_8h.html#a80ea4add6888dc55f0f6af9c488f1f21">L_WARNING</a>(<span class="stringliteral">&quot;bottom edge &lt; 0.0 inch&quot;</span>, procName);
<a name="l00577"></a>00577     <span class="keywordflow">if</span> (yinch + hinch &gt; 11.0)
<a name="l00578"></a>00578         <a class="code" href="environ_8h.html#a80ea4add6888dc55f0f6af9c488f1f21">L_WARNING</a>(<span class="stringliteral">&quot;top edge &gt; 11.0 inch&quot;</span>, procName);
<a name="l00579"></a>00579 
<a name="l00580"></a>00580     *pwpt = 72. * winch;
<a name="l00581"></a>00581     *phpt = 72. * hinch;
<a name="l00582"></a>00582     *pxpt = 72. * xinch;
<a name="l00583"></a>00583     *pypt = 72. * yinch;
<a name="l00584"></a>00584     <span class="keywordflow">return</span>;
<a name="l00585"></a>00585 }
<a name="l00586"></a>00586     
<a name="l00587"></a>00587 <span class="comment"></span>
<a name="l00588"></a>00588 <span class="comment">/*!</span>
<a name="l00589"></a>00589 <span class="comment"> *  convertByteToHexAscii()</span>
<a name="l00590"></a>00590 <span class="comment"> *</span>
<a name="l00591"></a>00591 <span class="comment"> *      Input:  byteval  (input byte)</span>
<a name="l00592"></a>00592 <span class="comment"> *              &amp;nib1, &amp;nib2  (&lt;return&gt; two hex ascii characters)</span>
<a name="l00593"></a>00593 <span class="comment"> *      Return: void</span>
<a name="l00594"></a>00594 <span class="comment"> */</span>
<a name="l00595"></a>00595 <span class="keywordtype">void</span>
<a name="l00596"></a><a class="code" href="psio2_8c.html#a35ba12054defaf77f3cccb88c598fd3b">00596</a> <a class="code" href="leptprotos_8h.html#a28b370bc2be2685e5d26b6996554b558">convertByteToHexAscii</a>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  byteval,
<a name="l00597"></a>00597                       <span class="keywordtype">char</span>    *pnib1,
<a name="l00598"></a>00598                       <span class="keywordtype">char</span>    *pnib2)
<a name="l00599"></a>00599 {
<a name="l00600"></a>00600 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  nib;
<a name="l00601"></a>00601 
<a name="l00602"></a>00602     nib = byteval &gt;&gt; 4;
<a name="l00603"></a>00603     <span class="keywordflow">if</span> (nib &lt; 10)
<a name="l00604"></a>00604         *pnib1 = <span class="charliteral">&#39;0&#39;</span> + nib;
<a name="l00605"></a>00605     <span class="keywordflow">else</span>
<a name="l00606"></a>00606         *pnib1 = <span class="charliteral">&#39;a&#39;</span> + (nib - 10);
<a name="l00607"></a>00607     nib = byteval &amp; 0xf;
<a name="l00608"></a>00608     <span class="keywordflow">if</span> (nib &lt; 10)
<a name="l00609"></a>00609         *pnib2 = <span class="charliteral">&#39;0&#39;</span> + nib;
<a name="l00610"></a>00610     <span class="keywordflow">else</span>
<a name="l00611"></a>00611         *pnib2 = <span class="charliteral">&#39;a&#39;</span> + (nib - 10);
<a name="l00612"></a>00612 
<a name="l00613"></a>00613     <span class="keywordflow">return</span>;
<a name="l00614"></a>00614 }
<a name="l00615"></a>00615 
<a name="l00616"></a>00616 
<a name="l00617"></a>00617 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l00618"></a>00618 <span class="comment"> *                  For jpeg compressed images                 *</span>
<a name="l00619"></a>00619 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l00620"></a>00620 <span class="comment">/*!</span>
<a name="l00621"></a>00621 <span class="comment"> *  convertJpegToPSEmbed()</span>
<a name="l00622"></a>00622 <span class="comment"> *</span>
<a name="l00623"></a>00623 <span class="comment"> *      Input:  filein (input jpeg file)</span>
<a name="l00624"></a>00624 <span class="comment"> *              fileout (output ps file)</span>
<a name="l00625"></a>00625 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l00626"></a>00626 <span class="comment"> *</span>
<a name="l00627"></a>00627 <span class="comment"> *  Notes:</span>
<a name="l00628"></a>00628 <span class="comment"> *      (1) This function takes a jpeg file as input and generates a DCT</span>
<a name="l00629"></a>00629 <span class="comment"> *          compressed, ascii85 encoded PS file, with a bounding box.</span>
<a name="l00630"></a>00630 <span class="comment"> *      (2) The bounding box is required when a program such as TeX</span>
<a name="l00631"></a>00631 <span class="comment"> *          (through epsf) places and rescales the image.</span>
<a name="l00632"></a>00632 <span class="comment"> *      (3) The bounding box is sized for fitting the image to an</span>
<a name="l00633"></a>00633 <span class="comment"> *          8.5 x 11.0 inch page.</span>
<a name="l00634"></a>00634 <span class="comment"> */</span>
<a name="l00635"></a>00635 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00636"></a><a class="code" href="psio2_8c.html#a95830c7074f3bc9c0f2da648119722c9">00636</a> <a class="code" href="leptprotos_8h.html#a8af6c626edc97e40ac706f3ebde05069">convertJpegToPSEmbed</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l00637"></a>00637                      <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout)
<a name="l00638"></a>00638 {
<a name="l00639"></a>00639 <span class="keywordtype">char</span>               *outstr;
<a name="l00640"></a>00640 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             w, h, <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l00641"></a>00641 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l00642"></a>00642 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l00643"></a>00643 
<a name="l00644"></a>00644     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertJpegToPSEmbed&quot;</span>);
<a name="l00645"></a>00645 
<a name="l00646"></a>00646     <span class="keywordflow">if</span> (!filein)
<a name="l00647"></a>00647         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l00648"></a>00648     <span class="keywordflow">if</span> (!fileout)
<a name="l00649"></a>00649         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l00650"></a>00650 
<a name="l00651"></a>00651         <span class="comment">/* Generate the ascii encoded jpeg data */</span>
<a name="l00652"></a>00652     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#a31336c29ef104cfafcddd93779ed4cc4">l_generateJpegData</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00653"></a>00653         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;jpeg data not made&quot;</span>, procName, 1);
<a name="l00654"></a>00654     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l00655"></a>00655     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l00656"></a>00656 
<a name="l00657"></a>00657         <span class="comment">/* Scale for 20 pt boundary and otherwise full filling</span>
<a name="l00658"></a>00658 <span class="comment">         * in one direction on 8.5 x 11 inch device */</span>
<a name="l00659"></a>00659     xpt = 20.0;
<a name="l00660"></a>00660     ypt = 20.0;
<a name="l00661"></a>00661     <span class="keywordflow">if</span> (w * 11.0 &gt; h * 8.5) {
<a name="l00662"></a>00662         wpt = 572.0;   <span class="comment">/* 612 - 2 * 20 */</span>
<a name="l00663"></a>00663         hpt = wpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w;
<a name="l00664"></a>00664     }
<a name="l00665"></a>00665     <span class="keywordflow">else</span> {
<a name="l00666"></a>00666         hpt = 752.0;   <span class="comment">/* 792 - 2 * 20 */</span>
<a name="l00667"></a>00667         wpt = hpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h;
<a name="l00668"></a>00668     }
<a name="l00669"></a>00669 
<a name="l00670"></a>00670         <span class="comment">/* Generate the PS.</span>
<a name="l00671"></a>00671 <span class="comment">         * The bounding box information should be inserted (default). */</span>
<a name="l00672"></a>00672     outstr = <a class="code" href="leptprotos_8h.html#a70b1de53643755a6165ac885da0aa7a4">generateJpegPS</a>(filein, cid, xpt, ypt, wpt, hpt, 1, 1);
<a name="l00673"></a>00673     <span class="keywordflow">if</span> (!outstr)
<a name="l00674"></a>00674         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l00675"></a>00675     nbytes = strlen(outstr);
<a name="l00676"></a>00676 
<a name="l00677"></a>00677     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, <span class="stringliteral">&quot;w&quot;</span>, outstr, nbytes))
<a name="l00678"></a>00678         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l00679"></a>00679     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l00680"></a>00680     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l00681"></a>00681     <span class="keywordflow">return</span> 0;
<a name="l00682"></a>00682 }
<a name="l00683"></a>00683 
<a name="l00684"></a>00684 <span class="comment"></span>
<a name="l00685"></a>00685 <span class="comment">/*!</span>
<a name="l00686"></a>00686 <span class="comment"> *  convertJpegToPS()</span>
<a name="l00687"></a>00687 <span class="comment"> *</span>
<a name="l00688"></a>00688 <span class="comment"> *      Input:  filein (input jpeg file)</span>
<a name="l00689"></a>00689 <span class="comment"> *              fileout (output ps file)</span>
<a name="l00690"></a>00690 <span class="comment"> *              operation (&quot;w&quot; for write; &quot;a&quot; for append)</span>
<a name="l00691"></a>00691 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l00692"></a>00692 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l00693"></a>00693 <span class="comment"> *                    of the page)</span>
<a name="l00694"></a>00694 <span class="comment"> *              res (resolution of the input image, in ppi; use 0 for default)</span>
<a name="l00695"></a>00695 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l00696"></a>00696 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l00697"></a>00697 <span class="comment"> *                      if there is only one page)</span>
<a name="l00698"></a>00698 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l00699"></a>00699 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l00700"></a>00700 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l00701"></a>00701 <span class="comment"> *</span>
<a name="l00702"></a>00702 <span class="comment"> *  Notes:</span>
<a name="l00703"></a>00703 <span class="comment"> *      (1) This is simpler to use than pixWriteStringPS(), and</span>
<a name="l00704"></a>00704 <span class="comment"> *          it outputs in level 2 PS as compressed DCT (overlaid</span>
<a name="l00705"></a>00705 <span class="comment"> *          with ascii85 encoding).</span>
<a name="l00706"></a>00706 <span class="comment"> *      (2) An output file can contain multiple pages, each with</span>
<a name="l00707"></a>00707 <span class="comment"> *          multiple images.  The arguments to convertJpegToPS()</span>
<a name="l00708"></a>00708 <span class="comment"> *          allow you to control placement of jpeg images on multiple</span>
<a name="l00709"></a>00709 <span class="comment"> *          pages within a PostScript file.</span>
<a name="l00710"></a>00710 <span class="comment"> *      (3) For the first image written to a file, use &quot;w&quot;, which</span>
<a name="l00711"></a>00711 <span class="comment"> *          opens for write and clears the file.  For all subsequent</span>
<a name="l00712"></a>00712 <span class="comment"> *          images written to that file, use &quot;a&quot;.</span>
<a name="l00713"></a>00713 <span class="comment"> *      (4) The (x, y) parameters give the LL corner of the image</span>
<a name="l00714"></a>00714 <span class="comment"> *          relative to the LL corner of the page.  They are in</span>
<a name="l00715"></a>00715 <span class="comment"> *          units of pixels if scale = 1.0.  If you use (e.g.)</span>
<a name="l00716"></a>00716 <span class="comment"> *          scale = 2.0, the image is placed at (2x, 2y) on the page,</span>
<a name="l00717"></a>00717 <span class="comment"> *          and the image dimensions are also doubled.</span>
<a name="l00718"></a>00718 <span class="comment"> *      (5) Display vs printed resolution:</span>
<a name="l00719"></a>00719 <span class="comment"> *           * If your display is 75 ppi and your image was created</span>
<a name="l00720"></a>00720 <span class="comment"> *             at a resolution of 300 ppi, you can get the image</span>
<a name="l00721"></a>00721 <span class="comment"> *             to print at the same size as it appears on your display</span>
<a name="l00722"></a>00722 <span class="comment"> *             by either setting scale = 4.0 or by setting  res = 75.</span>
<a name="l00723"></a>00723 <span class="comment"> *             Both tell the printer to make a 4x enlarged image.</span>
<a name="l00724"></a>00724 <span class="comment"> *           * If your image is generated at 150 ppi and you use scale = 1,</span>
<a name="l00725"></a>00725 <span class="comment"> *             it will be rendered such that 150 pixels correspond</span>
<a name="l00726"></a>00726 <span class="comment"> *             to 72 pts (1 inch on the printer).  This function does</span>
<a name="l00727"></a>00727 <span class="comment"> *             the conversion from pixels (with or without scaling) to</span>
<a name="l00728"></a>00728 <span class="comment"> *             pts, which are the units that the printer uses.</span>
<a name="l00729"></a>00729 <span class="comment"> *           * The printer will choose its own resolution to use</span>
<a name="l00730"></a>00730 <span class="comment"> *             in rendering the image, which will not affect the size</span>
<a name="l00731"></a>00731 <span class="comment"> *             of the rendered image.  That is because the output</span>
<a name="l00732"></a>00732 <span class="comment"> *             PostScript file describes the geometry in terms of pts,</span>
<a name="l00733"></a>00733 <span class="comment"> *             which are defined to be 1/72 inch.  The printer will</span>
<a name="l00734"></a>00734 <span class="comment"> *             only see the size of the image in pts, through the</span>
<a name="l00735"></a>00735 <span class="comment"> *             scale and translate parameters and the affine</span>
<a name="l00736"></a>00736 <span class="comment"> *             transform (the ImageMatrix) of the image.</span>
<a name="l00737"></a>00737 <span class="comment"> *      (6) To render multiple images on the same page, set</span>
<a name="l00738"></a>00738 <span class="comment"> *          endpage = FALSE for each image until you get to the</span>
<a name="l00739"></a>00739 <span class="comment"> *          last, for which you set endpage = TRUE.  This causes the</span>
<a name="l00740"></a>00740 <span class="comment"> *          &quot;showpage&quot; command to be invoked.  Showpage outputs</span>
<a name="l00741"></a>00741 <span class="comment"> *          the entire page and clears the raster buffer for the</span>
<a name="l00742"></a>00742 <span class="comment"> *          next page to be added.  Without a &quot;showpage&quot;,</span>
<a name="l00743"></a>00743 <span class="comment"> *          subsequent images from the next page will overlay those</span>
<a name="l00744"></a>00744 <span class="comment"> *          previously put down.</span>
<a name="l00745"></a>00745 <span class="comment"> *      (7) For multiple pages, increment the page number, starting</span>
<a name="l00746"></a>00746 <span class="comment"> *          with page 1.  This allows PostScript (and PDF) to build</span>
<a name="l00747"></a>00747 <span class="comment"> *          a page directory, which viewers use for navigation.</span>
<a name="l00748"></a>00748 <span class="comment"> */</span>
<a name="l00749"></a>00749 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00750"></a><a class="code" href="psio2_8c.html#a8874aa3a311b0a44b5b82068074c8517">00750</a> <a class="code" href="leptprotos_8h.html#a02ec6e86654c38e700c9f07010dd95a3">convertJpegToPS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l00751"></a>00751                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout,
<a name="l00752"></a>00752                 <span class="keyword">const</span> <span class="keywordtype">char</span>  *operation,
<a name="l00753"></a>00753                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l00754"></a>00754                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l00755"></a>00755                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l00756"></a>00756                 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l00757"></a>00757                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l00758"></a>00758                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l00759"></a>00759 {
<a name="l00760"></a>00760 <span class="keywordtype">char</span>    *outstr;
<a name="l00761"></a>00761 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l00762"></a>00762 
<a name="l00763"></a>00763     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertJpegToPS&quot;</span>);
<a name="l00764"></a>00764 
<a name="l00765"></a>00765     <span class="keywordflow">if</span> (!filein)
<a name="l00766"></a>00766         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l00767"></a>00767     <span class="keywordflow">if</span> (!fileout)
<a name="l00768"></a>00768         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l00769"></a>00769     <span class="keywordflow">if</span> (strcmp(operation, <span class="stringliteral">&quot;w&quot;</span>) &amp;&amp; strcmp(operation, <span class="stringliteral">&quot;a&quot;</span>))
<a name="l00770"></a>00770         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;operation must be \&quot;w\&quot; or \&quot;a\&quot;&quot;</span>, procName, 1);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a37e0690b7ffcbc37d7f02565aff2abf3">convertJpegToPSString</a>(filein, &amp;outstr, &amp;nbytes, x, y, res, scale,
<a name="l00773"></a>00773                           pageno, endpage))
<a name="l00774"></a>00774         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not made&quot;</span>, procName, 1);
<a name="l00775"></a>00775 
<a name="l00776"></a>00776     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, operation, outstr, nbytes))
<a name="l00777"></a>00777         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l00778"></a>00778 
<a name="l00779"></a>00779     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l00780"></a>00780     <span class="keywordflow">return</span> 0;
<a name="l00781"></a>00781 }
<a name="l00782"></a>00782 
<a name="l00783"></a>00783 <span class="comment"></span>
<a name="l00784"></a>00784 <span class="comment">/*!</span>
<a name="l00785"></a>00785 <span class="comment"> *  convertJpegToPSString()</span>
<a name="l00786"></a>00786 <span class="comment"> *</span>
<a name="l00787"></a>00787 <span class="comment"> *      Generates PS string in jpeg format from jpeg file</span>
<a name="l00788"></a>00788 <span class="comment"> *</span>
<a name="l00789"></a>00789 <span class="comment"> *      Input:  filein (input jpeg file)</span>
<a name="l00790"></a>00790 <span class="comment"> *              &amp;poutstr (&lt;return&gt; PS string)</span>
<a name="l00791"></a>00791 <span class="comment"> *              &amp;nbytes (&lt;return&gt; number of bytes in PS string)</span>
<a name="l00792"></a>00792 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l00793"></a>00793 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l00794"></a>00794 <span class="comment"> *                    of the page)</span>
<a name="l00795"></a>00795 <span class="comment"> *              res (resolution of the input image, in ppi; use 0 for default)</span>
<a name="l00796"></a>00796 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l00797"></a>00797 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l00798"></a>00798 <span class="comment"> *                      if there is only one page)</span>
<a name="l00799"></a>00799 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l00800"></a>00800 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l00801"></a>00801 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l00802"></a>00802 <span class="comment"> *</span>
<a name="l00803"></a>00803 <span class="comment"> *  Notes:</span>
<a name="l00804"></a>00804 <span class="comment"> *      (1) For usage, see convertJpegToPS()</span>
<a name="l00805"></a>00805 <span class="comment"> */</span>
<a name="l00806"></a>00806 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l00807"></a><a class="code" href="psio2_8c.html#ae2bba133c192ad37abffb1a932b888a4">00807</a> <a class="code" href="leptprotos_8h.html#a37e0690b7ffcbc37d7f02565aff2abf3">convertJpegToPSString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l00808"></a>00808                       <span class="keywordtype">char</span>       **poutstr,
<a name="l00809"></a>00809                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     *pnbytes,
<a name="l00810"></a>00810                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l00811"></a>00811                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l00812"></a>00812                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l00813"></a>00813                       <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l00814"></a>00814                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l00815"></a>00815                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l00816"></a>00816 {
<a name="l00817"></a>00817 <span class="keywordtype">char</span>               *outstr;
<a name="l00818"></a>00818 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l00819"></a>00819 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l00820"></a>00820 
<a name="l00821"></a>00821     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertJpegToPSString&quot;</span>);
<a name="l00822"></a>00822 
<a name="l00823"></a>00823     <span class="keywordflow">if</span> (!poutstr)
<a name="l00824"></a>00824         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;outstr not defined&quot;</span>, procName, 1);
<a name="l00825"></a>00825     <span class="keywordflow">if</span> (!pnbytes)
<a name="l00826"></a>00826         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;nbytes not defined&quot;</span>, procName, 1);
<a name="l00827"></a>00827     *poutstr = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l00828"></a>00828     *pnbytes = 0;
<a name="l00829"></a>00829     <span class="keywordflow">if</span> (!filein)
<a name="l00830"></a>00830         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l00831"></a>00831 
<a name="l00832"></a>00832         <span class="comment">/* Generate the ascii encoded jpeg data */</span>
<a name="l00833"></a>00833     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#a31336c29ef104cfafcddd93779ed4cc4">l_generateJpegData</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00834"></a>00834         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;jpeg data not made&quot;</span>, procName, 1);
<a name="l00835"></a>00835 
<a name="l00836"></a>00836         <span class="comment">/* Get scaled location in pts.  Guess the input scan resolution</span>
<a name="l00837"></a>00837 <span class="comment">         * based on the input parameter @res, the resolution data in</span>
<a name="l00838"></a>00838 <span class="comment">         * the pix, and the size of the image. */</span>
<a name="l00839"></a>00839     <span class="keywordflow">if</span> (scale == 0.0)
<a name="l00840"></a>00840         scale = 1.0;
<a name="l00841"></a>00841     <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l00842"></a>00842         <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> &gt; 0)
<a name="l00843"></a>00843             res = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a>;
<a name="l00844"></a>00844         <span class="keywordflow">else</span>
<a name="l00845"></a>00845             res = <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>;
<a name="l00846"></a>00846     }
<a name="l00847"></a>00847 
<a name="l00848"></a>00848         <span class="comment">/* Get scaled location in pts */</span>
<a name="l00849"></a>00849     <span class="keywordflow">if</span> (scale == 0.0)
<a name="l00850"></a>00850         scale = 1.0;
<a name="l00851"></a>00851     <span class="keywordflow">if</span> (res == 0)
<a name="l00852"></a>00852         res = <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>;
<a name="l00853"></a>00853     xpt = scale * x * 72. / res;
<a name="l00854"></a>00854     ypt = scale * y * 72. / res;
<a name="l00855"></a>00855     wpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> * 72. / res;
<a name="l00856"></a>00856     hpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> * 72. / res;
<a name="l00857"></a>00857 
<a name="l00858"></a>00858     <span class="keywordflow">if</span> (pageno == 0)
<a name="l00859"></a>00859         pageno = 1;
<a name="l00860"></a>00860 
<a name="l00861"></a>00861 <span class="preprocessor">#if  DEBUG_JPEG</span>
<a name="l00862"></a>00862 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;w = %d, h = %d, bps = %d, spp = %d\n&quot;</span>,
<a name="l00863"></a>00863             cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a>);
<a name="l00864"></a>00864     fprintf(stderr, <span class="stringliteral">&quot;comp bytes = %d, nbytes85 = %d, ratio = %5.3f\n&quot;</span>,
<a name="l00865"></a>00865            cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a>,
<a name="l00866"></a>00866            (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a> / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a>);
<a name="l00867"></a>00867     fprintf(stderr, <span class="stringliteral">&quot;xpt = %7.2f, ypt = %7.2f, wpt = %7.2f, hpt = %7.2f\n&quot;</span>,
<a name="l00868"></a>00868              xpt, ypt, wpt, hpt);
<a name="l00869"></a>00869 <span class="preprocessor">#endif   </span><span class="comment">/* DEBUG_JPEG */</span>
<a name="l00870"></a>00870 
<a name="l00871"></a>00871         <span class="comment">/* Generate the PS */</span>
<a name="l00872"></a>00872     outstr = <a class="code" href="leptprotos_8h.html#a70b1de53643755a6165ac885da0aa7a4">generateJpegPS</a>(filein, cid, xpt, ypt, wpt, hpt, pageno, endpage);
<a name="l00873"></a>00873     <span class="keywordflow">if</span> (!outstr)
<a name="l00874"></a>00874         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l00875"></a>00875     *poutstr = outstr;
<a name="l00876"></a>00876     *pnbytes = strlen(outstr);
<a name="l00877"></a>00877     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l00878"></a>00878     <span class="keywordflow">return</span> 0;
<a name="l00879"></a>00879 }
<a name="l00880"></a>00880 
<a name="l00881"></a>00881 <span class="comment"></span>
<a name="l00882"></a>00882 <span class="comment">/*!</span>
<a name="l00883"></a>00883 <span class="comment"> *  generateJpegPS()</span>
<a name="l00884"></a>00884 <span class="comment"> *</span>
<a name="l00885"></a>00885 <span class="comment"> *      Input:  filein (&lt;optional&gt; input jpeg filename; can be null)</span>
<a name="l00886"></a>00886 <span class="comment"> *              cid (jpeg compressed image data)</span>
<a name="l00887"></a>00887 <span class="comment"> *              xpt, ypt (location of LL corner of image, in pts, relative</span>
<a name="l00888"></a>00888 <span class="comment"> *                        to the PostScript origin (0,0) at the LL corner</span>
<a name="l00889"></a>00889 <span class="comment"> *                        of the page)</span>
<a name="l00890"></a>00890 <span class="comment"> *              wpt, hpt (rendered image size in pts)</span>
<a name="l00891"></a>00891 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l00892"></a>00892 <span class="comment"> *                      if there is only one page.)</span>
<a name="l00893"></a>00893 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l00894"></a>00894 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l00895"></a>00895 <span class="comment"> *      Return: PS string, or null on error</span>
<a name="l00896"></a>00896 <span class="comment"> *</span>
<a name="l00897"></a>00897 <span class="comment"> *  Notes:</span>
<a name="l00898"></a>00898 <span class="comment"> *      (1) Low-level function.</span>
<a name="l00899"></a>00899 <span class="comment"> */</span>
<a name="l00900"></a>00900 <span class="keywordtype">char</span> *
<a name="l00901"></a><a class="code" href="psio2_8c.html#ab1cc763a87036589ae74403d5adc698a">00901</a> <a class="code" href="leptprotos_8h.html#a70b1de53643755a6165ac885da0aa7a4">generateJpegPS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>         *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l00902"></a>00902                <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid,
<a name="l00903"></a>00903                <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt,
<a name="l00904"></a>00904                <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           ypt,
<a name="l00905"></a>00905                <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           wpt,
<a name="l00906"></a>00906                <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           hpt,
<a name="l00907"></a>00907                <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             pageno,
<a name="l00908"></a>00908                <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             endpage)
<a name="l00909"></a>00909 {
<a name="l00910"></a>00910 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  w, h, bps, spp;
<a name="l00911"></a>00911 <span class="keywordtype">char</span>    *outstr;
<a name="l00912"></a>00912 <span class="keywordtype">char</span>     bigbuf[<a class="code" href="psio2_8c.html#af1791633b3a1a12a9aa449aa6d558327">L_BUF_SIZE</a>];
<a name="l00913"></a>00913 <a class="code" href="struct_sarray.html">SARRAY</a>  *sa;
<a name="l00914"></a>00914 
<a name="l00915"></a>00915     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;generateJpegPS&quot;</span>);
<a name="l00916"></a>00916 
<a name="l00917"></a>00917     <span class="keywordflow">if</span> (!cid)
<a name="l00918"></a>00918         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;jpeg data not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00919"></a>00919     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l00920"></a>00920     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l00921"></a>00921     bps = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a>;
<a name="l00922"></a>00922     spp = cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a>;
<a name="l00923"></a>00923 
<a name="l00924"></a>00924     <span class="keywordflow">if</span> ((sa = <a class="code" href="leptprotos_8h.html#ad131504b407cbc1aaa1b18e59945d9a5">sarrayCreate</a>(50)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l00925"></a>00925         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;sa not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l00926"></a>00926 
<a name="l00927"></a>00927     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%!PS-Adobe-3.0&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00928"></a>00928     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%Creator: leptonica&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00929"></a>00929     <span class="keywordflow">if</span> (filein) {
<a name="l00930"></a>00930         sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Title: %s&quot;</span>, filein);
<a name="l00931"></a>00931         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00932"></a>00932     }
<a name="l00933"></a>00933     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%DocumentData: Clean7Bit&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00934"></a>00934 
<a name="l00935"></a>00935     <span class="keywordflow">if</span> (<a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">var_PS_WRITE_BOUNDING_BOX</a> == 1) {
<a name="l00936"></a>00936         sprintf(bigbuf,
<a name="l00937"></a>00937             <span class="stringliteral">&quot;%%%%BoundingBox: %7.2f %7.2f %7.2f %7.2f&quot;</span>,
<a name="l00938"></a>00938                        xpt, ypt, xpt + wpt, ypt + hpt);
<a name="l00939"></a>00939         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00940"></a>00940     }
<a name="l00941"></a>00941 
<a name="l00942"></a>00942     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%LanguageLevel: 2&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00943"></a>00943     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%EndComments&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00944"></a>00944     sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Page: %d %d&quot;</span>, pageno, pageno);
<a name="l00945"></a>00945     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00946"></a>00946 
<a name="l00947"></a>00947     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;save&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00948"></a>00948     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00949"></a>00949            (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/RawData currentfile /ASCII85Decode filter def&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00950"></a>00950     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l00951"></a>00951            (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/Data RawData &lt;&lt; &gt;&gt; /DCTDecode filter def&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00952"></a>00952 
<a name="l00953"></a>00953     sprintf(bigbuf,
<a name="l00954"></a>00954         <span class="stringliteral">&quot;%7.2f %7.2f translate         %%set image origin in pts&quot;</span>, xpt, ypt);
<a name="l00955"></a>00955     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00956"></a>00956 
<a name="l00957"></a>00957     sprintf(bigbuf,
<a name="l00958"></a>00958         <span class="stringliteral">&quot;%7.2f %7.2f scale             %%set image size in pts&quot;</span>, wpt, hpt);
<a name="l00959"></a>00959     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00960"></a>00960 
<a name="l00961"></a>00961     <span class="keywordflow">if</span> (spp == 1)
<a name="l00962"></a>00962         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceGray setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00963"></a>00963     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spp == 3)
<a name="l00964"></a>00964         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceRGB setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00965"></a>00965     <span class="keywordflow">else</span>  <span class="comment">/*spp == 4 */</span>
<a name="l00966"></a>00966         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceCMYK setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00967"></a>00967 
<a name="l00968"></a>00968     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{ &lt;&lt; /ImageType 1&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00969"></a>00969     sprintf(bigbuf, <span class="stringliteral">&quot;     /Width %d&quot;</span>, w);
<a name="l00970"></a>00970     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00971"></a>00971     sprintf(bigbuf, <span class="stringliteral">&quot;     /Height %d&quot;</span>, h);
<a name="l00972"></a>00972     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00973"></a>00973     sprintf(bigbuf, <span class="stringliteral">&quot;     /ImageMatrix [ %d 0 0 %d 0 %d ]&quot;</span>, w, -h, h);
<a name="l00974"></a>00974     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00975"></a>00975     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /DataSource Data&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00976"></a>00976     sprintf(bigbuf, <span class="stringliteral">&quot;     /BitsPerComponent %d&quot;</span>, bps);
<a name="l00977"></a>00977     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00978"></a>00978 
<a name="l00979"></a>00979     <span class="keywordflow">if</span> (spp == 1)
<a name="l00980"></a>00980         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00981"></a>00981     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spp == 3)
<a name="l00982"></a>00982         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 1 0 1 0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00983"></a>00983     <span class="keywordflow">else</span>   <span class="comment">/* spp == 4 */</span>
<a name="l00984"></a>00984         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 1 0 1 0 1 0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00985"></a>00985 
<a name="l00986"></a>00986     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &gt;&gt; image&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00987"></a>00987     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  Data closefile&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00988"></a>00988     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  RawData flushfile&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00989"></a>00989     <span class="keywordflow">if</span> (endpage == <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l00990"></a>00990         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  showpage&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00991"></a>00991     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  restore&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00992"></a>00992     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;} exec&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l00993"></a>00993 
<a name="l00994"></a>00994         <span class="comment">/* Insert the ascii85 jpeg data; this is now owned by sa */</span>
<a name="l00995"></a>00995     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l00996"></a>00996     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* it has been transferred and destroyed */</span>
<a name="l00997"></a>00997 
<a name="l00998"></a>00998         <span class="comment">/* Generate and return the output string */</span>
<a name="l00999"></a>00999     outstr = <a class="code" href="leptprotos_8h.html#aa58ee6340678669b10d71c2abe2ab9a0">sarrayToString</a>(sa, 1);
<a name="l01000"></a>01000     <a class="code" href="leptprotos_8h.html#a6bc238d36ad4599585c7de09105f83c2">sarrayDestroy</a>(&amp;sa);
<a name="l01001"></a>01001     <span class="keywordflow">return</span> outstr;
<a name="l01002"></a>01002 }
<a name="l01003"></a>01003 
<a name="l01004"></a>01004 <span class="comment"></span>
<a name="l01005"></a>01005 <span class="comment">/*!</span>
<a name="l01006"></a>01006 <span class="comment"> *  pixGenerateJpegData()</span>
<a name="l01007"></a>01007 <span class="comment"> *</span>
<a name="l01008"></a>01008 <span class="comment"> *      Input:  pixs (8 or 32 bpp, no colormap)</span>
<a name="l01009"></a>01009 <span class="comment"> *              ascii85flag (0 for jpeg; 1 for ascii85-encoded jpeg)</span>
<a name="l01010"></a>01010 <span class="comment"> *              quality (0 for default, which is 75)</span>
<a name="l01011"></a>01011 <span class="comment"> *      Return: cid (jpeg compressed data), or null on error</span>
<a name="l01012"></a>01012 <span class="comment"> *</span>
<a name="l01013"></a>01013 <span class="comment"> *  Notes:</span>
<a name="l01014"></a>01014 <span class="comment"> *      (1) Set ascii85flag:</span>
<a name="l01015"></a>01015 <span class="comment"> *           - 0 for binary data (not permitted in PostScript)</span>
<a name="l01016"></a>01016 <span class="comment"> *           - 1 for ascii85 (5 for 4) encoded binary data</span>
<a name="l01017"></a>01017 <span class="comment"> */</span>
<a name="l01018"></a>01018 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l01019"></a><a class="code" href="psio2_8c.html#a5c32859758bd16cfb14523c91d61dcd8">01019</a> <a class="code" href="leptprotos_8h.html#a3844e214f7d55d6afbe2d21f012a222f">pixGenerateJpegData</a>(<a class="code" href="struct_pix.html">PIX</a>     *pixs,
<a name="l01020"></a>01020                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ascii85flag,
<a name="l01021"></a>01021                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  quality)
<a name="l01022"></a>01022 {
<a name="l01023"></a>01023 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             d;
<a name="l01024"></a>01024 <span class="keywordtype">char</span>               *tname;
<a name="l01025"></a>01025 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01026"></a>01026 
<a name="l01027"></a>01027     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixGenerateJpegData&quot;</span>);
<a name="l01028"></a>01028 
<a name="l01029"></a>01029     <span class="keywordflow">if</span> (!pixs)
<a name="l01030"></a>01030         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not defined&quot;</span>,
<a name="l01031"></a>01031                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01032"></a>01032     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a6c959f1c381ebe5a4abc867a3d8ae1e6">pixGetColormap</a>(pixs))
<a name="l01033"></a>01033         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs has colormap&quot;</span>,
<a name="l01034"></a>01034                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01035"></a>01035     d = <a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pixs);
<a name="l01036"></a>01036     <span class="keywordflow">if</span> (d != 8 &amp;&amp; d != 32)
<a name="l01037"></a>01037         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not 8 or 32 bpp&quot;</span>,
<a name="l01038"></a>01038                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01039"></a>01039 
<a name="l01040"></a>01040         <span class="comment">/* Compress to a temp jpeg file */</span>
<a name="l01041"></a>01041     tname = <a class="code" href="leptprotos_8h.html#a42aaf4f1511e9cb01e7f6c7b5ddf12a6">genTempFilename</a>(<span class="stringliteral">&quot;/tmp&quot;</span>, <span class="stringliteral">&quot;temp.jpg&quot;</span>, 1, 1);
<a name="l01042"></a>01042     <a class="code" href="jpegio_8c.html#a2f03a58879e0d6eaba5f42b3003342ff">pixWriteJpeg</a>(tname, pixs, quality, 0);
<a name="l01043"></a>01043 
<a name="l01044"></a>01044     cid = <a class="code" href="leptprotos_8h.html#a31336c29ef104cfafcddd93779ed4cc4">l_generateJpegData</a>(tname, ascii85flag);
<a name="l01045"></a>01045     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(tname);
<a name="l01046"></a>01046     <span class="keywordflow">return</span> cid;
<a name="l01047"></a>01047 }
<a name="l01048"></a>01048 
<a name="l01049"></a>01049 <span class="comment"></span>
<a name="l01050"></a>01050 <span class="comment">/*!</span>
<a name="l01051"></a>01051 <span class="comment"> *  l_generateJpegData()</span>
<a name="l01052"></a>01052 <span class="comment"> *</span>
<a name="l01053"></a>01053 <span class="comment"> *      Input:  fname (of jpeg file)</span>
<a name="l01054"></a>01054 <span class="comment"> *              ascii85flag (0 for jpeg; 1 for ascii85-encoded jpeg)</span>
<a name="l01055"></a>01055 <span class="comment"> *      Return: cid (containing jpeg data), or null on error</span>
<a name="l01056"></a>01056 <span class="comment"> *</span>
<a name="l01057"></a>01057 <span class="comment"> *  Notes:</span>
<a name="l01058"></a>01058 <span class="comment"> *      (1) Set ascii85flag:</span>
<a name="l01059"></a>01059 <span class="comment"> *           - 0 for binary data (not permitted in PostScript)</span>
<a name="l01060"></a>01060 <span class="comment"> *           - 1 for ascii85 (5 for 4) encoded binary data</span>
<a name="l01061"></a>01061 <span class="comment"> */</span>
<a name="l01062"></a>01062 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l01063"></a><a class="code" href="psio2_8c.html#ae3c23449af210b5a743d55f3f5b07ebd">01063</a> <a class="code" href="leptprotos_8h.html#a31336c29ef104cfafcddd93779ed4cc4">l_generateJpegData</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fname,
<a name="l01064"></a>01064                    <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      ascii85flag)
<a name="l01065"></a>01065 {
<a name="l01066"></a>01066 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>            *datacomp = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* entire jpeg compressed file */</span>
<a name="l01067"></a>01067 <span class="keywordtype">char</span>               *data85 = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* ascii85 encoded jpeg compressed file */</span>
<a name="l01068"></a>01068 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             w, h, xres, yres, bps, spp;
<a name="l01069"></a>01069 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             nbytes85;
<a name="l01070"></a>01070 <span class="keywordtype">size_t</span>              nbytescomp;
<a name="l01071"></a>01071 FILE               *fp;
<a name="l01072"></a>01072 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01073"></a>01073 
<a name="l01074"></a>01074     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;l_generateJpegData&quot;</span>);
<a name="l01075"></a>01075 
<a name="l01076"></a>01076     <span class="keywordflow">if</span> (!fname)
<a name="l01077"></a>01077         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fname not defined&quot;</span>,
<a name="l01078"></a>01078                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01079"></a>01079 
<a name="l01080"></a>01080         <span class="comment">/* The returned jpeg data in memory is the entire jpeg file,</span>
<a name="l01081"></a>01081 <span class="comment">         * which starts with ffd8 and ends with ffd9 */</span>
<a name="l01082"></a>01082     <span class="keywordflow">if</span> ((datacomp = <a class="code" href="leptprotos_8h.html#a3c6cc030405a520b5ad850c80c9211ae">l_binaryRead</a>(fname, &amp;nbytescomp)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01083"></a>01083         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;datacomp not extracted&quot;</span>,
<a name="l01084"></a>01084                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01085"></a>01085 
<a name="l01086"></a>01086         <span class="comment">/* Read the metadata */</span>
<a name="l01087"></a>01087     <span class="keywordflow">if</span> ((fp = <a class="code" href="leptprotos_8h.html#a1796abf2eefccf7f0d3d2cc99f946979">fopenReadStream</a>(fname)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01088"></a>01088         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;stream not opened&quot;</span>,
<a name="l01089"></a>01089                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01090"></a>01090     <a class="code" href="jpegio_8c.html#a3945d4f9598087557683965d5e78857b">freadHeaderJpeg</a>(fp, &amp;w, &amp;h, &amp;spp, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01091"></a>01091     bps = 8;
<a name="l01092"></a>01092     <a class="code" href="jpegio_8c.html#ac673376f1ed19b64dd0d24547e1af049">fgetJpegResolution</a>(fp, &amp;xres, &amp;yres);
<a name="l01093"></a>01093     fclose(fp);
<a name="l01094"></a>01094 
<a name="l01095"></a>01095         <span class="comment">/* Optionally, encode the compressed data */</span>
<a name="l01096"></a>01096     <span class="keywordflow">if</span> (ascii85flag == 1) {
<a name="l01097"></a>01097         data85 = <a class="code" href="leptprotos_8h.html#a38ccddb3da59b9e5076f6eb845ad84fd">encodeAscii85</a>(datacomp, nbytescomp, &amp;nbytes85);
<a name="l01098"></a>01098         <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(datacomp);
<a name="l01099"></a>01099         <span class="keywordflow">if</span> (!data85)
<a name="l01100"></a>01100             <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;data85 not made&quot;</span>,
<a name="l01101"></a>01101                                                   procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01102"></a>01102         <span class="keywordflow">else</span>
<a name="l01103"></a>01103             data85[nbytes85 - 1] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* remove the newline */</span>
<a name="l01104"></a>01104     }
<a name="l01105"></a>01105 
<a name="l01106"></a>01106     cid = (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(1, <span class="keyword">sizeof</span>(<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>));
<a name="l01107"></a>01107     <span class="keywordflow">if</span> (!cid)
<a name="l01108"></a>01108         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;cid not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01109"></a>01109     <span class="keywordflow">if</span> (ascii85flag == 0)
<a name="l01110"></a>01110         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a3e4fc387d70ba9a7afd286d397376bdc">datacomp</a> = datacomp;
<a name="l01111"></a>01111     <span class="keywordflow">else</span> {  <span class="comment">/* ascii85 */</span>
<a name="l01112"></a>01112         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = data85;
<a name="l01113"></a>01113         cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a> = nbytes85;
<a name="l01114"></a>01114     }
<a name="l01115"></a>01115     cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab0cc53bf28df7259b556c486f08498e1">type</a> = <a class="code" href="imageio_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57ada600ba550d13c25bcce9e75021eca34">L_JPEG_ENCODE</a>;
<a name="l01116"></a>01116     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a> = nbytescomp;
<a name="l01117"></a>01117     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> = w;
<a name="l01118"></a>01118     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> = h;
<a name="l01119"></a>01119     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a> = bps;
<a name="l01120"></a>01120     cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a> = spp;
<a name="l01121"></a>01121     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> = xres;
<a name="l01122"></a>01122     <span class="keywordflow">return</span> cid;
<a name="l01123"></a>01123 }
<a name="l01124"></a>01124 
<a name="l01125"></a>01125 <span class="comment"></span>
<a name="l01126"></a>01126 <span class="comment">/*!</span>
<a name="l01127"></a>01127 <span class="comment"> *  compressed_dataDestroy()</span>
<a name="l01128"></a>01128 <span class="comment"> *</span>
<a name="l01129"></a>01129 <span class="comment"> *      Input:  &amp;cid (&lt;will be set to null before returning&gt;)</span>
<a name="l01130"></a>01130 <span class="comment"> *      Return: void</span>
<a name="l01131"></a>01131 <span class="comment"> */</span>
<a name="l01132"></a>01132 <span class="keywordtype">void</span>
<a name="l01133"></a><a class="code" href="psio2_8c.html#a86fb6c178db4cc0dd26e7b47ebe0dfd8">01133</a> <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  **pcid)
<a name="l01134"></a>01134 {
<a name="l01135"></a>01135 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01136"></a>01136 
<a name="l01137"></a>01137     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;compressed_dataDestroy&quot;</span>);
<a name="l01138"></a>01138 
<a name="l01139"></a>01139     <span class="keywordflow">if</span> (pcid == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>) {
<a name="l01140"></a>01140         <a class="code" href="environ_8h.html#a80ea4add6888dc55f0f6af9c488f1f21">L_WARNING</a>(<span class="stringliteral">&quot;ptr address is null!&quot;</span>, procName);
<a name="l01141"></a>01141         <span class="keywordflow">return</span>;
<a name="l01142"></a>01142     }
<a name="l01143"></a>01143     <span class="keywordflow">if</span> ((cid = *pcid) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01144"></a>01144         <span class="keywordflow">return</span>;
<a name="l01145"></a>01145 
<a name="l01146"></a>01146     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a3e4fc387d70ba9a7afd286d397376bdc">datacomp</a>) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cid-&gt;<a class="code" href="struct_l___compressed___data.html#a3e4fc387d70ba9a7afd286d397376bdc">datacomp</a>);
<a name="l01147"></a>01147     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a>) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a>);
<a name="l01148"></a>01148     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a>) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a>);
<a name="l01149"></a>01149     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a2ec10c008922e65fd5256a26646b5e71">cmapdatahex</a>) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cid-&gt;<a class="code" href="struct_l___compressed___data.html#a2ec10c008922e65fd5256a26646b5e71">cmapdatahex</a>);
<a name="l01150"></a>01150     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cid);
<a name="l01151"></a>01151     *pcid = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01152"></a>01152     <span class="keywordflow">return</span>;
<a name="l01153"></a>01153 }
<a name="l01154"></a>01154 
<a name="l01155"></a>01155 
<a name="l01156"></a>01156 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l01157"></a>01157 <span class="comment"> *                  For ccitt g4 compressed images             *</span>
<a name="l01158"></a>01158 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l01159"></a>01159 <span class="comment">/*!</span>
<a name="l01160"></a>01160 <span class="comment"> *  convertG4ToPSEmbed()</span>
<a name="l01161"></a>01161 <span class="comment"> *</span>
<a name="l01162"></a>01162 <span class="comment"> *      Input:  filein (input tiff file)</span>
<a name="l01163"></a>01163 <span class="comment"> *              fileout (output ps file)</span>
<a name="l01164"></a>01164 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01165"></a>01165 <span class="comment"> *</span>
<a name="l01166"></a>01166 <span class="comment"> *  Notes:</span>
<a name="l01167"></a>01167 <span class="comment"> *      (1) This function takes a g4 compressed tif file as input and</span>
<a name="l01168"></a>01168 <span class="comment"> *          generates a g4 compressed, ascii85 encoded PS file, with</span>
<a name="l01169"></a>01169 <span class="comment"> *          a bounding box.</span>
<a name="l01170"></a>01170 <span class="comment"> *      (2) The bounding box is required when a program such as TeX</span>
<a name="l01171"></a>01171 <span class="comment"> *          (through epsf) places and rescales the image.</span>
<a name="l01172"></a>01172 <span class="comment"> *      (3) The bounding box is sized for fitting the image to an</span>
<a name="l01173"></a>01173 <span class="comment"> *          8.5 x 11.0 inch page.</span>
<a name="l01174"></a>01174 <span class="comment"> *      (4) We paint this through a mask, over whatever is below.</span>
<a name="l01175"></a>01175 <span class="comment"> */</span>
<a name="l01176"></a>01176 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01177"></a><a class="code" href="psio2_8c.html#adae3ff6bc2685fd8ab8206b4a2c88f06">01177</a> <a class="code" href="leptprotos_8h.html#abcab3cc798d2300dd5cd479ea8b40e47">convertG4ToPSEmbed</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01178"></a>01178                    <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout)
<a name="l01179"></a>01179 {
<a name="l01180"></a>01180 <span class="keywordtype">char</span>               *outstr;
<a name="l01181"></a>01181 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             w, h, <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l01182"></a>01182 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l01183"></a>01183 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01184"></a>01184 
<a name="l01185"></a>01185     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertG4ToPSEmbed&quot;</span>);
<a name="l01186"></a>01186 
<a name="l01187"></a>01187     <span class="keywordflow">if</span> (!filein)
<a name="l01188"></a>01188         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01189"></a>01189     <span class="keywordflow">if</span> (!fileout)
<a name="l01190"></a>01190         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l01191"></a>01191 
<a name="l01192"></a>01192     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#afa7929f2654d669d6ecaed25700972d3">l_generateG4Data</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01193"></a>01193         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;g4 data not made&quot;</span>, procName, 1);
<a name="l01194"></a>01194     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l01195"></a>01195     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l01196"></a>01196 
<a name="l01197"></a>01197         <span class="comment">/* Scale for 20 pt boundary and otherwise full filling</span>
<a name="l01198"></a>01198 <span class="comment">         * in one direction on 8.5 x 11 inch device */</span>
<a name="l01199"></a>01199     xpt = 20.0;
<a name="l01200"></a>01200     ypt = 20.0;
<a name="l01201"></a>01201     <span class="keywordflow">if</span> (w * 11.0 &gt; h * 8.5) {
<a name="l01202"></a>01202         wpt = 572.0;   <span class="comment">/* 612 - 2 * 20 */</span>
<a name="l01203"></a>01203         hpt = wpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w;
<a name="l01204"></a>01204     }
<a name="l01205"></a>01205     <span class="keywordflow">else</span> {
<a name="l01206"></a>01206         hpt = 752.0;   <span class="comment">/* 792 - 2 * 20 */</span>
<a name="l01207"></a>01207         wpt = hpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h;
<a name="l01208"></a>01208     }
<a name="l01209"></a>01209 
<a name="l01210"></a>01210         <span class="comment">/* Generate the PS, painting through the image mask.</span>
<a name="l01211"></a>01211 <span class="comment">         * The bounding box information should be inserted (default). */</span>
<a name="l01212"></a>01212     outstr = <a class="code" href="leptprotos_8h.html#a28861773a5d30232bcb871ce912ed77b">generateG4PS</a>(filein, cid, xpt, ypt, wpt, hpt, 1, 1, 1);
<a name="l01213"></a>01213     <span class="keywordflow">if</span> (!outstr)
<a name="l01214"></a>01214         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l01215"></a>01215     nbytes = strlen(outstr);
<a name="l01216"></a>01216 
<a name="l01217"></a>01217     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, <span class="stringliteral">&quot;w&quot;</span>, outstr, nbytes))
<a name="l01218"></a>01218         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l01219"></a>01219     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l01220"></a>01220     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l01221"></a>01221     <span class="keywordflow">return</span> 0;
<a name="l01222"></a>01222 }
<a name="l01223"></a>01223     
<a name="l01224"></a>01224 <span class="comment"></span>
<a name="l01225"></a>01225 <span class="comment">/*!</span>
<a name="l01226"></a>01226 <span class="comment"> *  convertG4ToPS()</span>
<a name="l01227"></a>01227 <span class="comment"> *</span>
<a name="l01228"></a>01228 <span class="comment"> *      Input:  filein (input tiff g4 file)</span>
<a name="l01229"></a>01229 <span class="comment"> *              fileout (output ps file)</span>
<a name="l01230"></a>01230 <span class="comment"> *              operation (&quot;w&quot; for write; &quot;a&quot; for append)</span>
<a name="l01231"></a>01231 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l01232"></a>01232 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l01233"></a>01233 <span class="comment"> *                    of the page)</span>
<a name="l01234"></a>01234 <span class="comment"> *              res (resolution of the input image, in ppi; typ. values</span>
<a name="l01235"></a>01235 <span class="comment"> *                   are 300 and 600; use 0 for automatic determination</span>
<a name="l01236"></a>01236 <span class="comment"> *                   based on image size)</span>
<a name="l01237"></a>01237 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l01238"></a>01238 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l01239"></a>01239 <span class="comment"> *                      if there is only one page.)</span>
<a name="l01240"></a>01240 <span class="comment"> *              maskflag (boolean: use TRUE if just painting through fg;</span>
<a name="l01241"></a>01241 <span class="comment"> *                        FALSE if painting both fg and bg.</span>
<a name="l01242"></a>01242 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l01243"></a>01243 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l01244"></a>01244 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01245"></a>01245 <span class="comment"> *</span>
<a name="l01246"></a>01246 <span class="comment"> *  Notes:</span>
<a name="l01247"></a>01247 <span class="comment"> *      (1) See the usage comments in convertJpegToPS(), some of</span>
<a name="l01248"></a>01248 <span class="comment"> *          which are repeated here.</span>
<a name="l01249"></a>01249 <span class="comment"> *      (2) This is a wrapper for tiff g4.  The PostScript that</span>
<a name="l01250"></a>01250 <span class="comment"> *          is generated is expanded by about 5/4 (due to the</span>
<a name="l01251"></a>01251 <span class="comment"> *          ascii85 encoding.  If you convert to pdf (ps2pdf), the</span>
<a name="l01252"></a>01252 <span class="comment"> *          ascii85 decoder is automatically invoked, so that the</span>
<a name="l01253"></a>01253 <span class="comment"> *          pdf wrapped g4 file is essentially the same size as</span>
<a name="l01254"></a>01254 <span class="comment"> *          the original g4 file.  It&#39;s useful to have the PS</span>
<a name="l01255"></a>01255 <span class="comment"> *          file ascii85 encoded, because many printers will not</span>
<a name="l01256"></a>01256 <span class="comment"> *          print binary PS files.</span>
<a name="l01257"></a>01257 <span class="comment"> *      (3) For the first image written to a file, use &quot;w&quot;, which</span>
<a name="l01258"></a>01258 <span class="comment"> *          opens for write and clears the file.  For all subsequent</span>
<a name="l01259"></a>01259 <span class="comment"> *          images written to that file, use &quot;a&quot;.</span>
<a name="l01260"></a>01260 <span class="comment"> *      (4) To render multiple images on the same page, set</span>
<a name="l01261"></a>01261 <span class="comment"> *          endpage = FALSE for each image until you get to the</span>
<a name="l01262"></a>01262 <span class="comment"> *          last, for which you set endpage = TRUE.  This causes the</span>
<a name="l01263"></a>01263 <span class="comment"> *          &quot;showpage&quot; command to be invoked.  Showpage outputs</span>
<a name="l01264"></a>01264 <span class="comment"> *          the entire page and clears the raster buffer for the</span>
<a name="l01265"></a>01265 <span class="comment"> *          next page to be added.  Without a &quot;showpage&quot;,</span>
<a name="l01266"></a>01266 <span class="comment"> *          subsequent images from the next page will overlay those</span>
<a name="l01267"></a>01267 <span class="comment"> *          previously put down.</span>
<a name="l01268"></a>01268 <span class="comment"> *      (5) For multiple images to the same page, where you are writing</span>
<a name="l01269"></a>01269 <span class="comment"> *          both jpeg and tiff-g4, you have two options:</span>
<a name="l01270"></a>01270 <span class="comment"> *           (a) write the g4 first, as either image (maskflag == FALSE)</span>
<a name="l01271"></a>01271 <span class="comment"> *               or imagemask (maskflag == TRUE), and then write the</span>
<a name="l01272"></a>01272 <span class="comment"> *               jpeg over it.</span>
<a name="l01273"></a>01273 <span class="comment"> *           (b) write the jpeg first and as the last item, write</span>
<a name="l01274"></a>01274 <span class="comment"> *               the g4 as an imagemask (maskflag == TRUE), to paint</span>
<a name="l01275"></a>01275 <span class="comment"> *               through the foreground only.  </span>
<a name="l01276"></a>01276 <span class="comment"> *          We have this flexibility with the tiff-g4 because it is 1 bpp.</span>
<a name="l01277"></a>01277 <span class="comment"> *      (6) For multiple pages, increment the page number, starting</span>
<a name="l01278"></a>01278 <span class="comment"> *          with page 1.  This allows PostScript (and PDF) to build</span>
<a name="l01279"></a>01279 <span class="comment"> *          a page directory, which viewers use for navigation.</span>
<a name="l01280"></a>01280 <span class="comment"> */</span>
<a name="l01281"></a>01281 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01282"></a><a class="code" href="psio2_8c.html#a737b154ce5f8457a5ace0abab95443df">01282</a> <a class="code" href="leptprotos_8h.html#abf5dceb33545b01e758ef16574350eaa">convertG4ToPS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01283"></a>01283               <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout,
<a name="l01284"></a>01284               <span class="keyword">const</span> <span class="keywordtype">char</span>  *operation,
<a name="l01285"></a>01285               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l01286"></a>01286               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l01287"></a>01287               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l01288"></a>01288               <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l01289"></a>01289               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l01290"></a>01290               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      maskflag,
<a name="l01291"></a>01291               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l01292"></a>01292 {
<a name="l01293"></a>01293 <span class="keywordtype">char</span>    *outstr;
<a name="l01294"></a>01294 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l01295"></a>01295 
<a name="l01296"></a>01296     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertG4ToPS&quot;</span>);
<a name="l01297"></a>01297 
<a name="l01298"></a>01298     <span class="keywordflow">if</span> (!filein)
<a name="l01299"></a>01299         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01300"></a>01300     <span class="keywordflow">if</span> (!fileout)
<a name="l01301"></a>01301         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l01302"></a>01302     <span class="keywordflow">if</span> (strcmp(operation, <span class="stringliteral">&quot;w&quot;</span>) &amp;&amp; strcmp(operation, <span class="stringliteral">&quot;a&quot;</span>))
<a name="l01303"></a>01303         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;operation must be \&quot;w\&quot; or \&quot;a\&quot;&quot;</span>, procName, 1);
<a name="l01304"></a>01304 
<a name="l01305"></a>01305     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#ad5e921dc3051ba9c3490f87fba58b003">convertG4ToPSString</a>(filein, &amp;outstr, &amp;nbytes, x, y, res, scale,
<a name="l01306"></a>01306                             pageno, maskflag, endpage))
<a name="l01307"></a>01307         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not made&quot;</span>, procName, 1);
<a name="l01308"></a>01308 
<a name="l01309"></a>01309     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, operation, outstr, nbytes))
<a name="l01310"></a>01310         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l01311"></a>01311 
<a name="l01312"></a>01312     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l01313"></a>01313     <span class="keywordflow">return</span> 0;
<a name="l01314"></a>01314 }
<a name="l01315"></a>01315 
<a name="l01316"></a>01316 <span class="comment"></span>
<a name="l01317"></a>01317 <span class="comment">/*!</span>
<a name="l01318"></a>01318 <span class="comment"> *  convertG4ToPSString()</span>
<a name="l01319"></a>01319 <span class="comment"> *</span>
<a name="l01320"></a>01320 <span class="comment"> *      Input:  filein (input tiff g4 file)</span>
<a name="l01321"></a>01321 <span class="comment"> *              &amp;poutstr (&lt;return&gt; PS string)</span>
<a name="l01322"></a>01322 <span class="comment"> *              &amp;nbytes (&lt;return&gt; number of bytes in PS string)</span>
<a name="l01323"></a>01323 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l01324"></a>01324 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l01325"></a>01325 <span class="comment"> *                    of the page)</span>
<a name="l01326"></a>01326 <span class="comment"> *              res (resolution of the input image, in ppi; typ. values</span>
<a name="l01327"></a>01327 <span class="comment"> *                   are 300 and 600; use 0 for automatic determination</span>
<a name="l01328"></a>01328 <span class="comment"> *                   based on image size)</span>
<a name="l01329"></a>01329 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l01330"></a>01330 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l01331"></a>01331 <span class="comment"> *                      if there is only one page.)</span>
<a name="l01332"></a>01332 <span class="comment"> *              maskflag (boolean: use TRUE if just painting through fg;</span>
<a name="l01333"></a>01333 <span class="comment"> *                        FALSE if painting both fg and bg.</span>
<a name="l01334"></a>01334 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l01335"></a>01335 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l01336"></a>01336 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01337"></a>01337 <span class="comment"> *</span>
<a name="l01338"></a>01338 <span class="comment"> *  Notes:</span>
<a name="l01339"></a>01339 <span class="comment"> *      (1) Generates PS string in G4 compressed tiff format from G4 tiff file.</span>
<a name="l01340"></a>01340 <span class="comment"> *      (2) For usage, see convertG4ToPS().</span>
<a name="l01341"></a>01341 <span class="comment"> */</span>
<a name="l01342"></a>01342 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01343"></a><a class="code" href="psio2_8c.html#a4d01b492c992c5f4eb5bc57962dd0102">01343</a> <a class="code" href="leptprotos_8h.html#ad5e921dc3051ba9c3490f87fba58b003">convertG4ToPSString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01344"></a>01344                     <span class="keywordtype">char</span>       **poutstr,
<a name="l01345"></a>01345                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     *pnbytes,
<a name="l01346"></a>01346                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l01347"></a>01347                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l01348"></a>01348                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l01349"></a>01349                     <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l01350"></a>01350                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l01351"></a>01351                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      maskflag,
<a name="l01352"></a>01352                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l01353"></a>01353 {
<a name="l01354"></a>01354 <span class="keywordtype">char</span>               *outstr;
<a name="l01355"></a>01355 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l01356"></a>01356 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01357"></a>01357 
<a name="l01358"></a>01358     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertG4ToPSString&quot;</span>);
<a name="l01359"></a>01359 
<a name="l01360"></a>01360     <span class="keywordflow">if</span> (!poutstr)
<a name="l01361"></a>01361         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;outstr not defined&quot;</span>, procName, 1);
<a name="l01362"></a>01362     <span class="keywordflow">if</span> (!pnbytes)
<a name="l01363"></a>01363         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;nbytes not defined&quot;</span>, procName, 1);
<a name="l01364"></a>01364     *poutstr = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01365"></a>01365     *pnbytes = 0;
<a name="l01366"></a>01366     <span class="keywordflow">if</span> (!filein)
<a name="l01367"></a>01367         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01368"></a>01368 
<a name="l01369"></a>01369     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#afa7929f2654d669d6ecaed25700972d3">l_generateG4Data</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01370"></a>01370         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;g4 data not made&quot;</span>, procName, 1);
<a name="l01371"></a>01371 
<a name="l01372"></a>01372         <span class="comment">/* Get scaled location in pts.  Guess the input scan resolution</span>
<a name="l01373"></a>01373 <span class="comment">         * based on the input parameter @res, the resolution data in</span>
<a name="l01374"></a>01374 <span class="comment">         * the pix, and the size of the image. */</span>
<a name="l01375"></a>01375     <span class="keywordflow">if</span> (scale == 0.0)
<a name="l01376"></a>01376         scale = 1.0;
<a name="l01377"></a>01377     <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l01378"></a>01378         <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> &gt; 0)
<a name="l01379"></a>01379             res = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a>;
<a name="l01380"></a>01380         <span class="keywordflow">else</span> {
<a name="l01381"></a>01381             <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> &lt;= 3509)  <span class="comment">/* A4 height at 300 ppi */</span>
<a name="l01382"></a>01382                 res = 300;
<a name="l01383"></a>01383             <span class="keywordflow">else</span>
<a name="l01384"></a>01384                 res = 600;
<a name="l01385"></a>01385         }
<a name="l01386"></a>01386     }
<a name="l01387"></a>01387     xpt = scale * x * 72. / res;
<a name="l01388"></a>01388     ypt = scale * y * 72. / res;
<a name="l01389"></a>01389     wpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> * 72. / res;
<a name="l01390"></a>01390     hpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> * 72. / res;
<a name="l01391"></a>01391 
<a name="l01392"></a>01392     <span class="keywordflow">if</span> (pageno == 0)
<a name="l01393"></a>01393         pageno = 1;
<a name="l01394"></a>01394 
<a name="l01395"></a>01395 <span class="preprocessor">#if  DEBUG_G4</span>
<a name="l01396"></a>01396 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;w = %d, h = %d, minisblack = %d\n&quot;</span>,
<a name="l01397"></a>01397             cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a6773db12a902fa0c65606c481de02db4">minisblack</a>);
<a name="l01398"></a>01398     fprintf(stderr, <span class="stringliteral">&quot;comp bytes = %d, nbytes85 = %d\n&quot;</span>,
<a name="l01399"></a>01399             cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a>);
<a name="l01400"></a>01400     fprintf(stderr, <span class="stringliteral">&quot;xpt = %7.2f, ypt = %7.2f, wpt = %7.2f, hpt = %7.2f\n&quot;</span>,
<a name="l01401"></a>01401              xpt, ypt, wpt, hpt);
<a name="l01402"></a>01402 <span class="preprocessor">#endif   </span><span class="comment">/* DEBUG_G4 */</span>
<a name="l01403"></a>01403 
<a name="l01404"></a>01404         <span class="comment">/* Generate the PS */</span>
<a name="l01405"></a>01405     outstr = <a class="code" href="leptprotos_8h.html#a28861773a5d30232bcb871ce912ed77b">generateG4PS</a>(filein, cid, xpt, ypt, wpt, hpt,
<a name="l01406"></a>01406                           maskflag, pageno, endpage);
<a name="l01407"></a>01407     <span class="keywordflow">if</span> (!outstr)
<a name="l01408"></a>01408         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l01409"></a>01409     *poutstr = outstr;
<a name="l01410"></a>01410     *pnbytes = strlen(outstr);
<a name="l01411"></a>01411     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l01412"></a>01412     <span class="keywordflow">return</span> 0;
<a name="l01413"></a>01413 }
<a name="l01414"></a>01414 
<a name="l01415"></a>01415 <span class="comment"></span>
<a name="l01416"></a>01416 <span class="comment">/*!</span>
<a name="l01417"></a>01417 <span class="comment"> *  generateG4PS()</span>
<a name="l01418"></a>01418 <span class="comment"> *</span>
<a name="l01419"></a>01419 <span class="comment"> *      Input:  filein (&lt;optional&gt; input tiff g4 file; can be null)</span>
<a name="l01420"></a>01420 <span class="comment"> *              cid (g4 compressed image data)</span>
<a name="l01421"></a>01421 <span class="comment"> *              xpt, ypt (location of LL corner of image, in pts, relative</span>
<a name="l01422"></a>01422 <span class="comment"> *                        to the PostScript origin (0,0) at the LL corner</span>
<a name="l01423"></a>01423 <span class="comment"> *                        of the page)</span>
<a name="l01424"></a>01424 <span class="comment"> *              wpt, hpt (rendered image size in pts)</span>
<a name="l01425"></a>01425 <span class="comment"> *              maskflag (boolean: use TRUE if just painting through fg;</span>
<a name="l01426"></a>01426 <span class="comment"> *                        FALSE if painting both fg and bg.</span>
<a name="l01427"></a>01427 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l01428"></a>01428 <span class="comment"> *                      if there is only one page.)</span>
<a name="l01429"></a>01429 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l01430"></a>01430 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l01431"></a>01431 <span class="comment"> *      Return: PS string, or null on error</span>
<a name="l01432"></a>01432 <span class="comment"> *</span>
<a name="l01433"></a>01433 <span class="comment"> *  Notes:</span>
<a name="l01434"></a>01434 <span class="comment"> *      (1) Low-level function.</span>
<a name="l01435"></a>01435 <span class="comment"> */</span>
<a name="l01436"></a>01436 <span class="keywordtype">char</span> *
<a name="l01437"></a><a class="code" href="psio2_8c.html#a06f53a00c8db26fc797bdc01fd136dc1">01437</a> <a class="code" href="leptprotos_8h.html#a28861773a5d30232bcb871ce912ed77b">generateG4PS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>         *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01438"></a>01438              <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid,
<a name="l01439"></a>01439              <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt,
<a name="l01440"></a>01440              <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           ypt,
<a name="l01441"></a>01441              <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           wpt,
<a name="l01442"></a>01442              <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           hpt,
<a name="l01443"></a>01443              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             maskflag,
<a name="l01444"></a>01444              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             pageno,
<a name="l01445"></a>01445              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             endpage)
<a name="l01446"></a>01446 {
<a name="l01447"></a>01447 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  w, h;
<a name="l01448"></a>01448 <span class="keywordtype">char</span>    *outstr;
<a name="l01449"></a>01449 <span class="keywordtype">char</span>     bigbuf[<a class="code" href="psio2_8c.html#af1791633b3a1a12a9aa449aa6d558327">L_BUF_SIZE</a>];
<a name="l01450"></a>01450 <a class="code" href="struct_sarray.html">SARRAY</a>  *sa;
<a name="l01451"></a>01451 
<a name="l01452"></a>01452     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;generateG4PS&quot;</span>);
<a name="l01453"></a>01453 
<a name="l01454"></a>01454     <span class="keywordflow">if</span> (!cid)
<a name="l01455"></a>01455         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;g4 data not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01456"></a>01456     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l01457"></a>01457     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l01458"></a>01458 
<a name="l01459"></a>01459     <span class="keywordflow">if</span> ((sa = <a class="code" href="leptprotos_8h.html#ad131504b407cbc1aaa1b18e59945d9a5">sarrayCreate</a>(50)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01460"></a>01460         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;sa not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01461"></a>01461 
<a name="l01462"></a>01462     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%!PS-Adobe-3.0&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01463"></a>01463     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%Creator: leptonica&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01464"></a>01464     <span class="keywordflow">if</span> (filein) {
<a name="l01465"></a>01465         sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Title: %s&quot;</span>, filein);
<a name="l01466"></a>01466         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01467"></a>01467     }
<a name="l01468"></a>01468     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%DocumentData: Clean7Bit&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01469"></a>01469 
<a name="l01470"></a>01470     <span class="keywordflow">if</span> (<a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">var_PS_WRITE_BOUNDING_BOX</a> == 1) {
<a name="l01471"></a>01471         sprintf(bigbuf,
<a name="l01472"></a>01472             <span class="stringliteral">&quot;%%%%BoundingBox: %7.2f %7.2f %7.2f %7.2f&quot;</span>,
<a name="l01473"></a>01473                     xpt, ypt, xpt + wpt, ypt + hpt);
<a name="l01474"></a>01474         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01475"></a>01475     }
<a name="l01476"></a>01476 
<a name="l01477"></a>01477     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%LanguageLevel: 2&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01478"></a>01478     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%EndComments&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01479"></a>01479     sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Page: %d %d&quot;</span>, pageno, pageno);
<a name="l01480"></a>01480     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01481"></a>01481 
<a name="l01482"></a>01482     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;save&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01483"></a>01483     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;100 dict begin&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01484"></a>01484 
<a name="l01485"></a>01485     sprintf(bigbuf,
<a name="l01486"></a>01486         <span class="stringliteral">&quot;%7.2f %7.2f translate         %%set image origin in pts&quot;</span>, xpt, ypt);
<a name="l01487"></a>01487     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01488"></a>01488 
<a name="l01489"></a>01489     sprintf(bigbuf,
<a name="l01490"></a>01490         <span class="stringliteral">&quot;%7.2f %7.2f scale             %%set image size in pts&quot;</span>, wpt, hpt);
<a name="l01491"></a>01491     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01492"></a>01492 
<a name="l01493"></a>01493     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceGray setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01494"></a>01494 
<a name="l01495"></a>01495     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01496"></a>01496     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l01497"></a>01497           (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  /RawData currentfile /ASCII85Decode filter def&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01498"></a>01498     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &lt;&lt; &quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01499"></a>01499     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /ImageType 1&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01500"></a>01500     sprintf(bigbuf, <span class="stringliteral">&quot;    /Width %d&quot;</span>, w);
<a name="l01501"></a>01501     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01502"></a>01502     sprintf(bigbuf, <span class="stringliteral">&quot;    /Height %d&quot;</span>, h);
<a name="l01503"></a>01503     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01504"></a>01504     sprintf(bigbuf, <span class="stringliteral">&quot;    /ImageMatrix [ %d 0 0 %d 0 %d ]&quot;</span>, w, -h, h);
<a name="l01505"></a>01505     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01506"></a>01506     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /BitsPerComponent 1&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01507"></a>01507     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /Interpolate true&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01508"></a>01508     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a6773db12a902fa0c65606c481de02db4">minisblack</a>)
<a name="l01509"></a>01509         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /Decode [1 0]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01510"></a>01510     <span class="keywordflow">else</span>  <span class="comment">/* miniswhite; typical for 1 bpp */</span>
<a name="l01511"></a>01511         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /Decode [0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01512"></a>01512     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;    /DataSource RawData&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01513"></a>01513     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;        &lt;&lt;&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01514"></a>01514     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;          /K -1&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01515"></a>01515     sprintf(bigbuf, <span class="stringliteral">&quot;          /Columns %d&quot;</span>, w);
<a name="l01516"></a>01516     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01517"></a>01517     sprintf(bigbuf, <span class="stringliteral">&quot;          /Rows %d&quot;</span>, h);
<a name="l01518"></a>01518     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01519"></a>01519     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;        &gt;&gt; /CCITTFaxDecode filter&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01520"></a>01520     <span class="keywordflow">if</span> (maskflag == <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)  <span class="comment">/* just paint through the fg */</span>
<a name="l01521"></a>01521         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &gt;&gt; imagemask&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01522"></a>01522     <span class="keywordflow">else</span>  <span class="comment">/* Paint full image */</span>
<a name="l01523"></a>01523         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &gt;&gt; image&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01524"></a>01524     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  RawData flushfile&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01525"></a>01525     <span class="keywordflow">if</span> (endpage == <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l01526"></a>01526         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  showpage&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01527"></a>01527     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;}&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01528"></a>01528 
<a name="l01529"></a>01529     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%BeginData:&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01530"></a>01530     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;exec&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01531"></a>01531 
<a name="l01532"></a>01532         <span class="comment">/* Insert the ascii85 ccittg4 data; this is now owned by sa */</span>
<a name="l01533"></a>01533     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l01534"></a>01534 
<a name="l01535"></a>01535         <span class="comment">/* Concat the trailing data */</span>
<a name="l01536"></a>01536     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%EndData&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01537"></a>01537     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;end&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01538"></a>01538     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;restore&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l01539"></a>01539 
<a name="l01540"></a>01540     outstr = <a class="code" href="leptprotos_8h.html#aa58ee6340678669b10d71c2abe2ab9a0">sarrayToString</a>(sa, 1);
<a name="l01541"></a>01541     <a class="code" href="leptprotos_8h.html#a6bc238d36ad4599585c7de09105f83c2">sarrayDestroy</a>(&amp;sa);
<a name="l01542"></a>01542     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* it has been transferred and destroyed */</span>
<a name="l01543"></a>01543     <span class="keywordflow">return</span> outstr;
<a name="l01544"></a>01544 }
<a name="l01545"></a>01545 
<a name="l01546"></a>01546 <span class="comment"></span>
<a name="l01547"></a>01547 <span class="comment">/*!</span>
<a name="l01548"></a>01548 <span class="comment"> *  pixGenerateG4Data()</span>
<a name="l01549"></a>01549 <span class="comment"> *</span>
<a name="l01550"></a>01550 <span class="comment"> *      Input:  pixs (1 bpp)</span>
<a name="l01551"></a>01551 <span class="comment"> *              ascii85flag (0 for gzipped; 1 for ascii85-encoded gzipped)</span>
<a name="l01552"></a>01552 <span class="comment"> *      Return: cid (g4 compressed image data), or null on error</span>
<a name="l01553"></a>01553 <span class="comment"> *</span>
<a name="l01554"></a>01554 <span class="comment"> *  Notes:</span>
<a name="l01555"></a>01555 <span class="comment"> *      (1) Set ascii85flag:</span>
<a name="l01556"></a>01556 <span class="comment"> *           - 0 for binary data (not permitted in PostScript)</span>
<a name="l01557"></a>01557 <span class="comment"> *           - 1 for ascii85 (5 for 4) encoded binary data</span>
<a name="l01558"></a>01558 <span class="comment"> */</span>
<a name="l01559"></a>01559 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l01560"></a><a class="code" href="psio2_8c.html#a3996b2b418718bb24482608291d98502">01560</a> <a class="code" href="leptprotos_8h.html#af92d6c23ce484c2a322af0185d554aab">pixGenerateG4Data</a>(<a class="code" href="struct_pix.html">PIX</a>     *pixs,
<a name="l01561"></a>01561                   <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ascii85flag)
<a name="l01562"></a>01562 {
<a name="l01563"></a>01563 <span class="keywordtype">char</span>               *tname;
<a name="l01564"></a>01564 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01565"></a>01565 
<a name="l01566"></a>01566     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixGenerateG4Data&quot;</span>);
<a name="l01567"></a>01567 
<a name="l01568"></a>01568     <span class="keywordflow">if</span> (!pixs)
<a name="l01569"></a>01569         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not defined&quot;</span>,
<a name="l01570"></a>01570                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01571"></a>01571     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pixs) != 1)
<a name="l01572"></a>01572         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not 1 bpp&quot;</span>,
<a name="l01573"></a>01573                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01574"></a>01574 
<a name="l01575"></a>01575         <span class="comment">/* Compress to a temp tiff g4 file */</span>
<a name="l01576"></a>01576     tname = <a class="code" href="leptprotos_8h.html#a42aaf4f1511e9cb01e7f6c7b5ddf12a6">genTempFilename</a>(<span class="stringliteral">&quot;/tmp&quot;</span>, <span class="stringliteral">&quot;temp.tif&quot;</span>, 1, 1);
<a name="l01577"></a>01577     <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tname, pixs, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>);
<a name="l01578"></a>01578 
<a name="l01579"></a>01579     cid = <a class="code" href="leptprotos_8h.html#afa7929f2654d669d6ecaed25700972d3">l_generateG4Data</a>(tname, ascii85flag);
<a name="l01580"></a>01580     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(tname);
<a name="l01581"></a>01581     <span class="keywordflow">return</span> cid;
<a name="l01582"></a>01582 }
<a name="l01583"></a>01583 
<a name="l01584"></a>01584 <span class="comment"></span>
<a name="l01585"></a>01585 <span class="comment">/*!</span>
<a name="l01586"></a>01586 <span class="comment"> *  l_generateG4Data()</span>
<a name="l01587"></a>01587 <span class="comment"> *</span>
<a name="l01588"></a>01588 <span class="comment"> *      Input:  fname (of g4 compressed file)</span>
<a name="l01589"></a>01589 <span class="comment"> *              ascii85flag (0 for g4 compressed; 1 for ascii85-encoded g4)</span>
<a name="l01590"></a>01590 <span class="comment"> *      Return: cid (g4 compressed image data), or null on error</span>
<a name="l01591"></a>01591 <span class="comment"> *</span>
<a name="l01592"></a>01592 <span class="comment"> *  Notes:</span>
<a name="l01593"></a>01593 <span class="comment"> *      (1) Set ascii85flag:</span>
<a name="l01594"></a>01594 <span class="comment"> *           - 0 for binary data (not permitted in PostScript)</span>
<a name="l01595"></a>01595 <span class="comment"> *           - 1 for ascii85 (5 for 4) encoded binary data</span>
<a name="l01596"></a>01596 <span class="comment"> */</span>
<a name="l01597"></a>01597 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l01598"></a><a class="code" href="psio2_8c.html#a5eda9633bfc1c2a420e38edcc9740dbb">01598</a> <a class="code" href="leptprotos_8h.html#afa7929f2654d669d6ecaed25700972d3">l_generateG4Data</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fname,
<a name="l01599"></a>01599                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      ascii85flag)
<a name="l01600"></a>01600 {
<a name="l01601"></a>01601 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>            *datacomp = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* g4 compressed raster data */</span>
<a name="l01602"></a>01602 <span class="keywordtype">char</span>               *data85 = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* ascii85 encoded g4 compressed data */</span>
<a name="l01603"></a>01603 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             w, h, xres, yres;
<a name="l01604"></a>01604 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             minisblack;  <span class="comment">/* TRUE or FALSE */</span>
<a name="l01605"></a>01605 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             nbytes85;
<a name="l01606"></a>01606 <span class="keywordtype">size_t</span>              nbytescomp;
<a name="l01607"></a>01607 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01608"></a>01608 FILE               *fp;
<a name="l01609"></a>01609 
<a name="l01610"></a>01610     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;l_generateG4Data&quot;</span>);
<a name="l01611"></a>01611 
<a name="l01612"></a>01612     <span class="keywordflow">if</span> (!fname)
<a name="l01613"></a>01613         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fname not defined&quot;</span>,
<a name="l01614"></a>01614                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01615"></a>01615 
<a name="l01616"></a>01616         <span class="comment">/* The returned ccitt g4 data in memory is the block of</span>
<a name="l01617"></a>01617 <span class="comment">         * bytes in the tiff file, starting after 8 bytes and</span>
<a name="l01618"></a>01618 <span class="comment">         * ending before the directory. */</span>
<a name="l01619"></a>01619     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#ae8934524b200206c5305a42cae08130b">extractG4DataFromFile</a>(fname, &amp;datacomp, &amp;nbytescomp,
<a name="l01620"></a>01620                               &amp;w, &amp;h, &amp;minisblack)) {
<a name="l01621"></a>01621         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;datacomp not extracted&quot;</span>,
<a name="l01622"></a>01622                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01623"></a>01623     }
<a name="l01624"></a>01624 
<a name="l01625"></a>01625         <span class="comment">/* Read the resolution */</span>
<a name="l01626"></a>01626     <span class="keywordflow">if</span> ((fp = <a class="code" href="leptprotos_8h.html#a1796abf2eefccf7f0d3d2cc99f946979">fopenReadStream</a>(fname)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01627"></a>01627         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;stream not opened&quot;</span>,
<a name="l01628"></a>01628                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01629"></a>01629     <a class="code" href="leptprotos_8h.html#a7760f4ec592786758e5cfccedab26a9e">getTiffResolution</a>(fp, &amp;xres, &amp;yres);
<a name="l01630"></a>01630     fclose(fp);
<a name="l01631"></a>01631 
<a name="l01632"></a>01632         <span class="comment">/* Optionally, encode the compressed data */</span>
<a name="l01633"></a>01633     <span class="keywordflow">if</span> (ascii85flag == 1) {
<a name="l01634"></a>01634         data85 = <a class="code" href="leptprotos_8h.html#a38ccddb3da59b9e5076f6eb845ad84fd">encodeAscii85</a>(datacomp, nbytescomp, &amp;nbytes85);
<a name="l01635"></a>01635         <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(datacomp);
<a name="l01636"></a>01636         <span class="keywordflow">if</span> (!data85)
<a name="l01637"></a>01637             <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;data85 not made&quot;</span>,
<a name="l01638"></a>01638                                                   procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01639"></a>01639         <span class="keywordflow">else</span>
<a name="l01640"></a>01640             data85[nbytes85 - 1] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* remove the newline */</span>
<a name="l01641"></a>01641     }
<a name="l01642"></a>01642 
<a name="l01643"></a>01643     cid = (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(1, <span class="keyword">sizeof</span>(<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>));
<a name="l01644"></a>01644     <span class="keywordflow">if</span> (!cid)
<a name="l01645"></a>01645         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;cid not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l01646"></a>01646     <span class="keywordflow">if</span> (ascii85flag == 0)
<a name="l01647"></a>01647         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a3e4fc387d70ba9a7afd286d397376bdc">datacomp</a> = datacomp;
<a name="l01648"></a>01648     <span class="keywordflow">else</span> {  <span class="comment">/* ascii85 */</span>
<a name="l01649"></a>01649         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = data85;
<a name="l01650"></a>01650         cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a> = nbytes85;
<a name="l01651"></a>01651     }
<a name="l01652"></a>01652     cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab0cc53bf28df7259b556c486f08498e1">type</a> = <a class="code" href="imageio_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a9941521dc0a9ae70aa4e87be3651cf32">L_G4_ENCODE</a>;
<a name="l01653"></a>01653     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a> = nbytescomp;
<a name="l01654"></a>01654     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> = w;
<a name="l01655"></a>01655     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> = h;
<a name="l01656"></a>01656     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a6773db12a902fa0c65606c481de02db4">minisblack</a> = minisblack;
<a name="l01657"></a>01657     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> = xres;
<a name="l01658"></a>01658     <span class="keywordflow">return</span> cid;
<a name="l01659"></a>01659 }
<a name="l01660"></a>01660 
<a name="l01661"></a>01661 
<a name="l01662"></a>01662 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l01663"></a>01663 <span class="comment"> *                     For tiff multipage files                *</span>
<a name="l01664"></a>01664 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l01665"></a>01665 <span class="comment">/*!</span>
<a name="l01666"></a>01666 <span class="comment"> *  convertTiffMultipageToPS()</span>
<a name="l01667"></a>01667 <span class="comment"> *</span>
<a name="l01668"></a>01668 <span class="comment"> *      Input:  filein (input tiff multipage file)</span>
<a name="l01669"></a>01669 <span class="comment"> *              fileout (output ps file)</span>
<a name="l01670"></a>01670 <span class="comment"> *              tempfile (&lt;optional&gt; for temporary g4 tiffs;</span>
<a name="l01671"></a>01671 <span class="comment"> *                        use NULL for default)</span>
<a name="l01672"></a>01672 <span class="comment"> *              factor (for filling 8.5 x 11 inch page;</span>
<a name="l01673"></a>01673 <span class="comment"> *                      use 0.0 for DEFAULT_FILL_FRACTION)</span>
<a name="l01674"></a>01674 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01675"></a>01675 <span class="comment"> *</span>
<a name="l01676"></a>01676 <span class="comment"> *  Notes:</span>
<a name="l01677"></a>01677 <span class="comment"> *      (1) This converts a multipage tiff file of binary page images</span>
<a name="l01678"></a>01678 <span class="comment"> *          into a ccitt g4 compressed PS file.</span>
<a name="l01679"></a>01679 <span class="comment"> *      (2) If the images are generated from a standard resolution fax,</span>
<a name="l01680"></a>01680 <span class="comment"> *          the vertical resolution is doubled to give a normal-looking</span>
<a name="l01681"></a>01681 <span class="comment"> *          aspect ratio.</span>
<a name="l01682"></a>01682 <span class="comment"> */</span>
<a name="l01683"></a>01683 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01684"></a><a class="code" href="psio2_8c.html#a379368a3865ec1e54269fceb8186f000">01684</a> <a class="code" href="leptprotos_8h.html#a7ac147bd7872db02c30fa343d57f8f62">convertTiffMultipageToPS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01685"></a>01685                          <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout,
<a name="l01686"></a>01686                          <span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="src_2xtractprotos_8c.html#a0f92b7d10538b9004aef2a77de11ae8a">tempfile</a>,
<a name="l01687"></a>01687                          <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    fillfract)
<a name="l01688"></a>01688 {
<a name="l01689"></a>01689 <span class="keyword">const</span> <span class="keywordtype">char</span>   tempdefault[] = <span class="stringliteral">&quot;/tmp/junk_temp_g4.tif&quot;</span>;
<a name="l01690"></a>01690 <span class="keyword">const</span> <span class="keywordtype">char</span>  *tempname;
<a name="l01691"></a>01691 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      i, npages, w, h, istiff;
<a name="l01692"></a>01692 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale;
<a name="l01693"></a>01693 <a class="code" href="struct_pix.html">PIX</a>         *pix, *pixs;
<a name="l01694"></a>01694 FILE        *fp;
<a name="l01695"></a>01695 
<a name="l01696"></a>01696     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertTiffMultipageToPS&quot;</span>);
<a name="l01697"></a>01697 
<a name="l01698"></a>01698     <span class="keywordflow">if</span> (!filein)
<a name="l01699"></a>01699         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01700"></a>01700     <span class="keywordflow">if</span> (!fileout)
<a name="l01701"></a>01701         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l01702"></a>01702 
<a name="l01703"></a>01703     <span class="keywordflow">if</span> ((fp = <a class="code" href="leptprotos_8h.html#a1796abf2eefccf7f0d3d2cc99f946979">fopenReadStream</a>(filein)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01704"></a>01704         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;file not found&quot;</span>, procName, 1);
<a name="l01705"></a>01705     istiff = <a class="code" href="leptprotos_8h.html#a183133c5630bd11e1d997812be02cb48">fileFormatIsTiff</a>(fp);
<a name="l01706"></a>01706     <span class="keywordflow">if</span> (!istiff) {
<a name="l01707"></a>01707         fclose(fp);
<a name="l01708"></a>01708         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;file not tiff format&quot;</span>, procName, 1);
<a name="l01709"></a>01709     }
<a name="l01710"></a>01710     <a class="code" href="leptprotos_8h.html#aeb0d7c43cca93ad81cc5191b4bb6b741">tiffGetCount</a>(fp, &amp;npages);
<a name="l01711"></a>01711     fclose(fp);
<a name="l01712"></a>01712 
<a name="l01713"></a>01713     <span class="keywordflow">if</span> (tempfile)
<a name="l01714"></a>01714         tempname = <a class="code" href="src_2xtractprotos_8c.html#a0f92b7d10538b9004aef2a77de11ae8a">tempfile</a>;
<a name="l01715"></a>01715     <span class="keywordflow">else</span>
<a name="l01716"></a>01716         tempname = tempdefault;
<a name="l01717"></a>01717 
<a name="l01718"></a>01718     <span class="keywordflow">if</span> (fillfract == 0.0)
<a name="l01719"></a>01719         fillfract = <a class="code" href="psio2_8c.html#ae5cd7ddcd7db6d82efc3da1980812d0e">DEFAULT_FILL_FRACTION</a>;
<a name="l01720"></a>01720 
<a name="l01721"></a>01721     <span class="keywordflow">for</span> (i = 0; i &lt; npages; i++) {
<a name="l01722"></a>01722         <span class="keywordflow">if</span> ((pix = <a class="code" href="leptprotos_8h.html#a54bf7fe353ae12fc6dbc0981f5fb54cf">pixReadTiff</a>(filein, i)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01723"></a>01723              <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;pix not made&quot;</span>, procName, 1);
<a name="l01724"></a>01724 
<a name="l01725"></a>01725         w = <a class="code" href="leptprotos_8h.html#aa71e0b02548a56e723c76996ab145257">pixGetWidth</a>(pix);
<a name="l01726"></a>01726         h = <a class="code" href="leptprotos_8h.html#a511e60efcf1d9f3f59b5308ef5f49a06">pixGetHeight</a>(pix);
<a name="l01727"></a>01727         <span class="keywordflow">if</span> (w == 1728 &amp;&amp; h &lt; w)   <span class="comment">/* it&#39;s a std res fax */</span>
<a name="l01728"></a>01728             pixs = <a class="code" href="leptprotos_8h.html#a18e0b7ac7cdcd84fd24bd4fb3bff832a">pixScale</a>(pix, 1.0, 2.0);
<a name="l01729"></a>01729         <span class="keywordflow">else</span>
<a name="l01730"></a>01730             pixs = <a class="code" href="leptprotos_8h.html#a48c3df1b04f60de6d7fcabd8375250d8">pixClone</a>(pix);
<a name="l01731"></a>01731 
<a name="l01732"></a>01732         <a class="code" href="leptprotos_8h.html#a5a9a534e77de5e57d74ff3d678ca59e0">pixWrite</a>(tempname, pixs, <a class="code" href="imageio_8h.html#a726ca809ffd3d67ab4b8476646f26635a663de6dc5bd3417a37675d0187f7bd03">IFF_TIFF_G4</a>);
<a name="l01733"></a>01733         scale = <a class="code" href="environ_8h.html#a67d588ee5ca71be19990efb07fa2ce72">L_MIN</a>(fillfract * 2550 / w, fillfract * 3300 / h);
<a name="l01734"></a>01734         <span class="keywordflow">if</span> (i == 0)
<a name="l01735"></a>01735             <a class="code" href="leptprotos_8h.html#abf5dceb33545b01e758ef16574350eaa">convertG4ToPS</a>(tempname, fileout, <span class="stringliteral">&quot;w&quot;</span>, 0, 0, 300, scale,
<a name="l01736"></a>01736                           i + 1, <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01737"></a>01737         <span class="keywordflow">else</span>
<a name="l01738"></a>01738             <a class="code" href="leptprotos_8h.html#abf5dceb33545b01e758ef16574350eaa">convertG4ToPS</a>(tempname, fileout, <span class="stringliteral">&quot;a&quot;</span>, 0, 0, 300, scale,
<a name="l01739"></a>01739                           i + 1, <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>, <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>);
<a name="l01740"></a>01740         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pix);
<a name="l01741"></a>01741         <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixs);
<a name="l01742"></a>01742     }
<a name="l01743"></a>01743 
<a name="l01744"></a>01744     <span class="keywordflow">return</span> 0;
<a name="l01745"></a>01745 }
<a name="l01746"></a>01746 
<a name="l01747"></a>01747 
<a name="l01748"></a>01748 <span class="comment">/*---------------------------------------------------------------------*</span>
<a name="l01749"></a>01749 <span class="comment"> *            For flate (gzip) compressed images (e.g., png)           *</span>
<a name="l01750"></a>01750 <span class="comment"> *---------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l01751"></a>01751 <span class="comment">/*!</span>
<a name="l01752"></a>01752 <span class="comment"> *  convertFlateToPSEmbed()</span>
<a name="l01753"></a>01753 <span class="comment"> *</span>
<a name="l01754"></a>01754 <span class="comment"> *      Input:  filein (input file -- any format)</span>
<a name="l01755"></a>01755 <span class="comment"> *              fileout (output ps file)</span>
<a name="l01756"></a>01756 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01757"></a>01757 <span class="comment"> *</span>
<a name="l01758"></a>01758 <span class="comment"> *  Notes:</span>
<a name="l01759"></a>01759 <span class="comment"> *      (1) This function takes any image file as input and generates a</span>
<a name="l01760"></a>01760 <span class="comment"> *          flate-compressed, ascii85 encoded PS file, with a bounding box.</span>
<a name="l01761"></a>01761 <span class="comment"> *      (2) The bounding box is required when a program such as TeX</span>
<a name="l01762"></a>01762 <span class="comment"> *          (through epsf) places and rescales the image.</span>
<a name="l01763"></a>01763 <span class="comment"> *      (3) The bounding box is sized for fitting the image to an</span>
<a name="l01764"></a>01764 <span class="comment"> *          8.5 x 11.0 inch page.</span>
<a name="l01765"></a>01765 <span class="comment"> */</span>
<a name="l01766"></a>01766 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01767"></a><a class="code" href="psio2_8c.html#a9ac0f6c3937bd26ca9363c82a25653f9">01767</a> <a class="code" href="leptprotos_8h.html#aa1e1705a976c7fffe91a9599e99ff7f3">convertFlateToPSEmbed</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01768"></a>01768                       <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout)
<a name="l01769"></a>01769 {
<a name="l01770"></a>01770 <span class="keywordtype">char</span>               *outstr;
<a name="l01771"></a>01771 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             w, h, <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l01772"></a>01772 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l01773"></a>01773 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01774"></a>01774 
<a name="l01775"></a>01775     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertFlateToPSEmbed&quot;</span>);
<a name="l01776"></a>01776 
<a name="l01777"></a>01777     <span class="keywordflow">if</span> (!filein)
<a name="l01778"></a>01778         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01779"></a>01779     <span class="keywordflow">if</span> (!fileout)
<a name="l01780"></a>01780         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l01781"></a>01781 
<a name="l01782"></a>01782     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#a023e52341e3146583a8b72d0d22ebd0a">l_generateFlateData</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01783"></a>01783         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;flate data not made&quot;</span>, procName, 1);
<a name="l01784"></a>01784     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l01785"></a>01785     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l01786"></a>01786 
<a name="l01787"></a>01787         <span class="comment">/* Scale for 20 pt boundary and otherwise full filling</span>
<a name="l01788"></a>01788 <span class="comment">         * in one direction on 8.5 x 11 inch device */</span>
<a name="l01789"></a>01789     xpt = 20.0;
<a name="l01790"></a>01790     ypt = 20.0;
<a name="l01791"></a>01791     <span class="keywordflow">if</span> (w * 11.0 &gt; h * 8.5) {
<a name="l01792"></a>01792         wpt = 572.0;   <span class="comment">/* 612 - 2 * 20 */</span>
<a name="l01793"></a>01793         hpt = wpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w;
<a name="l01794"></a>01794     }
<a name="l01795"></a>01795     <span class="keywordflow">else</span> {
<a name="l01796"></a>01796         hpt = 752.0;   <span class="comment">/* 792 - 2 * 20 */</span>
<a name="l01797"></a>01797         wpt = hpt * (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)w / (<a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>)h;
<a name="l01798"></a>01798     }
<a name="l01799"></a>01799 
<a name="l01800"></a>01800         <span class="comment">/* Generate the PS.</span>
<a name="l01801"></a>01801 <span class="comment">         * The bounding box information should be inserted (default). */</span>
<a name="l01802"></a>01802     outstr = <a class="code" href="leptprotos_8h.html#acfaaf36603e94e1d4cbcbfc9ade8bae8">generateFlatePS</a>(filein, cid, xpt, ypt, wpt, hpt, 1, 1);
<a name="l01803"></a>01803     <span class="keywordflow">if</span> (!outstr)
<a name="l01804"></a>01804         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l01805"></a>01805     nbytes = strlen(outstr);
<a name="l01806"></a>01806 
<a name="l01807"></a>01807     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, <span class="stringliteral">&quot;w&quot;</span>, outstr, nbytes))
<a name="l01808"></a>01808         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l01809"></a>01809     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l01810"></a>01810     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l01811"></a>01811     <span class="keywordflow">return</span> 0;
<a name="l01812"></a>01812 }
<a name="l01813"></a>01813 
<a name="l01814"></a>01814 <span class="comment"></span>
<a name="l01815"></a>01815 <span class="comment">/*!</span>
<a name="l01816"></a>01816 <span class="comment"> *  convertFlateToPS()</span>
<a name="l01817"></a>01817 <span class="comment"> *</span>
<a name="l01818"></a>01818 <span class="comment"> *      Input:  filein (input file -- any format)</span>
<a name="l01819"></a>01819 <span class="comment"> *              fileout (output ps file)</span>
<a name="l01820"></a>01820 <span class="comment"> *              operation (&quot;w&quot; for write; &quot;a&quot; for append)</span>
<a name="l01821"></a>01821 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l01822"></a>01822 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l01823"></a>01823 <span class="comment"> *                    of the page)</span>
<a name="l01824"></a>01824 <span class="comment"> *              res (resolution of the input image, in ppi; use 0 for default)</span>
<a name="l01825"></a>01825 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l01826"></a>01826 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l01827"></a>01827 <span class="comment"> *                      if there is only one page.)</span>
<a name="l01828"></a>01828 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l01829"></a>01829 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l01830"></a>01830 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01831"></a>01831 <span class="comment"> *</span>
<a name="l01832"></a>01832 <span class="comment"> *  Notes:</span>
<a name="l01833"></a>01833 <span class="comment"> *      (1) This outputs level 3 PS as flate compressed (overlaid</span>
<a name="l01834"></a>01834 <span class="comment"> *          with ascii85 encoding).</span>
<a name="l01835"></a>01835 <span class="comment"> *      (2) An output file can contain multiple pages, each with</span>
<a name="l01836"></a>01836 <span class="comment"> *          multiple images.  The arguments to convertFlateToPS()</span>
<a name="l01837"></a>01837 <span class="comment"> *          allow you to control placement of png images on multiple</span>
<a name="l01838"></a>01838 <span class="comment"> *          pages within a PostScript file.</span>
<a name="l01839"></a>01839 <span class="comment"> *      (3) For the first image written to a file, use &quot;w&quot;, which</span>
<a name="l01840"></a>01840 <span class="comment"> *          opens for write and clears the file.  For all subsequent</span>
<a name="l01841"></a>01841 <span class="comment"> *          images written to that file, use &quot;a&quot;.</span>
<a name="l01842"></a>01842 <span class="comment"> *      (4) The (x, y) parameters give the LL corner of the image</span>
<a name="l01843"></a>01843 <span class="comment"> *          relative to the LL corner of the page.  They are in</span>
<a name="l01844"></a>01844 <span class="comment"> *          units of pixels if scale = 1.0.  If you use (e.g.)</span>
<a name="l01845"></a>01845 <span class="comment"> *          scale = 2.0, the image is placed at (2x, 2y) on the page,</span>
<a name="l01846"></a>01846 <span class="comment"> *          and the image dimensions are also doubled.</span>
<a name="l01847"></a>01847 <span class="comment"> *      (5) Display vs printed resolution:</span>
<a name="l01848"></a>01848 <span class="comment"> *           * If your display is 75 ppi and your image was created</span>
<a name="l01849"></a>01849 <span class="comment"> *             at a resolution of 300 ppi, you can get the image</span>
<a name="l01850"></a>01850 <span class="comment"> *             to print at the same size as it appears on your display</span>
<a name="l01851"></a>01851 <span class="comment"> *             by either setting scale = 4.0 or by setting  res = 75.</span>
<a name="l01852"></a>01852 <span class="comment"> *             Both tell the printer to make a 4x enlarged image.</span>
<a name="l01853"></a>01853 <span class="comment"> *           * If your image is generated at 150 ppi and you use scale = 1,</span>
<a name="l01854"></a>01854 <span class="comment"> *             it will be rendered such that 150 pixels correspond</span>
<a name="l01855"></a>01855 <span class="comment"> *             to 72 pts (1 inch on the printer).  This function does</span>
<a name="l01856"></a>01856 <span class="comment"> *             the conversion from pixels (with or without scaling) to</span>
<a name="l01857"></a>01857 <span class="comment"> *             pts, which are the units that the printer uses.</span>
<a name="l01858"></a>01858 <span class="comment"> *           * The printer will choose its own resolution to use</span>
<a name="l01859"></a>01859 <span class="comment"> *             in rendering the image, which will not affect the size</span>
<a name="l01860"></a>01860 <span class="comment"> *             of the rendered image.  That is because the output</span>
<a name="l01861"></a>01861 <span class="comment"> *             PostScript file describes the geometry in terms of pts,</span>
<a name="l01862"></a>01862 <span class="comment"> *             which are defined to be 1/72 inch.  The printer will</span>
<a name="l01863"></a>01863 <span class="comment"> *             only see the size of the image in pts, through the</span>
<a name="l01864"></a>01864 <span class="comment"> *             scale and translate parameters and the affine</span>
<a name="l01865"></a>01865 <span class="comment"> *             transform (the ImageMatrix) of the image.</span>
<a name="l01866"></a>01866 <span class="comment"> *      (6) To render multiple images on the same page, set</span>
<a name="l01867"></a>01867 <span class="comment"> *          endpage = FALSE for each image until you get to the</span>
<a name="l01868"></a>01868 <span class="comment"> *          last, for which you set endpage = TRUE.  This causes the</span>
<a name="l01869"></a>01869 <span class="comment"> *          &quot;showpage&quot; command to be invoked.  Showpage outputs</span>
<a name="l01870"></a>01870 <span class="comment"> *          the entire page and clears the raster buffer for the</span>
<a name="l01871"></a>01871 <span class="comment"> *          next page to be added.  Without a &quot;showpage&quot;,</span>
<a name="l01872"></a>01872 <span class="comment"> *          subsequent images from the next page will overlay those</span>
<a name="l01873"></a>01873 <span class="comment"> *          previously put down.</span>
<a name="l01874"></a>01874 <span class="comment"> *      (7) For multiple pages, increment the page number, starting</span>
<a name="l01875"></a>01875 <span class="comment"> *          with page 1.  This allows PostScript (and PDF) to build</span>
<a name="l01876"></a>01876 <span class="comment"> *          a page directory, which viewers use for navigation.</span>
<a name="l01877"></a>01877 <span class="comment"> */</span>
<a name="l01878"></a>01878 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01879"></a><a class="code" href="psio2_8c.html#a5655f4985a11c79716f18ea24eb57db9">01879</a> <a class="code" href="leptprotos_8h.html#a33dd8b7df09a60ac502660616b76a1f1">convertFlateToPS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01880"></a>01880                  <span class="keyword">const</span> <span class="keywordtype">char</span>  *fileout,
<a name="l01881"></a>01881                  <span class="keyword">const</span> <span class="keywordtype">char</span>  *operation,
<a name="l01882"></a>01882                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l01883"></a>01883                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l01884"></a>01884                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l01885"></a>01885                  <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l01886"></a>01886                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l01887"></a>01887                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l01888"></a>01888 {
<a name="l01889"></a>01889 <span class="keywordtype">char</span>    *outstr;
<a name="l01890"></a>01890 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;
<a name="l01891"></a>01891 
<a name="l01892"></a>01892     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertFlateToPS&quot;</span>);
<a name="l01893"></a>01893 
<a name="l01894"></a>01894     <span class="keywordflow">if</span> (!filein)
<a name="l01895"></a>01895         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01896"></a>01896     <span class="keywordflow">if</span> (!fileout)
<a name="l01897"></a>01897         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;fileout not defined&quot;</span>, procName, 1);
<a name="l01898"></a>01898     <span class="keywordflow">if</span> (strcmp(operation, <span class="stringliteral">&quot;w&quot;</span>) &amp;&amp; strcmp(operation, <span class="stringliteral">&quot;a&quot;</span>))
<a name="l01899"></a>01899         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;operation must be \&quot;w\&quot; or \&quot;a\&quot;&quot;</span>, procName, 1);
<a name="l01900"></a>01900 
<a name="l01901"></a>01901     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#af81b912d549fa67bc03e1738ef0004bc">convertFlateToPSString</a>(filein, &amp;outstr, &amp;nbytes, x, y, res, scale,
<a name="l01902"></a>01902                                pageno, endpage))
<a name="l01903"></a>01903         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not made&quot;</span>, procName, 1);
<a name="l01904"></a>01904 
<a name="l01905"></a>01905     <span class="keywordflow">if</span> (<a class="code" href="leptprotos_8h.html#aebc18ee4e11cf721b8d2eb46b4f20a83">l_binaryWrite</a>(fileout, operation, outstr, nbytes))
<a name="l01906"></a>01906         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;ps string not written to file&quot;</span>, procName, 1);
<a name="l01907"></a>01907 
<a name="l01908"></a>01908     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outstr);
<a name="l01909"></a>01909     <span class="keywordflow">return</span> 0;
<a name="l01910"></a>01910 }
<a name="l01911"></a>01911 
<a name="l01912"></a>01912 <span class="comment"></span>
<a name="l01913"></a>01913 <span class="comment">/*!</span>
<a name="l01914"></a>01914 <span class="comment"> *  convertFlateToPSString()</span>
<a name="l01915"></a>01915 <span class="comment"> *</span>
<a name="l01916"></a>01916 <span class="comment"> *      Generates level 3 PS string in flate compressed format.</span>
<a name="l01917"></a>01917 <span class="comment"> *</span>
<a name="l01918"></a>01918 <span class="comment"> *      Input:  filein (input image file)</span>
<a name="l01919"></a>01919 <span class="comment"> *              &amp;poutstr (&lt;return&gt; PS string)</span>
<a name="l01920"></a>01920 <span class="comment"> *              &amp;nbytes (&lt;return&gt; number of bytes in PS string)</span>
<a name="l01921"></a>01921 <span class="comment"> *              x, y (location of LL corner of image, in pixels, relative</span>
<a name="l01922"></a>01922 <span class="comment"> *                    to the PostScript origin (0,0) at the LL corner</span>
<a name="l01923"></a>01923 <span class="comment"> *                    of the page)</span>
<a name="l01924"></a>01924 <span class="comment"> *              res (resolution of the input image, in ppi; use 0 for default)</span>
<a name="l01925"></a>01925 <span class="comment"> *              scale (scaling by printer; use 0.0 or 1.0 for no scaling)</span>
<a name="l01926"></a>01926 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l01927"></a>01927 <span class="comment"> *                      if there is only one page.)</span>
<a name="l01928"></a>01928 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l01929"></a>01929 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l01930"></a>01930 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l01931"></a>01931 <span class="comment"> *</span>
<a name="l01932"></a>01932 <span class="comment"> *  Notes:</span>
<a name="l01933"></a>01933 <span class="comment"> *      (1) The returned PS character array is a null-terminated</span>
<a name="l01934"></a>01934 <span class="comment"> *          ascii string.  All the raster data is ascii85 encoded, so</span>
<a name="l01935"></a>01935 <span class="comment"> *          there are no null bytes embedded in it.</span>
<a name="l01936"></a>01936 <span class="comment"> *      (2) The raster encoding is made with gzip, the same as that</span>
<a name="l01937"></a>01937 <span class="comment"> *          in a png file that is compressed without prediction.</span>
<a name="l01938"></a>01938 <span class="comment"> *          The raster data itself is 25% larger than that in the</span>
<a name="l01939"></a>01939 <span class="comment"> *          binary form, due to the ascii85 encoding.</span>
<a name="l01940"></a>01940 <span class="comment"> *</span>
<a name="l01941"></a>01941 <span class="comment"> *  Usage:  See convertFlateToPS()</span>
<a name="l01942"></a>01942 <span class="comment"> */</span>
<a name="l01943"></a>01943 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l01944"></a><a class="code" href="psio2_8c.html#a23756842aa295c46436958db17749b25">01944</a> <a class="code" href="leptprotos_8h.html#af81b912d549fa67bc03e1738ef0004bc">convertFlateToPSString</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l01945"></a>01945                        <span class="keywordtype">char</span>       **poutstr,
<a name="l01946"></a>01946                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>     *pnbytes,
<a name="l01947"></a>01947                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      x,
<a name="l01948"></a>01948                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      y,
<a name="l01949"></a>01949                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      res,
<a name="l01950"></a>01950                        <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>    scale,
<a name="l01951"></a>01951                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      pageno,
<a name="l01952"></a>01952                        <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      endpage)
<a name="l01953"></a>01953 {
<a name="l01954"></a>01954 <span class="keywordtype">char</span>               *outstr;
<a name="l01955"></a>01955 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt, ypt, wpt, hpt;
<a name="l01956"></a>01956 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l01957"></a>01957 
<a name="l01958"></a>01958     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;convertFlateToPSString&quot;</span>);
<a name="l01959"></a>01959 
<a name="l01960"></a>01960     <span class="keywordflow">if</span> (!poutstr)
<a name="l01961"></a>01961         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;outstr not defined&quot;</span>, procName, 1);
<a name="l01962"></a>01962     <span class="keywordflow">if</span> (!pnbytes)
<a name="l01963"></a>01963         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;nbytes not defined&quot;</span>, procName, 1);
<a name="l01964"></a>01964     *pnbytes = 0;
<a name="l01965"></a>01965     *poutstr = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;
<a name="l01966"></a>01966     <span class="keywordflow">if</span> (!filein)
<a name="l01967"></a>01967         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;filein not defined&quot;</span>, procName, 1);
<a name="l01968"></a>01968 
<a name="l01969"></a>01969     <span class="keywordflow">if</span> ((cid = <a class="code" href="leptprotos_8h.html#a023e52341e3146583a8b72d0d22ebd0a">l_generateFlateData</a>(filein, 1)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l01970"></a>01970         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;flate data not made&quot;</span>, procName, 1);
<a name="l01971"></a>01971 
<a name="l01972"></a>01972         <span class="comment">/* Get scaled location in pts.  Guess the input scan resolution</span>
<a name="l01973"></a>01973 <span class="comment">         * based on the input parameter @res, the resolution data in</span>
<a name="l01974"></a>01974 <span class="comment">         * the pix, and the size of the image. */</span>
<a name="l01975"></a>01975     <span class="keywordflow">if</span> (scale == 0.0)
<a name="l01976"></a>01976         scale = 1.0;
<a name="l01977"></a>01977     <span class="keywordflow">if</span> (res &lt;= 0) {
<a name="l01978"></a>01978         <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> &gt; 0)
<a name="l01979"></a>01979             res = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a>;
<a name="l01980"></a>01980         <span class="keywordflow">else</span>
<a name="l01981"></a>01981             res = <a class="code" href="psio2_8c.html#ac8b9429873b760d1d2de20adeb2e8011">DEFAULT_INPUT_RES</a>;
<a name="l01982"></a>01982     }
<a name="l01983"></a>01983     xpt = scale * x * 72. / res;
<a name="l01984"></a>01984     ypt = scale * y * 72. / res;
<a name="l01985"></a>01985     wpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> * 72. / res;
<a name="l01986"></a>01986     hpt = scale * cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> * 72. / res;
<a name="l01987"></a>01987 
<a name="l01988"></a>01988     <span class="keywordflow">if</span> (pageno == 0)
<a name="l01989"></a>01989         pageno = 1;
<a name="l01990"></a>01990 
<a name="l01991"></a>01991 <span class="preprocessor">#if  DEBUG_FLATE</span>
<a name="l01992"></a>01992 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;w = %d, h = %d, bps = %d, spp = %d\n&quot;</span>,
<a name="l01993"></a>01993             cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a>);
<a name="l01994"></a>01994     fprintf(stderr, <span class="stringliteral">&quot;uncomp bytes = %d, comp bytes = %d, nbytes85 = %d\n&quot;</span>,
<a name="l01995"></a>01995             cid-&gt;<a class="code" href="struct_l___compressed___data.html#af7659ff17e3cedb73f8c8b2b4bffa535">nbytes</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a>, cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a>);
<a name="l01996"></a>01996     fprintf(stderr, <span class="stringliteral">&quot;xpt = %7.2f, ypt = %7.2f, wpt = %7.2f, hpt = %7.2f\n&quot;</span>,
<a name="l01997"></a>01997              xpt, ypt, wpt, hpt);
<a name="l01998"></a>01998 <span class="preprocessor">#endif   </span><span class="comment">/* DEBUG_FLATE */</span>
<a name="l01999"></a>01999 
<a name="l02000"></a>02000         <span class="comment">/* Generate the PS */</span>
<a name="l02001"></a>02001     outstr = <a class="code" href="leptprotos_8h.html#acfaaf36603e94e1d4cbcbfc9ade8bae8">generateFlatePS</a>(filein, cid, xpt, ypt, wpt, hpt, pageno, endpage);
<a name="l02002"></a>02002     <span class="keywordflow">if</span> (!outstr)
<a name="l02003"></a>02003         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;outstr not made&quot;</span>, procName, 1);
<a name="l02004"></a>02004     *poutstr = outstr;
<a name="l02005"></a>02005     *pnbytes = strlen(outstr);
<a name="l02006"></a>02006     <a class="code" href="leptprotos_8h.html#a10ea29eb3421ebf3fb4a449fe6d95a3d">compressed_dataDestroy</a>(&amp;cid);
<a name="l02007"></a>02007     <span class="keywordflow">return</span> 0;
<a name="l02008"></a>02008 }
<a name="l02009"></a>02009 
<a name="l02010"></a>02010 <span class="comment"></span>
<a name="l02011"></a>02011 <span class="comment">/*!</span>
<a name="l02012"></a>02012 <span class="comment"> *  generateFlatePS()</span>
<a name="l02013"></a>02013 <span class="comment"> *</span>
<a name="l02014"></a>02014 <span class="comment"> *      Input:  filein (&lt;optional&gt; input filename; can be null)</span>
<a name="l02015"></a>02015 <span class="comment"> *              cid (flate compressed image data)</span>
<a name="l02016"></a>02016 <span class="comment"> *              xpt, ypt (location of LL corner of image, in pts, relative</span>
<a name="l02017"></a>02017 <span class="comment"> *                        to the PostScript origin (0,0) at the LL corner</span>
<a name="l02018"></a>02018 <span class="comment"> *                        of the page)</span>
<a name="l02019"></a>02019 <span class="comment"> *              wpt, hpt (rendered image size in pts)</span>
<a name="l02020"></a>02020 <span class="comment"> *              pageno (page number; must start with 1; you can use 0</span>
<a name="l02021"></a>02021 <span class="comment"> *                      if there is only one page)</span>
<a name="l02022"></a>02022 <span class="comment"> *              endpage (boolean: use TRUE if this is the last image to be</span>
<a name="l02023"></a>02023 <span class="comment"> *                       added to the page; FALSE otherwise)</span>
<a name="l02024"></a>02024 <span class="comment"> *      Return: PS string, or null on error</span>
<a name="l02025"></a>02025 <span class="comment"> */</span>
<a name="l02026"></a>02026 <span class="keywordtype">char</span> *
<a name="l02027"></a><a class="code" href="psio2_8c.html#aad09bd345be36f33fd0e8438994f3c12">02027</a> <a class="code" href="leptprotos_8h.html#acfaaf36603e94e1d4cbcbfc9ade8bae8">generateFlatePS</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>         *<a class="code" href="enhance__reg_8c.html#a57617553b7431035fafb4bf524deca96">filein</a>,
<a name="l02028"></a>02028                 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid,
<a name="l02029"></a>02029                 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           xpt,
<a name="l02030"></a>02030                 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           ypt,
<a name="l02031"></a>02031                 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           wpt,
<a name="l02032"></a>02032                 <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>           hpt,
<a name="l02033"></a>02033                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             pageno,
<a name="l02034"></a>02034                 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>             endpage)
<a name="l02035"></a>02035 {
<a name="l02036"></a>02036 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  w, h, bps, spp;
<a name="l02037"></a>02037 <span class="keywordtype">char</span>    *outstr;
<a name="l02038"></a>02038 <span class="keywordtype">char</span>     bigbuf[<a class="code" href="psio2_8c.html#af1791633b3a1a12a9aa449aa6d558327">L_BUF_SIZE</a>];
<a name="l02039"></a>02039 <a class="code" href="struct_sarray.html">SARRAY</a>  *sa;
<a name="l02040"></a>02040 
<a name="l02041"></a>02041     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;generateFlatePS&quot;</span>);
<a name="l02042"></a>02042 
<a name="l02043"></a>02043     <span class="keywordflow">if</span> (!cid)
<a name="l02044"></a>02044         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;flate data not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02045"></a>02045     w = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a>;
<a name="l02046"></a>02046     h = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a>;
<a name="l02047"></a>02047     bps = cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a>;
<a name="l02048"></a>02048     spp = cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a>;
<a name="l02049"></a>02049 
<a name="l02050"></a>02050     <span class="keywordflow">if</span> ((sa = <a class="code" href="leptprotos_8h.html#ad131504b407cbc1aaa1b18e59945d9a5">sarrayCreate</a>(50)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02051"></a>02051         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;sa not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02052"></a>02052 
<a name="l02053"></a>02053     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%!PS-Adobe-3.0 EPSF-3.0&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02054"></a>02054     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%Creator: leptonica&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02055"></a>02055     <span class="keywordflow">if</span> (filein) {
<a name="l02056"></a>02056         sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Title: %s&quot;</span>, filein);
<a name="l02057"></a>02057         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02058"></a>02058     }
<a name="l02059"></a>02059     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%DocumentData: Clean7Bit&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02060"></a>02060 
<a name="l02061"></a>02061     <span class="keywordflow">if</span> (<a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">var_PS_WRITE_BOUNDING_BOX</a> == 1) {
<a name="l02062"></a>02062         sprintf(bigbuf,
<a name="l02063"></a>02063             <span class="stringliteral">&quot;%%%%BoundingBox: %7.2f %7.2f %7.2f %7.2f&quot;</span>,
<a name="l02064"></a>02064                        xpt, ypt, xpt + wpt, ypt + hpt);
<a name="l02065"></a>02065         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02066"></a>02066     }
<a name="l02067"></a>02067 
<a name="l02068"></a>02068     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%LanguageLevel: 3&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02069"></a>02069     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;%%EndComments&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02070"></a>02070     sprintf(bigbuf, <span class="stringliteral">&quot;%%%%Page: %d %d&quot;</span>, pageno, pageno);
<a name="l02071"></a>02071     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02072"></a>02072 
<a name="l02073"></a>02073     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;save&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02074"></a>02074     sprintf(bigbuf,
<a name="l02075"></a>02075         <span class="stringliteral">&quot;%7.2f %7.2f translate         %%set image origin in pts&quot;</span>, xpt, ypt);
<a name="l02076"></a>02076     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02077"></a>02077 
<a name="l02078"></a>02078     sprintf(bigbuf,
<a name="l02079"></a>02079         <span class="stringliteral">&quot;%7.2f %7.2f scale             %%set image size in pts&quot;</span>, wpt, hpt);
<a name="l02080"></a>02080     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02081"></a>02081 
<a name="l02082"></a>02082         <span class="comment">/* If there is a colormap, add the data; it is now owned by sa */</span>
<a name="l02083"></a>02083     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a>) {
<a name="l02084"></a>02084         sprintf(bigbuf,
<a name="l02085"></a>02085              <span class="stringliteral">&quot;[ /Indexed /DeviceRGB %d          %%set colormap type/size&quot;</span>,
<a name="l02086"></a>02086              cid-&gt;<a class="code" href="struct_l___compressed___data.html#a263eff890402fb5c779fcf4e3dbcc4b6">ncolors</a> - 1);
<a name="l02087"></a>02087         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02088"></a>02088         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &lt;~&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02089"></a>02089         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l02090"></a>02090         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  ] setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02091"></a>02091     }
<a name="l02092"></a>02092     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spp == 1)
<a name="l02093"></a>02093         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceGray setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02094"></a>02094     <span class="keywordflow">else</span>   <span class="comment">/* spp == 3 */</span>
<a name="l02095"></a>02095         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/DeviceRGB setcolorspace&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02096"></a>02096 
<a name="l02097"></a>02097     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l02098"></a>02098               (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/RawData currentfile /ASCII85Decode filter def&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02099"></a>02099     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa,
<a name="l02100"></a>02100               (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;/Data RawData &lt;&lt; &gt;&gt; /FlateDecode filter def&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02101"></a>02101 
<a name="l02102"></a>02102     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;{ &lt;&lt; /ImageType 1&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02103"></a>02103     sprintf(bigbuf, <span class="stringliteral">&quot;     /Width %d&quot;</span>, w);
<a name="l02104"></a>02104     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02105"></a>02105     sprintf(bigbuf, <span class="stringliteral">&quot;     /Height %d&quot;</span>, h);
<a name="l02106"></a>02106     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02107"></a>02107     sprintf(bigbuf, <span class="stringliteral">&quot;     /BitsPerComponent %d&quot;</span>, bps);
<a name="l02108"></a>02108     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02109"></a>02109     sprintf(bigbuf, <span class="stringliteral">&quot;     /ImageMatrix [ %d 0 0 %d 0 %d ]&quot;</span>, w, -h, h);
<a name="l02110"></a>02110     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, bigbuf, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02111"></a>02111 
<a name="l02112"></a>02112     <span class="keywordflow">if</span> (cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a>)
<a name="l02113"></a>02113         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 255]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02114"></a>02114     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (spp == 1) {
<a name="l02115"></a>02115         <span class="keywordflow">if</span> (bps == 1)  <span class="comment">/* miniswhite photometry */</span>
<a name="l02116"></a>02116             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [1 0]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02117"></a>02117         <span class="keywordflow">else</span>  <span class="comment">/* bps &gt; 1 */</span>
<a name="l02118"></a>02118             <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02119"></a>02119     }
<a name="l02120"></a>02120     <span class="keywordflow">else</span>  <span class="comment">/* spp == 3 */</span>
<a name="l02121"></a>02121         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /Decode [0 1 0 1 0 1]&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02122"></a>02122 
<a name="l02123"></a>02123     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;     /DataSource Data&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02124"></a>02124     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  &gt;&gt; image&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02125"></a>02125     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  Data closefile&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02126"></a>02126     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  RawData flushfile&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02127"></a>02127     <span class="keywordflow">if</span> (endpage == <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>)
<a name="l02128"></a>02128         <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  showpage&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02129"></a>02129     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;  restore&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02130"></a>02130     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, (<span class="keywordtype">char</span> *)<span class="stringliteral">&quot;} exec&quot;</span>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fa5d4fddf26f28ac80063028939562e17d">L_COPY</a>);
<a name="l02131"></a>02131 
<a name="l02132"></a>02132         <span class="comment">/* Insert the ascii85 gzipped data; this is now owned by sa */</span>
<a name="l02133"></a>02133     <a class="code" href="leptprotos_8h.html#a6800001b8d0e7344e5c828b42a9e04e7">sarrayAddString</a>(sa, cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a>, <a class="code" href="pix_8h.html#a5d76b81b0ad4c19007a781d4edb8181fac1bdfee98ef4dbb3637c7d329cc460a3">L_INSERT</a>);
<a name="l02134"></a>02134 
<a name="l02135"></a>02135         <span class="comment">/* Generate and return the output string */</span>
<a name="l02136"></a>02136     outstr = <a class="code" href="leptprotos_8h.html#aa58ee6340678669b10d71c2abe2ab9a0">sarrayToString</a>(sa, 1);
<a name="l02137"></a>02137     <a class="code" href="leptprotos_8h.html#a6bc238d36ad4599585c7de09105f83c2">sarrayDestroy</a>(&amp;sa);
<a name="l02138"></a>02138     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a> = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* it has been transferred to sa and destroyed */</span>
<a name="l02139"></a>02139     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* it has been transferred to sa and destroyed */</span>
<a name="l02140"></a>02140     <span class="keywordflow">return</span> outstr;
<a name="l02141"></a>02141 }
<a name="l02142"></a>02142 
<a name="l02143"></a>02143 <span class="comment"></span>
<a name="l02144"></a>02144 <span class="comment">/*!</span>
<a name="l02145"></a>02145 <span class="comment"> *  l_generateFlateData()</span>
<a name="l02146"></a>02146 <span class="comment"> *</span>
<a name="l02147"></a>02147 <span class="comment"> *      Input:  fname</span>
<a name="l02148"></a>02148 <span class="comment"> *              ascii85flag (0 for gzipped; 1 for ascii85-encoded gzipped)</span>
<a name="l02149"></a>02149 <span class="comment"> *      Return: cid (flate compressed image data), or null on error</span>
<a name="l02150"></a>02150 <span class="comment"> *</span>
<a name="l02151"></a>02151 <span class="comment"> *  Notes:</span>
<a name="l02152"></a>02152 <span class="comment"> *      (1) The input image is converted to one of these 4 types:</span>
<a name="l02153"></a>02153 <span class="comment"> *           - 1 bpp</span>
<a name="l02154"></a>02154 <span class="comment"> *           - 8 bpp, no colormap</span>
<a name="l02155"></a>02155 <span class="comment"> *           - 8 bpp, colormap</span>
<a name="l02156"></a>02156 <span class="comment"> *           - 32 bpp rgb</span>
<a name="l02157"></a>02157 <span class="comment"> *      (2) Set ascii85flag:</span>
<a name="l02158"></a>02158 <span class="comment"> *           - 0 for binary data (not permitted in PostScript)</span>
<a name="l02159"></a>02159 <span class="comment"> *           - 1 for ascii85 (5 for 4) encoded binary data</span>
<a name="l02160"></a>02160 <span class="comment"> */</span>
<a name="l02161"></a>02161 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l02162"></a><a class="code" href="psio2_8c.html#a1c31842d8d3be5376f4fa8f142e4f04a">02162</a> <a class="code" href="leptprotos_8h.html#a023e52341e3146583a8b72d0d22ebd0a">l_generateFlateData</a>(<span class="keyword">const</span> <span class="keywordtype">char</span>  *fname,
<a name="l02163"></a>02163                     <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>      ascii85flag)
<a name="l02164"></a>02164 {
<a name="l02165"></a>02165 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l02166"></a>02166 <a class="code" href="struct_pix.html">PIX</a>                *pixs;
<a name="l02167"></a>02167 
<a name="l02168"></a>02168     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;l_generateFlateData&quot;</span>);
<a name="l02169"></a>02169 
<a name="l02170"></a>02170     <span class="keywordflow">if</span> (!fname)
<a name="l02171"></a>02171         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;fname not defined&quot;</span>,
<a name="l02172"></a>02172                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02173"></a>02173 
<a name="l02174"></a>02174     <span class="keywordflow">if</span> ((pixs = <a class="code" href="leptprotos_8h.html#a84634846cbb5e01df667d6e9241dfc53">pixRead</a>(fname)) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02175"></a>02175         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not made&quot;</span>,
<a name="l02176"></a>02176                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02177"></a>02177     cid = <a class="code" href="leptprotos_8h.html#ae3620670d42b7d5bd8892adc2baccab2">pixGenerateFlateData</a>(pixs, ascii85flag);
<a name="l02178"></a>02178     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixs);
<a name="l02179"></a>02179     <span class="keywordflow">return</span> cid;
<a name="l02180"></a>02180 }
<a name="l02181"></a>02181 
<a name="l02182"></a>02182 <span class="comment"></span>
<a name="l02183"></a>02183 <span class="comment">/*!</span>
<a name="l02184"></a>02184 <span class="comment"> *  pixGenerateFlateData()</span>
<a name="l02185"></a>02185 <span class="comment"> *</span>
<a name="l02186"></a>02186 <span class="comment"> *      Input:  pixs</span>
<a name="l02187"></a>02187 <span class="comment"> *              ascii85flag (0 for gzipped; 1 for ascii85-encoded gzipped)</span>
<a name="l02188"></a>02188 <span class="comment"> *      Return: cid (flate compressed image data), or null on error</span>
<a name="l02189"></a>02189 <span class="comment"> */</span>
<a name="l02190"></a>02190 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *
<a name="l02191"></a><a class="code" href="psio2_8c.html#a484e92b3c2e72c9d0efb44cbf3037a65">02191</a> <a class="code" href="leptprotos_8h.html#ae3620670d42b7d5bd8892adc2baccab2">pixGenerateFlateData</a>(<a class="code" href="struct_pix.html">PIX</a>     *pixs,
<a name="l02192"></a>02192                      <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  ascii85flag)
<a name="l02193"></a>02193 {
<a name="l02194"></a>02194 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>       *data = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* uncompressed raster data in required format */</span>
<a name="l02195"></a>02195 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>       *datacomp = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* gzipped raster data */</span>
<a name="l02196"></a>02196 <span class="keywordtype">char</span>          *data85 = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* ascii85 encoded gzipped raster data */</span>
<a name="l02197"></a>02197 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>       *cmapdata = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* uncompressed colormap */</span>
<a name="l02198"></a>02198 <span class="keywordtype">char</span>          *cmapdata85 = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* ascii85 encoded uncompressed colormap */</span>
<a name="l02199"></a>02199 <span class="keywordtype">char</span>          *cmapdatahex = <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>;  <span class="comment">/* hex ascii uncompressed colormap */</span>
<a name="l02200"></a>02200 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>        ncolors;  <span class="comment">/* in colormap; not used if cmapdata85 is null */</span>
<a name="l02201"></a>02201 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>        bps;  <span class="comment">/* bits/sample: usually 8 */</span>
<a name="l02202"></a>02202 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>        spp;  <span class="comment">/* samples/pixel: 1-grayscale); 3-rgb; 4-rgba */</span>
<a name="l02203"></a>02203 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>        w, h, d, cmapflag;
<a name="l02204"></a>02204 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>        ncmapbytes, ncmapbytes85, nbytes85;
<a name="l02205"></a>02205 <span class="keywordtype">size_t</span>         <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>, nbytescomp;
<a name="l02206"></a>02206 <a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>  *cid;
<a name="l02207"></a>02207 <a class="code" href="struct_pix.html">PIX</a>           *pixt;
<a name="l02208"></a>02208 <a class="code" href="struct_pix_colormap.html">PIXCMAP</a>       *cmap;
<a name="l02209"></a>02209 
<a name="l02210"></a>02210     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixGenerateFlateData&quot;</span>);
<a name="l02211"></a>02211 
<a name="l02212"></a>02212     <span class="keywordflow">if</span> (!pixs)
<a name="l02213"></a>02213         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;pixs not defined&quot;</span>,
<a name="l02214"></a>02214                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02215"></a>02215 
<a name="l02216"></a>02216         <span class="comment">/* Convert the image to one of these 4 types:</span>
<a name="l02217"></a>02217 <span class="comment">         *     1 bpp</span>
<a name="l02218"></a>02218 <span class="comment">         *     8 bpp, no colormap</span>
<a name="l02219"></a>02219 <span class="comment">         *     8 bpp, colormap</span>
<a name="l02220"></a>02220 <span class="comment">         *     32 bpp rgb    */</span>
<a name="l02221"></a>02221     <a class="code" href="leptprotos_8h.html#a11b8bc890f3872b0a19307f4c5a9b41e">pixGetDimensions</a>(pixs, &amp;w, &amp;h, &amp;d);
<a name="l02222"></a>02222     cmap = <a class="code" href="leptprotos_8h.html#a6c959f1c381ebe5a4abc867a3d8ae1e6">pixGetColormap</a>(pixs);
<a name="l02223"></a>02223     cmapflag = (cmap) ? 1 : 0;
<a name="l02224"></a>02224     <span class="keywordflow">if</span> (d == 2 || d == 4 || d == 16) {
<a name="l02225"></a>02225         pixt = <a class="code" href="leptprotos_8h.html#a5e10c5c2eec6d2bdd4defa3c48d4331c">pixConvertTo8</a>(pixs, cmapflag);
<a name="l02226"></a>02226         cmap = <a class="code" href="leptprotos_8h.html#a6c959f1c381ebe5a4abc867a3d8ae1e6">pixGetColormap</a>(pixt);
<a name="l02227"></a>02227         d = <a class="code" href="leptprotos_8h.html#a1646270a1eae38cd7af74c68351ce513">pixGetDepth</a>(pixt);
<a name="l02228"></a>02228     }
<a name="l02229"></a>02229     <span class="keywordflow">else</span>
<a name="l02230"></a>02230         pixt = <a class="code" href="leptprotos_8h.html#a48c3df1b04f60de6d7fcabd8375250d8">pixClone</a>(pixs);
<a name="l02231"></a>02231     spp = (d == 32) ? 3 : 1;
<a name="l02232"></a>02232     bps = (d == 32) ? 8 : d;
<a name="l02233"></a>02233 
<a name="l02234"></a>02234         <span class="comment">/* Extract and encode the colormap data as both ascii85 and hexascii  */</span>
<a name="l02235"></a>02235     ncolors = 0;
<a name="l02236"></a>02236     <span class="keywordflow">if</span> (cmap) {
<a name="l02237"></a>02237         <a class="code" href="colormap_8c.html#aefd014012038d9b07a867222c3ac77c1">pixcmapSerializeToMemory</a>(cmap, 3, &amp;ncolors, &amp;cmapdata, &amp;ncmapbytes);
<a name="l02238"></a>02238         <span class="keywordflow">if</span> (!cmapdata)
<a name="l02239"></a>02239             <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;cmapdata not made&quot;</span>,
<a name="l02240"></a>02240                                                   procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02241"></a>02241 
<a name="l02242"></a>02242         cmapdata85 = <a class="code" href="leptprotos_8h.html#a38ccddb3da59b9e5076f6eb845ad84fd">encodeAscii85</a>(cmapdata, ncmapbytes, &amp;ncmapbytes85);
<a name="l02243"></a>02243         cmapdatahex = <a class="code" href="colormap_8c.html#ac08680b0fdd5aed297729b5e9e50e96f">pixcmapConvertToHex</a>(cmapdata, ncmapbytes, ncolors);
<a name="l02244"></a>02244         <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cmapdata);
<a name="l02245"></a>02245     }
<a name="l02246"></a>02246 
<a name="l02247"></a>02247         <span class="comment">/* Extract and compress the raster data */</span>
<a name="l02248"></a>02248     <a class="code" href="leptprotos_8h.html#a80b3fdaaaa5a80b2a78b5d8a05c7a859">pixGetRasterData</a>(pixt, &amp;data, &amp;nbytes);
<a name="l02249"></a>02249     <a class="code" href="leptprotos_8h.html#a1b238e61b64e4e5c62f44849cddb9658">pixDestroy</a>(&amp;pixt);
<a name="l02250"></a>02250     datacomp = <a class="code" href="leptprotos_8h.html#a7c6e1826a65bc4b0f3a771f57875658e">zlibCompress</a>(data, nbytes, &amp;nbytescomp);
<a name="l02251"></a>02251     <span class="keywordflow">if</span> (!datacomp) {
<a name="l02252"></a>02252         <span class="keywordflow">if</span> (cmapdata85) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cmapdata85);
<a name="l02253"></a>02253         <span class="keywordflow">if</span> (cmapdatahex) <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cmapdatahex);
<a name="l02254"></a>02254         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;datacomp not made&quot;</span>,
<a name="l02255"></a>02255                                               procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02256"></a>02256     }
<a name="l02257"></a>02257     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(data);
<a name="l02258"></a>02258 
<a name="l02259"></a>02259         <span class="comment">/* Optionally, encode the compressed data */</span>
<a name="l02260"></a>02260     <span class="keywordflow">if</span> (ascii85flag == 1) {
<a name="l02261"></a>02261         data85 = <a class="code" href="leptprotos_8h.html#a38ccddb3da59b9e5076f6eb845ad84fd">encodeAscii85</a>(datacomp, nbytescomp, &amp;nbytes85);
<a name="l02262"></a>02262         <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(datacomp);
<a name="l02263"></a>02263         <span class="keywordflow">if</span> (!data85) {
<a name="l02264"></a>02264             <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(cmapdata85);
<a name="l02265"></a>02265             <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;data85 not made&quot;</span>,
<a name="l02266"></a>02266                                                   procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02267"></a>02267         }
<a name="l02268"></a>02268         <span class="keywordflow">else</span>
<a name="l02269"></a>02269             data85[nbytes85 - 1] = <span class="charliteral">&#39;\0&#39;</span>;  <span class="comment">/* remove the newline */</span>
<a name="l02270"></a>02270     }
<a name="l02271"></a>02271 
<a name="l02272"></a>02272     cid = (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(1, <span class="keyword">sizeof</span>(<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a>));
<a name="l02273"></a>02273     <span class="keywordflow">if</span> (!cid)
<a name="l02274"></a>02274         <span class="keywordflow">return</span> (<a class="code" href="struct_l___compressed___data.html">L_COMPRESSED_DATA</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;cid not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02275"></a>02275     <span class="keywordflow">if</span> (ascii85flag == 0)
<a name="l02276"></a>02276         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a3e4fc387d70ba9a7afd286d397376bdc">datacomp</a> = datacomp;
<a name="l02277"></a>02277     <span class="keywordflow">else</span> {  <span class="comment">/* ascii85 */</span>
<a name="l02278"></a>02278         cid-&gt;<a class="code" href="struct_l___compressed___data.html#a325a0d587ea01a8952329fc32729885c">data85</a> = data85;
<a name="l02279"></a>02279         cid-&gt;<a class="code" href="struct_l___compressed___data.html#ae745eba0174ce405918672bc9fea9e20">nbytes85</a> = nbytes85;
<a name="l02280"></a>02280     }
<a name="l02281"></a>02281     cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab0cc53bf28df7259b556c486f08498e1">type</a> = <a class="code" href="imageio_8h.html#ab04a0655cd1e3bcac5e8f48c18df1a57a769cde100085e3c2f00f79f728acbedf">L_FLATE_ENCODE</a>;
<a name="l02282"></a>02282     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a2ec10c008922e65fd5256a26646b5e71">cmapdatahex</a> = cmapdatahex;
<a name="l02283"></a>02283     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7ff070129fe03c33e533fe3141aa0a4e">cmapdata85</a> = cmapdata85;
<a name="l02284"></a>02284     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a4b996454b6e5cd170a9bb763f050edff">nbytescomp</a> = nbytescomp;
<a name="l02285"></a>02285     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a263eff890402fb5c779fcf4e3dbcc4b6">ncolors</a> = ncolors;
<a name="l02286"></a>02286     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a81e77aeae0f972d3cb6fde2cfd54e9ab">w</a> = w;
<a name="l02287"></a>02287     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a051ddc98ad4a48a45913682318c3cbbc">h</a> = h;
<a name="l02288"></a>02288     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a28564f0c93c4b46ecf4b71c7a909262c">bps</a> = bps;
<a name="l02289"></a>02289     cid-&gt;<a class="code" href="struct_l___compressed___data.html#ab5df55ba644f2fc1e2fc65eb13b6140e">spp</a> = spp;
<a name="l02290"></a>02290     cid-&gt;<a class="code" href="struct_l___compressed___data.html#a7a6e1e6ed4c4b0922e3cb18e89b90fbe">res</a> = <a class="code" href="leptprotos_8h.html#ab47b081faee7f1193117ece8178daaee">pixGetXRes</a>(pixs);
<a name="l02291"></a>02291     cid-&gt;<a class="code" href="struct_l___compressed___data.html#af7659ff17e3cedb73f8c8b2b4bffa535">nbytes</a> = <a class="code" href="struct_pix_memory_store.html#a514637cdc8411f4874e0d8dcf7ff0218">nbytes</a>;  <span class="comment">/* only for debugging */</span>
<a name="l02292"></a>02292     <span class="keywordflow">return</span> cid;
<a name="l02293"></a>02293 }
<a name="l02294"></a>02294 
<a name="l02295"></a>02295 
<a name="l02296"></a>02296 <span class="comment">/*---------------------------------------------------------------------*</span>
<a name="l02297"></a>02297 <span class="comment"> *                          Write to memory                            *</span>
<a name="l02298"></a>02298 <span class="comment"> *---------------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l02299"></a>02299 <span class="comment">/*!</span>
<a name="l02300"></a>02300 <span class="comment"> *  pixWriteMemPS()</span>
<a name="l02301"></a>02301 <span class="comment"> *</span>
<a name="l02302"></a>02302 <span class="comment"> *      Input:  &amp;data (&lt;return&gt; data of tiff compressed image)</span>
<a name="l02303"></a>02303 <span class="comment"> *              &amp;size (&lt;return&gt; size of returned data)</span>
<a name="l02304"></a>02304 <span class="comment"> *              pix</span>
<a name="l02305"></a>02305 <span class="comment"> *              box  (&lt;optional&gt;)</span>
<a name="l02306"></a>02306 <span class="comment"> *              res  (can use 0 for default of 300 ppi)</span>
<a name="l02307"></a>02307 <span class="comment"> *              scale (to prevent scaling, use either 1.0 or 0.0)</span>
<a name="l02308"></a>02308 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l02309"></a>02309 <span class="comment"> *</span>
<a name="l02310"></a>02310 <span class="comment"> *  Notes:</span>
<a name="l02311"></a>02311 <span class="comment"> *      (1) See pixWriteStringPS() for usage.</span>
<a name="l02312"></a>02312 <span class="comment"> *      (2) This is just a wrapper for pixWriteStringPS(), which</span>
<a name="l02313"></a>02313 <span class="comment"> *          writes uncompressed image data to memory.</span>
<a name="l02314"></a>02314 <span class="comment"> */</span>
<a name="l02315"></a>02315 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l02316"></a><a class="code" href="psio2_8c.html#a347148ef2420aa64eb8f7353a4d73918">02316</a> <a class="code" href="leptprotos_8h.html#a4d4565d71820b5865f721d43c71e0bdd">pixWriteMemPS</a>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  **pdata,
<a name="l02317"></a>02317               <span class="keywordtype">size_t</span>    *psize,
<a name="l02318"></a>02318               <a class="code" href="struct_pix.html">PIX</a>       *pix,
<a name="l02319"></a>02319               <a class="code" href="struct_box.html">BOX</a>       *box,
<a name="l02320"></a>02320               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    res,
<a name="l02321"></a>02321               <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  scale)
<a name="l02322"></a>02322 {
<a name="l02323"></a>02323     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;pixWriteMemPS&quot;</span>);
<a name="l02324"></a>02324 
<a name="l02325"></a>02325     <span class="keywordflow">if</span> (!pdata)
<a name="l02326"></a>02326         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;data not defined&quot;</span>, procName, 1 );
<a name="l02327"></a>02327     <span class="keywordflow">if</span> (!psize)
<a name="l02328"></a>02328         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;size not defined&quot;</span>, procName, 1 );
<a name="l02329"></a>02329     <span class="keywordflow">if</span> (!pix)
<a name="l02330"></a>02330         <span class="keywordflow">return</span> <a class="code" href="environ_8h.html#a8b17fe871312c2e1613fa694bb78a963">ERROR_INT</a>(<span class="stringliteral">&quot;&amp;pix not defined&quot;</span>, procName, 1 );
<a name="l02331"></a>02331 
<a name="l02332"></a>02332     *pdata = (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)<a class="code" href="leptprotos_8h.html#a0740def25928896c51cce8d48f7c300e">pixWriteStringPS</a>(pix, box, res, scale);
<a name="l02333"></a>02333     *psize = strlen((<span class="keywordtype">char</span> *)(*pdata));
<a name="l02334"></a>02334     <span class="keywordflow">return</span> 0;
<a name="l02335"></a>02335 }
<a name="l02336"></a>02336 
<a name="l02337"></a>02337 
<a name="l02338"></a>02338 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l02339"></a>02339 <span class="comment"> *                    Converting resolution                    *</span>
<a name="l02340"></a>02340 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l02341"></a>02341 <span class="comment">/*!</span>
<a name="l02342"></a>02342 <span class="comment"> *  getResLetterPage()</span>
<a name="l02343"></a>02343 <span class="comment"> *</span>
<a name="l02344"></a>02344 <span class="comment"> *      Input:  w (image width, pixels)</span>
<a name="l02345"></a>02345 <span class="comment"> *              h (image height, pixels)</span>
<a name="l02346"></a>02346 <span class="comment"> *              fillfract (fraction in linear dimension of full page, not</span>
<a name="l02347"></a>02347 <span class="comment"> *                         to be exceeded; use 0 for default)</span>
<a name="l02348"></a>02348 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l02349"></a>02349 <span class="comment"> */</span>
<a name="l02350"></a>02350 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l02351"></a><a class="code" href="psio2_8c.html#ae75ae60e09db9a9f75d7bbcb8c61d897">02351</a> <a class="code" href="leptprotos_8h.html#ab26f3c899a94f5b896b2d93da15e2afb">getResLetterPage</a>(<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    w,
<a name="l02352"></a>02352                  <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    h,
<a name="l02353"></a>02353                  <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  fillfract)
<a name="l02354"></a>02354 {
<a name="l02355"></a>02355 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  resw, resh, res;
<a name="l02356"></a>02356 
<a name="l02357"></a>02357     <span class="keywordflow">if</span> (fillfract == 0.0)
<a name="l02358"></a>02358         fillfract = <a class="code" href="psio2_8c.html#ae5cd7ddcd7db6d82efc3da1980812d0e">DEFAULT_FILL_FRACTION</a>;
<a name="l02359"></a>02359     resw = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)((w * 72.) / (<a class="code" href="psio2_8c.html#a554df9dc23fef6dfda93c0011d6bb709">LETTER_WIDTH</a> * fillfract));
<a name="l02360"></a>02360     resh = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)((h * 72.) / (<a class="code" href="psio2_8c.html#aca7914657933f6a1a9ae0c1fa12d0aec">LETTER_HEIGHT</a> * fillfract));
<a name="l02361"></a>02361     res = <a class="code" href="environ_8h.html#a806d5df14d476263788e0a67d3615b4d">L_MAX</a>(resw, resh);
<a name="l02362"></a>02362     <span class="keywordflow">return</span> res;
<a name="l02363"></a>02363 }
<a name="l02364"></a>02364 
<a name="l02365"></a>02365 <span class="comment"></span>
<a name="l02366"></a>02366 <span class="comment">/*!</span>
<a name="l02367"></a>02367 <span class="comment"> *  getResA4Page()</span>
<a name="l02368"></a>02368 <span class="comment"> *</span>
<a name="l02369"></a>02369 <span class="comment"> *      Input:  w (image width, pixels)</span>
<a name="l02370"></a>02370 <span class="comment"> *              h (image height, pixels)</span>
<a name="l02371"></a>02371 <span class="comment"> *              fillfract (fraction in linear dimension of full page, not</span>
<a name="l02372"></a>02372 <span class="comment"> *                        to be exceeded; use 0 for default)</span>
<a name="l02373"></a>02373 <span class="comment"> *      Return: 0 if OK, 1 on error</span>
<a name="l02374"></a>02374 <span class="comment"> */</span>
<a name="l02375"></a>02375 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l02376"></a><a class="code" href="psio2_8c.html#a7490ece8c744bb05e70cc5cb7eb73f97">02376</a> <a class="code" href="leptprotos_8h.html#ab5221b96a3227cfb1e8892e6eeef4fc2">getResA4Page</a>(<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    w,
<a name="l02377"></a>02377              <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>    h,
<a name="l02378"></a>02378              <a class="code" href="environ_8h.html#af59419416d96ecf5fca70c8d05adb456">l_float32</a>  fillfract)
<a name="l02379"></a>02379 {
<a name="l02380"></a>02380 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  resw, resh, res;
<a name="l02381"></a>02381 
<a name="l02382"></a>02382     <span class="keywordflow">if</span> (fillfract == 0.0)
<a name="l02383"></a>02383         fillfract = <a class="code" href="psio2_8c.html#ae5cd7ddcd7db6d82efc3da1980812d0e">DEFAULT_FILL_FRACTION</a>;
<a name="l02384"></a>02384     resw = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)((w * 72.) / (<a class="code" href="psio2_8c.html#ac8876763816c3777a8809420fdfda5e0">A4_WIDTH</a> * fillfract));
<a name="l02385"></a>02385     resh = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)((h * 72.) / (<a class="code" href="psio2_8c.html#af15b52325746b4b232895b2c82a8d5d5">A4_HEIGHT</a> * fillfract));
<a name="l02386"></a>02386     res = <a class="code" href="environ_8h.html#a806d5df14d476263788e0a67d3615b4d">L_MAX</a>(resw, resh);
<a name="l02387"></a>02387     <span class="keywordflow">return</span> res;
<a name="l02388"></a>02388 }
<a name="l02389"></a>02389 
<a name="l02390"></a>02390 
<a name="l02391"></a>02391 
<a name="l02392"></a>02392 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l02393"></a>02393 <span class="comment"> *      Utility for encoding and decoding data with ascii85    *</span>
<a name="l02394"></a>02394 <span class="comment"> *-------------------------------------------------------------*/</span><span class="comment"></span>
<a name="l02395"></a>02395 <span class="comment">/*!</span>
<a name="l02396"></a>02396 <span class="comment"> *  encodeAscii85()</span>
<a name="l02397"></a>02397 <span class="comment"> *</span>
<a name="l02398"></a>02398 <span class="comment"> *      Input:  inarray (input data)</span>
<a name="l02399"></a>02399 <span class="comment"> *              insize (number of bytes in input array)</span>
<a name="l02400"></a>02400 <span class="comment"> *              &amp;outsize (&lt;return&gt; number of bytes in output char array)</span>
<a name="l02401"></a>02401 <span class="comment"> *      Return: chara (with 64 characters + \n in each line)</span>
<a name="l02402"></a>02402 <span class="comment"> *</span>
<a name="l02403"></a>02403 <span class="comment"> *  Notes:</span>
<a name="l02404"></a>02404 <span class="comment"> *      (1) Ghostscript has a stack break if the last line of</span>
<a name="l02405"></a>02405 <span class="comment"> *          data only has a &#39;&gt;&#39;, so we avoid the problem by</span>
<a name="l02406"></a>02406 <span class="comment"> *          always putting &#39;~&gt;&#39; on the last line.</span>
<a name="l02407"></a>02407 <span class="comment"> */</span>
<a name="l02408"></a>02408 <span class="keywordtype">char</span> *
<a name="l02409"></a><a class="code" href="psio2_8c.html#a095c55f73173ff40687740237c9cf4d4">02409</a> <a class="code" href="leptprotos_8h.html#a38ccddb3da59b9e5076f6eb845ad84fd">encodeAscii85</a>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  *inarray,
<a name="l02410"></a>02410               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   insize,
<a name="l02411"></a>02411               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  *poutsize)
<a name="l02412"></a>02412 {
<a name="l02413"></a>02413 <span class="keywordtype">char</span>    *chara;
<a name="l02414"></a>02414 <span class="keywordtype">char</span>    *outbuf;
<a name="l02415"></a>02415 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  <a class="code" href="overlap__reg_8c.html#a332ff7829674eedb7280f7ea608e11c3">maxsize</a>, i, index, outindex, linecount, nbout, eof;
<a name="l02416"></a>02416 
<a name="l02417"></a>02417     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;encodeAscii85&quot;</span>);
<a name="l02418"></a>02418 
<a name="l02419"></a>02419     <span class="keywordflow">if</span> (!inarray)
<a name="l02420"></a>02420         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;inarray not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02421"></a>02421 
<a name="l02422"></a>02422         <span class="comment">/* Accumulate results in char array */</span>
<a name="l02423"></a>02423     maxsize = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)(80. + (insize * 5. / 4.) *
<a name="l02424"></a>02424                         (1. + 2. / <a class="code" href="psio2_8c.html#aad2ea195992058b22128391685b46ce0">MAX_85_LINE_COUNT</a>));
<a name="l02425"></a>02425     <span class="keywordflow">if</span> ((chara = (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(maxsize, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02426"></a>02426         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;chara not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02427"></a>02427 
<a name="l02428"></a>02428     <span class="keywordflow">if</span> ((outbuf = (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(8, <span class="keyword">sizeof</span>(<span class="keywordtype">char</span>))) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02429"></a>02429         <span class="keywordflow">return</span> (<span class="keywordtype">char</span> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;outbuf not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02430"></a>02430 
<a name="l02431"></a>02431     linecount = 0;
<a name="l02432"></a>02432     index = 0;
<a name="l02433"></a>02433     outindex = 0;
<a name="l02434"></a>02434     <span class="keywordflow">while</span> (1) {
<a name="l02435"></a>02435         eof = <a class="code" href="psio2_8c.html#af4e6bbb144efce5fedd970d4df00f5bc">convertChunkToAscii85</a>(inarray, insize, &amp;index, outbuf, &amp;nbout);
<a name="l02436"></a>02436         <span class="keywordflow">for</span> (i = 0; i &lt; nbout; i++) {
<a name="l02437"></a>02437             chara[outindex++] = outbuf[i];
<a name="l02438"></a>02438             linecount++;
<a name="l02439"></a>02439             <span class="keywordflow">if</span> (linecount &gt;= <a class="code" href="psio2_8c.html#aad2ea195992058b22128391685b46ce0">MAX_85_LINE_COUNT</a>) {
<a name="l02440"></a>02440                 chara[outindex++] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l02441"></a>02441                 linecount = 0;
<a name="l02442"></a>02442             }
<a name="l02443"></a>02443         }
<a name="l02444"></a>02444         <span class="keywordflow">if</span> (eof == <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>) {
<a name="l02445"></a>02445             <span class="keywordflow">if</span> (linecount != 0)
<a name="l02446"></a>02446                 chara[outindex++] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l02447"></a>02447             chara[outindex++] = <span class="charliteral">&#39;~&#39;</span>;
<a name="l02448"></a>02448             chara[outindex++] = <span class="charliteral">&#39;&gt;&#39;</span>;
<a name="l02449"></a>02449             chara[outindex++] = <span class="charliteral">&#39;\n&#39;</span>;
<a name="l02450"></a>02450             <span class="keywordflow">break</span>;
<a name="l02451"></a>02451         }
<a name="l02452"></a>02452     }
<a name="l02453"></a>02453 
<a name="l02454"></a>02454     <a class="code" href="environ_8h.html#a105949c59c998e38aad80266afac92bf">FREE</a>(outbuf);
<a name="l02455"></a>02455     *poutsize = outindex;
<a name="l02456"></a>02456     <span class="keywordflow">return</span> chara;
<a name="l02457"></a>02457 }
<a name="l02458"></a>02458 
<a name="l02459"></a>02459 <span class="comment"></span>
<a name="l02460"></a>02460 <span class="comment">/*!</span>
<a name="l02461"></a>02461 <span class="comment"> *  convertChunkToAscii85()</span>
<a name="l02462"></a>02462 <span class="comment"> *</span>
<a name="l02463"></a>02463 <span class="comment"> *      Input:  inarray (input data)</span>
<a name="l02464"></a>02464 <span class="comment"> *              insize  (number of bytes in input array)</span>
<a name="l02465"></a>02465 <span class="comment"> *              &amp;index (use and &lt;return&gt; -- ptr)</span>
<a name="l02466"></a>02466 <span class="comment"> *              outbuf (holds 8 ascii chars; we use no more than 7)</span>
<a name="l02467"></a>02467 <span class="comment"> *              &amp;nbsout (&lt;return&gt; number of bytes written to outbuf)</span>
<a name="l02468"></a>02468 <span class="comment"> *      Return: boolean for eof (0 if more data, 1 if end of file)</span>
<a name="l02469"></a>02469 <span class="comment"> *</span>
<a name="l02470"></a>02470 <span class="comment"> *  Notes:</span>
<a name="l02471"></a>02471 <span class="comment"> *      (1) Attempts to read 4 bytes and write 5.</span>
<a name="l02472"></a>02472 <span class="comment"> *      (2) Writes 1 byte if the value is 0.</span>
<a name="l02473"></a>02473 <span class="comment"> */</span>
<a name="l02474"></a>02474 <span class="keyword">static</span> <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>
<a name="l02475"></a><a class="code" href="psio2_8c.html#af4e6bbb144efce5fedd970d4df00f5bc">02475</a> <a class="code" href="psio2_8c.html#af4e6bbb144efce5fedd970d4df00f5bc">convertChunkToAscii85</a>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  *inarray,
<a name="l02476"></a>02476                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   insize,
<a name="l02477"></a>02477                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  *pindex,
<a name="l02478"></a>02478                       <span class="keywordtype">char</span>     *outbuf,
<a name="l02479"></a>02479                       <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  *pnbout)
<a name="l02480"></a>02480 {
<a name="l02481"></a>02481 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>   inbyte;
<a name="l02482"></a>02482 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>  inword, val;
<a name="l02483"></a>02483 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   eof, index, nread, nbout, i;
<a name="l02484"></a>02484 
<a name="l02485"></a>02485     eof = <a class="code" href="environ_8h.html#aa93f0eb578d23995850d61f7d61c55c1">FALSE</a>;
<a name="l02486"></a>02486     index = *pindex;
<a name="l02487"></a>02487     nread = <a class="code" href="environ_8h.html#a67d588ee5ca71be19990efb07fa2ce72">L_MIN</a>(4, (insize - index));
<a name="l02488"></a>02488     <span class="keywordflow">if</span> (insize == index + nread)
<a name="l02489"></a>02489         eof = <a class="code" href="environ_8h.html#aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</a>;
<a name="l02490"></a>02490     *pindex += nread;  <span class="comment">/* save new index */</span>
<a name="l02491"></a>02491 
<a name="l02492"></a>02492         <span class="comment">/* Read input data and save in l_uint32 */</span>
<a name="l02493"></a>02493     inword = 0;
<a name="l02494"></a>02494     <span class="keywordflow">for</span> (i = 0; i &lt; nread; i++) {
<a name="l02495"></a>02495         inbyte = inarray[index + i];
<a name="l02496"></a>02496         inword += inbyte &lt;&lt; (8 * (3 - i));
<a name="l02497"></a>02497     }
<a name="l02498"></a>02498 
<a name="l02499"></a>02499 <span class="preprocessor">#if 0</span>
<a name="l02500"></a>02500 <span class="preprocessor"></span>    fprintf(stderr, <span class="stringliteral">&quot;index = %d, nread = %d\n&quot;</span>, index, nread);
<a name="l02501"></a>02501     fprintf(stderr, <span class="stringliteral">&quot;inword = %x\n&quot;</span>, inword);
<a name="l02502"></a>02502     fprintf(stderr, <span class="stringliteral">&quot;eof = %d\n&quot;</span>, eof);
<a name="l02503"></a>02503 <span class="preprocessor">#endif</span>
<a name="l02504"></a>02504 <span class="preprocessor"></span>
<a name="l02505"></a>02505         <span class="comment">/* Special case: output 1 byte only */</span>
<a name="l02506"></a>02506     <span class="keywordflow">if</span> (inword == 0) {
<a name="l02507"></a>02507         outbuf[0] = <span class="charliteral">&#39;z&#39;</span>;
<a name="l02508"></a>02508         nbout = 1;
<a name="l02509"></a>02509     }
<a name="l02510"></a>02510     <span class="keywordflow">else</span> { <span class="comment">/* output nread + 1 bytes */</span>
<a name="l02511"></a>02511         <span class="keywordflow">for</span> (i = 4; i &gt;= 4 - nread; i--) {
<a name="l02512"></a>02512             val = inword / <a class="code" href="psio2_8c.html#a920c246eaaeb153de163dbc1472871f2">power85</a>[i];
<a name="l02513"></a>02513             outbuf[4 - i] = (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>)(val + <span class="charliteral">&#39;!&#39;</span>);
<a name="l02514"></a>02514             inword -= val * <a class="code" href="psio2_8c.html#a920c246eaaeb153de163dbc1472871f2">power85</a>[i];
<a name="l02515"></a>02515         }
<a name="l02516"></a>02516         nbout = nread + 1;
<a name="l02517"></a>02517     }
<a name="l02518"></a>02518     *pnbout = nbout;
<a name="l02519"></a>02519 
<a name="l02520"></a>02520     <span class="keywordflow">return</span> eof;
<a name="l02521"></a>02521 }
<a name="l02522"></a>02522 
<a name="l02523"></a>02523 <span class="comment"></span>
<a name="l02524"></a>02524 <span class="comment">/*!</span>
<a name="l02525"></a>02525 <span class="comment"> *  decodeAscii85()</span>
<a name="l02526"></a>02526 <span class="comment"> *</span>
<a name="l02527"></a>02527 <span class="comment"> *      Input:  inarray (ascii85 input data)</span>
<a name="l02528"></a>02528 <span class="comment"> *              insize (number of bytes in input array)</span>
<a name="l02529"></a>02529 <span class="comment"> *              &amp;outsize (&lt;return&gt; number of bytes in output l_uint8 array)</span>
<a name="l02530"></a>02530 <span class="comment"> *      Return: outarray (binary)</span>
<a name="l02531"></a>02531 <span class="comment"> *</span>
<a name="l02532"></a>02532 <span class="comment"> *  Notes:</span>
<a name="l02533"></a>02533 <span class="comment"> *      (1) We assume the data is properly encoded, so we do not check</span>
<a name="l02534"></a>02534 <span class="comment"> *          for invalid characters or the final &#39;&gt;&#39; character.</span>
<a name="l02535"></a>02535 <span class="comment"> *      (2) We permit whitespace to be added to the encoding in an</span>
<a name="l02536"></a>02536 <span class="comment"> *          arbitrary way.</span>
<a name="l02537"></a>02537 <span class="comment"> */</span>
<a name="l02538"></a>02538 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *
<a name="l02539"></a><a class="code" href="psio2_8c.html#a56027a368ecd19a2954bf7a8f118b743">02539</a> <a class="code" href="leptprotos_8h.html#a38a5f0ad23c8d870a6403f47d25430f6">decodeAscii85</a>(<span class="keywordtype">char</span>     *ina,
<a name="l02540"></a>02540               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   insize,
<a name="l02541"></a>02541               <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  *poutsize)
<a name="l02542"></a>02542 {
<a name="l02543"></a>02543 <span class="keywordtype">char</span>      inc;
<a name="l02544"></a>02544 <span class="keywordtype">char</span>     *pin;
<a name="l02545"></a>02545 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>   val;
<a name="l02546"></a>02546 <a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>  *outa;
<a name="l02547"></a>02547 <a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>   <a class="code" href="overlap__reg_8c.html#a332ff7829674eedb7280f7ea608e11c3">maxsize</a>, ocount, bytecount, index;
<a name="l02548"></a>02548 <a class="code" href="environ_8h.html#a4d4d7254020fc95aef5dde8884405358">l_uint32</a>  oword;
<a name="l02549"></a>02549 
<a name="l02550"></a>02550     <a class="code" href="environ_8h.html#a1a16952819bcbc526c998e3ac86f2e78">PROCNAME</a>(<span class="stringliteral">&quot;decodeAscii85&quot;</span>);
<a name="l02551"></a>02551 
<a name="l02552"></a>02552     <span class="keywordflow">if</span> (!ina)
<a name="l02553"></a>02553         <span class="keywordflow">return</span> (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;ina not defined&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02554"></a>02554 
<a name="l02555"></a>02555         <span class="comment">/* Accumulate results in outa */</span>
<a name="l02556"></a>02556     maxsize = (<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>)(80. + (insize * 4. / 5.));  <span class="comment">/* plenty big */</span>
<a name="l02557"></a>02557     <span class="keywordflow">if</span> ((outa = (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)<a class="code" href="environ_8h.html#abc24891c647be0bd23e233d013175da0">CALLOC</a>(maxsize, <span class="keyword">sizeof</span>(<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a>))) == <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>)
<a name="l02558"></a>02558         <span class="keywordflow">return</span> (<a class="code" href="environ_8h.html#a7ed60554e7d6dd89aca643189b1e70ad">l_uint8</a> *)<a class="code" href="environ_8h.html#a38a8310a83847948c9ce6620983be468">ERROR_PTR</a>(<span class="stringliteral">&quot;outa not made&quot;</span>, procName, <a class="code" href="environ_8h.html#a070d2ce7b6bb7e5c05602aa8c308d0c4">NULL</a>);
<a name="l02559"></a>02559 
<a name="l02560"></a>02560     pin = ina;
<a name="l02561"></a>02561     ocount = 0;  <span class="comment">/* byte index into outa */</span>
<a name="l02562"></a>02562     oword = 0;
<a name="l02563"></a>02563     <span class="keywordflow">for</span> (index = 0, bytecount = 0; index &lt; insize; index++, pin++) {
<a name="l02564"></a>02564         inc = *pin;
<a name="l02565"></a>02565 
<a name="l02566"></a>02566         <span class="keywordflow">if</span> (inc == <span class="charliteral">&#39; &#39;</span> || inc == <span class="charliteral">&#39;\t&#39;</span> || inc == <span class="charliteral">&#39;\n&#39;</span> ||
<a name="l02567"></a>02567             inc == <span class="charliteral">&#39;\f&#39;</span> || inc == <span class="charliteral">&#39;\r&#39;</span> || inc == <span class="charliteral">&#39;\v&#39;</span>)  <span class="comment">/* ignore white space */</span>
<a name="l02568"></a>02568             <span class="keywordflow">continue</span>;
<a name="l02569"></a>02569 
<a name="l02570"></a>02570         val = inc - <span class="charliteral">&#39;!&#39;</span>;
<a name="l02571"></a>02571         <span class="keywordflow">if</span> (val &lt; 85) {
<a name="l02572"></a>02572             oword = oword * 85 + val;
<a name="l02573"></a>02573             <span class="keywordflow">if</span> (bytecount &lt; 4)
<a name="l02574"></a>02574                 bytecount++;
<a name="l02575"></a>02575             <span class="keywordflow">else</span> {  <span class="comment">/* we have all 5 input chars for the oword */</span>
<a name="l02576"></a>02576                 outa[ocount] = (oword &gt;&gt; 24) &amp; 0xff;
<a name="l02577"></a>02577                 outa[ocount + 1] = (oword &gt;&gt; 16) &amp; 0xff;
<a name="l02578"></a>02578                 outa[ocount + 2] = (oword &gt;&gt; 8) &amp; 0xff;
<a name="l02579"></a>02579                 outa[ocount + 3] = oword &amp; 0xff;
<a name="l02580"></a>02580                 ocount += 4;
<a name="l02581"></a>02581                 bytecount = 0;
<a name="l02582"></a>02582                 oword = 0;
<a name="l02583"></a>02583             }
<a name="l02584"></a>02584         }
<a name="l02585"></a>02585         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inc == <span class="charliteral">&#39;z&#39;</span> &amp;&amp; bytecount == 0) {
<a name="l02586"></a>02586             outa[ocount] = 0;
<a name="l02587"></a>02587             outa[ocount + 1] = 0;
<a name="l02588"></a>02588             outa[ocount + 2] = 0;
<a name="l02589"></a>02589             outa[ocount + 3] = 0;
<a name="l02590"></a>02590             ocount += 4;
<a name="l02591"></a>02591         }
<a name="l02592"></a>02592         <span class="keywordflow">else</span> <span class="keywordflow">if</span> (inc == <span class="charliteral">&#39;~&#39;</span>) {  <span class="comment">/* end of data */</span>
<a name="l02593"></a>02593             fprintf(stderr, <span class="stringliteral">&quot; %d extra bytes output\n&quot;</span>, bytecount - 1);
<a name="l02594"></a>02594             <span class="keywordflow">switch</span> (bytecount) {
<a name="l02595"></a>02595             <span class="keywordflow">case</span> 0:   <span class="comment">/* normal eof */</span>
<a name="l02596"></a>02596             <span class="keywordflow">case</span> 1:   <span class="comment">/* error */</span>
<a name="l02597"></a>02597                 <span class="keywordflow">break</span>;
<a name="l02598"></a>02598             <span class="keywordflow">case</span> 2:   <span class="comment">/* 1 extra byte */</span>
<a name="l02599"></a>02599                 oword = oword * (85 * 85 * 85) + 0xffffff;
<a name="l02600"></a>02600                 outa[ocount] = (oword &gt;&gt; 24) &amp; 0xff; 
<a name="l02601"></a>02601                 <span class="keywordflow">break</span>;
<a name="l02602"></a>02602             <span class="keywordflow">case</span> 3:   <span class="comment">/* 2 extra bytes */</span>
<a name="l02603"></a>02603                 oword = oword * (85 * 85) + 0xffff;
<a name="l02604"></a>02604                 outa[ocount] = (oword &gt;&gt; 24) &amp; 0xff; 
<a name="l02605"></a>02605                 outa[ocount + 1] = (oword &gt;&gt; 16) &amp; 0xff; 
<a name="l02606"></a>02606                 <span class="keywordflow">break</span>;
<a name="l02607"></a>02607             <span class="keywordflow">case</span> 4:   <span class="comment">/* 3 extra bytes */</span>
<a name="l02608"></a>02608                 oword = oword * 85 + 0xff;
<a name="l02609"></a>02609                 outa[ocount] = (oword &gt;&gt; 24) &amp; 0xff; 
<a name="l02610"></a>02610                 outa[ocount + 1] = (oword &gt;&gt; 16) &amp; 0xff; 
<a name="l02611"></a>02611                 outa[ocount + 2] = (oword &gt;&gt; 8) &amp; 0xff; 
<a name="l02612"></a>02612                 <span class="keywordflow">break</span>;
<a name="l02613"></a>02613             }
<a name="l02614"></a>02614             <span class="keywordflow">if</span> (bytecount &gt; 1)
<a name="l02615"></a>02615                 ocount += (bytecount - 1);
<a name="l02616"></a>02616             <span class="keywordflow">break</span>;
<a name="l02617"></a>02617         }
<a name="l02618"></a>02618     }
<a name="l02619"></a>02619     *poutsize = ocount;
<a name="l02620"></a>02620 
<a name="l02621"></a>02621     <span class="keywordflow">return</span> outa;
<a name="l02622"></a>02622 }
<a name="l02623"></a>02623 
<a name="l02624"></a>02624 
<a name="l02625"></a>02625 <span class="comment">/*-------------------------------------------------------------*</span>
<a name="l02626"></a>02626 <span class="comment"> *           Setting flag for writing bounding box hint        *</span>
<a name="l02627"></a>02627 <span class="comment"> *-------------------------------------------------------------*/</span>
<a name="l02628"></a>02628 <span class="keywordtype">void</span>
<a name="l02629"></a><a class="code" href="psio2_8c.html#a9e124263b52680f82e1a426e657c7926">02629</a> <a class="code" href="leptprotos_8h.html#a230013894d96725eea2274e9e9a523f8">l_psWriteBoundingBox</a>(<a class="code" href="environ_8h.html#a9085c7874153c280a4171244aa052e4e">l_int32</a>  flag)
<a name="l02630"></a>02630 {
<a name="l02631"></a>02631     <a class="code" href="psio2_8c.html#aadcc2749ec1b76be34a9282de8cf3f92">var_PS_WRITE_BOUNDING_BOX</a> = flag;
<a name="l02632"></a>02632 }
<a name="l02633"></a>02633 
<a name="l02634"></a>02634 
<a name="l02635"></a>02635 <span class="comment">/* --------------------------------------------*/</span>
<a name="l02636"></a>02636 <span class="preprocessor">#endif  </span><span class="comment">/* USE_PSIO */</span>
<a name="l02637"></a>02637 <span class="comment">/* --------------------------------------------*/</span>
<a name="l02638"></a>02638 
</pre></div></div>
</div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="psio2_8c.html">psio2.c</a>      </li>
      <li class="footer">Generated by&#160;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.7.3 </li>
    </ul>
  </div>
<!--- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Defines</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>


</body>
</html>
